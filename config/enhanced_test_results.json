{
  "backend_unit": {
    "ocr_advanced_preprocessing": {
      "success": false,
      "returncode": 1,
      "stdout": "============================= test session starts ==============================\nplatform linux -- Python 3.13.5, pytest-8.4.1, pluggy-1.5.0 -- /home/marcin/miniconda3/bin/python\ncachedir: .pytest_cache\nbenchmark: 5.1.0 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)\nrootdir: /home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO\nconfigfile: pyproject.toml\nplugins: asyncio-1.0.0, benchmark-5.1.0, anyio-4.9.0, langsmith-0.4.4, cov-6.2.1\nasyncio: mode=Mode.STRICT, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function\ncollecting ... collected 16 items\n\ntests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_enhanced_contour_detection FAILED [  6%]\ntests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_contour_detection_fallback_to_bounding_rect FAILED [ 12%]\ntests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_perspective_correction FAILED [ 18%]\ntests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_adaptive_thresholding_clahe FAILED [ 25%]\ntests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_300_dpi_scaling FAILED [ 31%]\ntests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_contrast_enhancement FAILED [ 37%]\ntests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_sharpness_enhancement FAILED [ 43%]\ntests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_lstm_engine_configuration FAILED [ 50%]\ntests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_process_image_with_advanced_preprocessing FAILED [ 56%]\ntests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_preprocessing_error_handling PASSED [ 62%]\ntests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_metadata_tracking FAILED [ 68%]\ntests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_confidence_distribution_calculation FAILED [ 75%]\ntests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_processing_time_tracking FAILED [ 81%]\ntests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_polish_receipt_text_recognition FAILED [ 87%]\ntests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_image_quality_analysis FAILED [ 93%]\ntests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_preprocessing_pipeline_integration PASSED [100%]\n\n=================================== FAILURES ===================================\n_________ TestOCRAdvancedPreprocessing.test_enhanced_contour_detection _________\ntests/unit/test_ocr_advanced_preprocessing.py:71: in test_enhanced_contour_detection\n    assert result is not None\nE   assert None is not None\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:26:51.583110\", \"level\": \"WARNING\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"B\\u0142\\u0105d podczas wykrywania konturu: 'Image' object has no attribute 'shape'\", \"levelno\": 30, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.583167\", \"level\": \"WARNING\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"B\\u0142\\u0105d podczas wykrywania konturu: 'Image' object has no attribute 'shape'\", \"levelno\": 30, \"taskName\": null}\n------------------------------ Captured log call -------------------------------\nWARNING  backend.core.ocr:ocr.py:154 Błąd podczas wykrywania konturu: 'Image' object has no attribute 'shape'\n_ TestOCRAdvancedPreprocessing.test_contour_detection_fallback_to_bounding_rect _\ntests/unit/test_ocr_advanced_preprocessing.py:90: in test_contour_detection_fallback_to_bounding_rect\n    assert result is not None\nE   assert None is not None\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:26:51.664040\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.664097\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": null}\n------------------------------ Captured log call -------------------------------\nINFO     backend.core.ocr:ocr.py:118 Nie znaleziono konturów w obrazie\n___________ TestOCRAdvancedPreprocessing.test_perspective_correction ___________\ntests/unit/test_ocr_advanced_preprocessing.py:109: in test_perspective_correction\n    result = ocr_processor._correct_perspective(\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE   AttributeError: 'OCRProcessor' object has no attribute '_correct_perspective'\n________ TestOCRAdvancedPreprocessing.test_adaptive_thresholding_clahe _________\ntests/unit/test_ocr_advanced_preprocessing.py:134: in test_adaptive_thresholding_clahe\n    result = ocr_processor._apply_adaptive_thresholding(image)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE   AttributeError: 'OCRProcessor' object has no attribute '_apply_adaptive_thresholding'\n______________ TestOCRAdvancedPreprocessing.test_300_dpi_scaling _______________\ntests/unit/test_ocr_advanced_preprocessing.py:150: in test_300_dpi_scaling\n    assert result.size[0] > small_image.size[0]\nE   assert 200 > 200\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:26:51.711648\", \"level\": \"WARNING\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"B\\u0142\\u0105d podczas skalowania do 300 DPI: 'Image' object has no attribute 'shape'\", \"levelno\": 30, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.711701\", \"level\": \"WARNING\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"B\\u0142\\u0105d podczas skalowania do 300 DPI: 'Image' object has no attribute 'shape'\", \"levelno\": 30, \"taskName\": null}\n------------------------------ Captured log call -------------------------------\nWARNING  backend.core.ocr:ocr.py:275 Błąd podczas skalowania do 300 DPI: 'Image' object has no attribute 'shape'\n____________ TestOCRAdvancedPreprocessing.test_contrast_enhancement ____________\ntests/unit/test_ocr_advanced_preprocessing.py:163: in test_contrast_enhancement\n    result = ocr_processor._enhance_contrast(low_contrast_image)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE   AttributeError: 'OCRProcessor' object has no attribute '_enhance_contrast'\n___________ TestOCRAdvancedPreprocessing.test_sharpness_enhancement ____________\ntests/unit/test_ocr_advanced_preprocessing.py:173: in test_sharpness_enhancement\n    result = ocr_processor._enhance_sharpness(blurry_image)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE   AttributeError: 'OCRProcessor' object has no attribute '_enhance_sharpness'\n_________ TestOCRAdvancedPreprocessing.test_lstm_engine_configuration __________\ntests/unit/test_ocr_advanced_preprocessing.py:185: in test_lstm_engine_configuration\n    assert \"-l pol\" in config  # Polish language\n    ^^^^^^^^^^^^^^^^^^^^^^^^^\nE   AssertionError: assert '-l pol' in '--oem 1 --psm 6'\n_ TestOCRAdvancedPreprocessing.test_process_image_with_advanced_preprocessing __\ntests/unit/test_ocr_advanced_preprocessing.py:225: in test_process_image_with_advanced_preprocessing\n    assert \"contour_detection\" in result.metadata\nE   AssertionError: assert 'contour_detection' in {'confidence_distribution': {'high': 3, 'low': 0, 'medium': 0}, 'language': 'eng', 'original_metadata': {'file_size_bytes': 1156, 'format': 'PNG', 'mode': 'RGB', 'size': (400, 300)}, 'pages': 1, ...}\nE    +  where {'confidence_distribution': {'high': 3, 'low': 0, 'medium': 0}, 'language': 'eng', 'original_metadata': {'file_size_bytes': 1156, 'format': 'PNG', 'mode': 'RGB', 'size': (400, 300)}, 'pages': 1, ...} = OCRResult(text='Lidl\\nMleko 3.2% 1L 4,99 PLN\\nRAZEM 4,99 PLN', confidence=90.0, metadata={'source': 'image', 'pages': 1, 'language': 'eng', 'preprocessing_applied': True, 'preprocessing_steps': ['image_preprocessing'], 'original_metadata': {'size': (400, 300), 'mode': 'RGB', 'format': 'PNG', 'file_size_bytes': 1156}, 'preprocessing_metadata': {'original_size': (400, 300), 'processed_size': (944, 708), 'preprocessing_steps': ['image_preprocessing']}, 'tesseract_config': '--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyzĄĆĘŁŃÓŚŹŻąćęłńóśźż.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng', 'processing_time_seconds': 0.03878498077392578, 'text_blocks': 3, 'confidence_distribution': {'high': 3, 'medium': 0, 'low': 0}}).metadata\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:26:51.809125\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Kontur za ma\\u0142y: 12.93% obrazu\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.809221\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Kontur za ma\\u0142y: 12.93% obrazu\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.818221\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (300, 400, 3) -> (708, 944, 3)\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.818267\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (300, 400, 3) -> (708, 944, 3)\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.818338\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.818358\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.822733\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.822793\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.827115\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.827153\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.827254\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": null, \"original_size\": [400, 300], \"processed_size\": [944, 708], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:26:51.827277\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": null, \"original_size\": [400, 300], \"processed_size\": [944, 708], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:26:51.827330\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": null, \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:26:51.827349\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": null, \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:26:51.827460\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": null, \"confidence\": 90.0, \"text_length\": 42, \"language\": \"eng\", \"processing_time_seconds\": 0.03878498077392578, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 3}\n{\"timestamp\": \"2025-07-06T23:26:51.827499\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": null, \"confidence\": 90.0, \"text_length\": 42, \"language\": \"eng\", \"processing_time_seconds\": 0.03878498077392578, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 3}\n------------------------------ Captured log call -------------------------------\nINFO     backend.core.ocr:ocr.py:129 Kontur za mały: 12.93% obrazu\nINFO     backend.core.ocr:ocr.py:271 Skalowanie do 300 DPI: (300, 400, 3) -> (708, 944, 3)\nINFO     backend.core.ocr:ocr.py:326 Przeskalowano do 300 DPI\nINFO     backend.core.ocr:ocr.py:330 Ulepszono kontrast i ostrość\nINFO     backend.core.ocr:ocr.py:334 Zastosowano adaptacyjny threshold\nINFO     backend.core.ocr:ocr.py:339 Preprocessing obrazu zakończony\nINFO     backend.core.ocr:ocr.py:383 Rozpoczynam OCR z ulepszoną konfiguracją\nINFO     backend.core.ocr:ocr.py:427 OCR przetwarzanie obrazu zakończone pomyślnie\n_____________ TestOCRAdvancedPreprocessing.test_metadata_tracking ______________\ntests/unit/test_ocr_advanced_preprocessing.py:247: in test_metadata_tracking\n    ocr_processor._add_preprocessing_step(metadata, \"contour_detection\", True)\n    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE   AttributeError: 'OCRProcessor' object has no attribute '_add_preprocessing_step'\n____ TestOCRAdvancedPreprocessing.test_confidence_distribution_calculation _____\ntests/unit/test_ocr_advanced_preprocessing.py:265: in test_confidence_distribution_calculation\n    distribution = ocr_processor._calculate_confidence_distribution(confidences)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE   AttributeError: 'OCRProcessor' object has no attribute '_calculate_confidence_distribution'\n__________ TestOCRAdvancedPreprocessing.test_processing_time_tracking __________\ntests/unit/test_ocr_advanced_preprocessing.py:279: in test_processing_time_tracking\n    with ocr_processor._measure_processing_time(metadata, \"ocr_processing\"):\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE   AttributeError: 'OCRProcessor' object has no attribute '_measure_processing_time'\n______ TestOCRAdvancedPreprocessing.test_polish_receipt_text_recognition _______\ntests/unit/test_ocr_advanced_preprocessing.py:332: in test_polish_receipt_text_recognition\n    assert result.metadata[\"language\"] == \"pol\"\nE   AssertionError: assert 'eng' == 'pol'\nE     \nE     - pol\nE     + eng\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:26:51.909643\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Kontur za ma\\u0142y: 12.93% obrazu\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.909727\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Kontur za ma\\u0142y: 12.93% obrazu\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.911594\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (300, 400, 3) -> (708, 944, 3)\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.911622\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (300, 400, 3) -> (708, 944, 3)\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.911674\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.911692\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.913003\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.913027\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.915835\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.915866\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:26:51.915943\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": null, \"original_size\": [400, 300], \"processed_size\": [944, 708], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:26:51.915964\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": null, \"original_size\": [400, 300], \"processed_size\": [944, 708], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:26:51.916021\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": null, \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:26:51.916040\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": null, \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:26:51.916130\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": null, \"confidence\": 90.0, \"text_length\": 91, \"language\": \"eng\", \"processing_time_seconds\": 0.008069992065429688, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 5}\n{\"timestamp\": \"2025-07-06T23:26:51.916161\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": null, \"confidence\": 90.0, \"text_length\": 91, \"language\": \"eng\", \"processing_time_seconds\": 0.008069992065429688, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 5}\n------------------------------ Captured log call -------------------------------\nINFO     backend.core.ocr:ocr.py:129 Kontur za mały: 12.93% obrazu\nINFO     backend.core.ocr:ocr.py:271 Skalowanie do 300 DPI: (300, 400, 3) -> (708, 944, 3)\nINFO     backend.core.ocr:ocr.py:326 Przeskalowano do 300 DPI\nINFO     backend.core.ocr:ocr.py:330 Ulepszono kontrast i ostrość\nINFO     backend.core.ocr:ocr.py:334 Zastosowano adaptacyjny threshold\nINFO     backend.core.ocr:ocr.py:339 Preprocessing obrazu zakończony\nINFO     backend.core.ocr:ocr.py:383 Rozpoczynam OCR z ulepszoną konfiguracją\nINFO     backend.core.ocr:ocr.py:427 OCR przetwarzanie obrazu zakończone pomyślnie\n___________ TestOCRAdvancedPreprocessing.test_image_quality_analysis ___________\ntests/unit/test_ocr_advanced_preprocessing.py:341: in test_image_quality_analysis\n    quality_good = ocr_processor._analyze_image_quality(good_image)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE   AttributeError: 'OCRProcessor' object has no attribute '_analyze_image_quality'\n=============================== warnings summary ===============================\n../../../../miniconda3/lib/python3.13/site-packages/faiss/loader.py:49\n  /home/marcin/miniconda3/lib/python3.13/site-packages/faiss/loader.py:49: DeprecationWarning: numpy.core._multiarray_umath is deprecated and has been renamed to numpy._core._multiarray_umath. The numpy._core namespace contains private NumPy internals and its use is discouraged, as NumPy internals can change without warning in any release. In practice, most real-world usage of numpy.core is to access functionality in the public NumPy API. If that is the case, use the public NumPy API. If not, you are using NumPy internals. If you would still like to access an internal attribute, use numpy._core._multiarray_umath.__cpu_features__.\n    from numpy.core._multiarray_umath import __cpu_features__\n\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type SwigPyPacked has no __module__ attribute\n\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type SwigPyObject has no __module__ attribute\n\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type swigvarlink has no __module__ attribute\n\n../../../../miniconda3/lib/python3.13/site-packages/pydantic/_internal/_config.py:295: 14 warnings\n  /home/marcin/miniconda3/lib/python3.13/site-packages/pydantic/_internal/_config.py:295: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/\n    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)\n\nsrc/backend/models/user_profile.py:58\n  /home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/models/user_profile.py:58: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/\n    @validator(\"time_zone\")\n\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: Type google._upb._message.MessageMapContainer uses PyType_Spec with a metaclass that has custom tp_new. This is deprecated and will no longer be allowed in Python 3.14.\n\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: Type google._upb._message.ScalarMapContainer uses PyType_Spec with a metaclass that has custom tp_new. This is deprecated and will no longer be allowed in Python 3.14.\n\nsrc/backend/core/response_length_config.py:277\n  /home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/core/response_length_config.py:277: PydanticDeprecatedSince20: The `copy` method is deprecated; use `model_copy` instead. See the docstring of `BaseModel.copy` for details about how to handle `include` and `exclude`. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/\n    return configs.get(style, DEFAULT_CONCISE_CONFIG).copy()\n\n-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html\n=========================== short test summary info ============================\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_enhanced_contour_detection\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_contour_detection_fallback_to_bounding_rect\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_perspective_correction\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_adaptive_thresholding_clahe\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_300_dpi_scaling\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_contrast_enhancement\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_sharpness_enhancement\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_lstm_engine_configuration\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_process_image_with_advanced_preprocessing\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_metadata_tracking\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_confidence_distribution_calculation\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_processing_time_tracking\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_polish_receipt_text_recognition\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_image_quality_analysis\n================== 14 failed, 2 passed, 27 warnings in 0.68s ===================\n",
      "stderr": "",
      "duration": 8.791431903839111
    },
    "ocr_enhanced": {
      "success": false,
      "returncode": 1,
      "stdout": "============================= test session starts ==============================\nplatform linux -- Python 3.13.5, pytest-8.4.1, pluggy-1.5.0 -- /home/marcin/miniconda3/bin/python\ncachedir: .pytest_cache\nbenchmark: 5.1.0 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)\nrootdir: /home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO\nconfigfile: pyproject.toml\nplugins: asyncio-1.0.0, benchmark-5.1.0, anyio-4.9.0, langsmith-0.4.4, cov-6.2.1\nasyncio: mode=Mode.STRICT, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function\ncollecting ... collected 37 items\n\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_get_default_receipt_config FAILED [  2%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_get_tesseract_config_with_polish_chars FAILED [  5%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_preprocess_receipt_image_grayscale_conversion PASSED [  8%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_preprocess_receipt_image_contrast_enhancement PASSED [ 10%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_preprocess_receipt_image_resize_small_image PASSED [ 13%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_preprocess_receipt_image_error_handling PASSED [ 16%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_process_image_with_preprocessing PASSED [ 18%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_process_image_error_handling PASSED [ 21%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_process_pdf_with_preprocessing PASSED [ 24%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_process_images_batch_with_logging PASSED [ 27%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_process_pdfs_batch_with_logging PASSED [ 29%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_extract_text_from_image_obj_with_receipt_config FAILED [ 32%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_process_image_file_with_preprocessing PASSED [ 35%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_process_pdf_file_with_preprocessing PASSED [ 37%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_ocr_processor_language_configuration FAILED [ 40%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_ocr_processor_custom_config PASSED [ 43%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_ocr_confidence_calculation PASSED [ 45%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_ocr_confidence_with_zero_values PASSED [ 48%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_preprocessing_preserves_image_integrity PASSED [ 51%]\ntests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_ocr_with_polish_receipt_text PASSED [ 54%]\ntests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_receipt_analysis_lidl_format FAILED [ 56%]\ntests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_receipt_analysis_auchan_format PASSED [ 59%]\ntests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_receipt_analysis_kaufland_format PASSED [ 62%]\ntests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_receipt_analysis_biedronka_format PASSED [ 64%]\ntests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_fallback_parser_with_common_products FAILED [ 67%]\ntests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_fallback_parser_with_price_patterns FAILED [ 70%]\ntests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_date_validation_with_various_formats FAILED [ 72%]\ntests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_fallback_parser_robustness FAILED [ 75%]\ntests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_date_normalization PASSED [ 78%]\ntests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_data_validation_future_date FAILED [ 81%]\ntests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_data_validation_price_mismatch PASSED [ 83%]\ntests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_empty_ocr_text PASSED [ 86%]\ntests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_llm_no_response_fallback PASSED [ 89%]\ntests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_categorization_error_handling PASSED [ 91%]\ntests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_store_pattern_recognition PASSED [ 94%]\ntests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_product_pattern_recognition PASSED [ 97%]\ntests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_complete_receipt_processing_workflow FAILED [100%]\n\n=================================== FAILURES ===================================\n_______________ TestOCREnhanced.test_get_default_receipt_config ________________\ntests/unit/test_ocr_enhanced.py:40: in test_get_default_receipt_config\n    assert \"--oem 3\" in config\nE   AssertionError: assert '--oem 3' in '--oem 1 --psm 6'\n_________ TestOCREnhanced.test_get_tesseract_config_with_polish_chars __________\ntests/unit/test_ocr_enhanced.py:50: in test_get_tesseract_config_with_polish_chars\n    assert \"-l pol\" in config\nE   AssertionError: assert '-l pol' in '--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyzĄĆĘŁŃÓŚŹŻąćęłńóśźż.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng'\n_____ TestOCREnhanced.test_extract_text_from_image_obj_with_receipt_config _____\ntests/unit/test_ocr_enhanced.py:200: in test_extract_text_from_image_obj_with_receipt_config\n    assert \"-l pol\" in config\nE   AssertionError: assert '-l pol' in '--oem 3 --psm 6 -l eng -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyzĄĆĘŁŃÓŚŹŻąćęłńóśźż.,:-/%()[] '\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:00.770842\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR: Rozpoczynam odczyt pliku obrazu...\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:00.770940\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR: Rozpoczynam odczyt pliku obrazu...\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:00.771398\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:00.771434\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:00.782406\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (100, 100, 3) -> (2362, 2362, 3)\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:00.782469\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (100, 100, 3) -> (2362, 2362, 3)\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:00.782538\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:00.782554\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:00.801045\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:00.801115\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:00.824839\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:00.824922\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:00.825029\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": null, \"original_size\": [100, 100], \"processed_size\": [2362, 2362], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:00.825051\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": null, \"original_size\": [100, 100], \"processed_size\": [2362, 2362], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:00.825435\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR: Odczyt obrazu zako\\u0144czony sukcesem.\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:00.825462\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR: Odczyt obrazu zako\\u0144czony sukcesem.\", \"levelno\": 20, \"taskName\": null}\n------------------------------ Captured log call -------------------------------\nINFO     backend.core.ocr:ocr.py:611 OCR: Rozpoczynam odczyt pliku obrazu...\nINFO     backend.core.ocr:ocr.py:118 Nie znaleziono konturów w obrazie\nINFO     backend.core.ocr:ocr.py:271 Skalowanie do 300 DPI: (100, 100, 3) -> (2362, 2362, 3)\nINFO     backend.core.ocr:ocr.py:326 Przeskalowano do 300 DPI\nINFO     backend.core.ocr:ocr.py:330 Ulepszono kontrast i ostrość\nINFO     backend.core.ocr:ocr.py:334 Zastosowano adaptacyjny threshold\nINFO     backend.core.ocr:ocr.py:339 Preprocessing obrazu zakończony\nINFO     backend.core.ocr:ocr.py:619 OCR: Odczyt obrazu zakończony sukcesem.\n__________ TestOCREnhanced.test_ocr_processor_language_configuration ___________\ntests/unit/test_ocr_enhanced.py:248: in test_ocr_processor_language_configuration\n    assert \"-l pol+eng\" in config\nE   AssertionError: assert '-l pol+eng' in '--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyzĄĆĘŁŃÓŚŹŻąćęłńóśźż.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng+pol'\n______ TestReceiptAnalysisAgentEnhanced.test_receipt_analysis_lidl_format ______\ntests/unit/test_receipt_analysis_enhanced.py:79: in test_receipt_analysis_lidl_format\n    assert result.data[\"store_name\"] == \"Lidl\"\nE   AssertionError: assert 'Nieznany sklep' == 'Lidl'\nE     \nE     - Lidl\nE     + Nieznany sklep\n---------------------------- Captured stdout setup -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:01.187052\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:01.187098\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:01.187586\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:01.187617\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:01.187696\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:01.187712\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:01.187749\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:01.187762\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:01.187974\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:01.187993\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:01.188029\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:01.188043\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:01.188269\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:01.188291\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:01.188327\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:01.188341\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n------------------------------ Captured log setup ------------------------------\nINFO     backend.core.product_categorizer:product_categorizer.py:23 Załadowano 35 kategorii produktów\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:109 Loaded configuration from data/config/enhanced_normalizer_config.json\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:72 EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:70 EnhancedNameNormalizer zainicjalizowany\nINFO     backend.core.product_name_normalizer:product_name_normalizer.py:20 Załadowano 80 reguł normalizacji nazw produktów\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:80 ProductNameNormalizer zainicjalizowany\nINFO     backend.core.store_normalizer:store_normalizer.py:17 Załadowano 40 sklepów do normalizacji\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:90 StoreNormalizer zainicjalizowany\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:01.189201\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Rozpoczynam analiz\\u0119 paragonu\", \"levelno\": 20, \"taskName\": \"Task-62\", \"text_length\": 172, \"agent_name\": \"ReceiptAnalysisAgent\"}\n{\"timestamp\": \"2025-07-06T23:27:01.189234\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Rozpoczynam analiz\\u0119 paragonu\", \"levelno\": 20, \"taskName\": \"Task-62\", \"text_length\": 172, \"agent_name\": \"ReceiptAnalysisAgent\"}\n{\"timestamp\": \"2025-07-06T23:27:01.189405\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Pomy\\u015blnie sparsowano JSON z LLM\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.189430\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Pomy\\u015blnie sparsowano JSON z LLM\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.197618\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Nie znaleziono dopasowania dla sklepu: Nieznany sklep\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.197683\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Nie znaleziono dopasowania dla sklepu: Nieznany sklep\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.197758\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Znormalizowano nazw\\u0119 sklepu: Nieznany sklep -> Nieznany sklep (confidence: 0.0)\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.197775\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Znormalizowano nazw\\u0119 sklepu: Nieznany sklep -> Nieznany sklep (confidence: 0.0)\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.199049\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Fuzzy dopasowanie produktu: Mleko 3.2% -> Mleko 3.2%\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.199073\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Fuzzy dopasowanie produktu: Mleko 3.2% -> Mleko 3.2%\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.199171\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Statystyki normalizacji nazw produkt\\u00f3w: {'enhanced_normalizer': {'regex_patterns': 13, 'flashtext_keywords': 17, 'fuzzy_choices': 15, 'fuzzy_threshold': 80}, 'product_normalizer': {'normalizations_count': 80}, 'store_normalizer': {'stores_count': 40}, 'total_normalizers': 3}\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.199189\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Statystyki normalizacji nazw produkt\\u00f3w: {'enhanced_normalizer': {'regex_patterns': 13, 'flashtext_keywords': 17, 'fuzzy_choices': 15, 'fuzzy_threshold': 80}, 'product_normalizer': {'normalizations_count': 80}, 'store_normalizer': {'stores_count': 40}, 'total_normalizers': 3}\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.219231\", \"level\": \"INFO\", \"logger\": \"backend.core.google_taxonomy_enhancer\", \"module\": \"google_taxonomy_enhancer\", \"message\": \"Za\\u0142adowano 5595 kategorii z Google Product Taxonomy\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.219289\", \"level\": \"INFO\", \"logger\": \"backend.core.google_taxonomy_enhancer\", \"module\": \"google_taxonomy_enhancer\", \"message\": \"Za\\u0142adowano 5595 kategorii z Google Product Taxonomy\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.219372\", \"level\": \"INFO\", \"logger\": \"backend.core.google_taxonomy_enhancer\", \"module\": \"google_taxonomy_enhancer\", \"message\": \"Za\\u0142adowano 35 polskich t\\u0142umacze\\u0144\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.219408\", \"level\": \"INFO\", \"logger\": \"backend.core.google_taxonomy_enhancer\", \"module\": \"google_taxonomy_enhancer\", \"message\": \"Za\\u0142adowano 35 polskich t\\u0142umacze\\u0144\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.219463\", \"level\": \"INFO\", \"logger\": \"backend.core.google_taxonomy_enhancer\", \"module\": \"google_taxonomy_enhancer\", \"message\": \"Google Taxonomy Enhancer zainicjalizowany: 5595 kategorii, 774 kategorii \\u017cywno\\u015bci\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.219478\", \"level\": \"INFO\", \"logger\": \"backend.core.google_taxonomy_enhancer\", \"module\": \"google_taxonomy_enhancer\", \"message\": \"Google Taxonomy Enhancer zainicjalizowany: 5595 kategorii, 774 kategorii \\u017cywno\\u015bci\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.219515\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Rozpoczynam wsadow\\u0105 kategoryzacj\\u0119 1 produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.219529\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Rozpoczynam wsadow\\u0105 kategoryzacj\\u0119 1 produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.542862\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Kategoryzacja Google Taxonomy: Mleko 3.2% -> Mleko\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.542972\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Kategoryzacja Google Taxonomy: Mleko 3.2% -> Mleko\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.543084\", \"level\": \"ERROR\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"B\\u0142\\u0105d podczas kategoryzacji produktu 'Mleko 3.2%': 'path'\", \"levelno\": 40, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.543107\", \"level\": \"ERROR\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"B\\u0142\\u0105d podczas kategoryzacji produktu 'Mleko 3.2%': 'path'\", \"levelno\": 40, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.543186\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Wsadowa kategoryzacja zako\\u0144czona: 1 produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.543203\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Wsadowa kategoryzacja zako\\u0144czona: 1 produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.543249\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Statystyki kategoryzacji: {'Pieczywo > Chleby': 1}\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.543262\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Statystyki kategoryzacji: {'Pieczywo > Chleby': 1}\", \"levelno\": 20, \"taskName\": \"Task-62\"}\n{\"timestamp\": \"2025-07-06T23:27:01.543299\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Analiza paragonu zako\\u0144czona\", \"levelno\": 20, \"taskName\": \"Task-62\", \"store_name\": \"Nieznany sklep\", \"normalized_store\": \"Nieznany sklep\", \"items_count\": 1, \"total_amount\": 0.0}\n{\"timestamp\": \"2025-07-06T23:27:01.543317\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Analiza paragonu zako\\u0144czona\", \"levelno\": 20, \"taskName\": \"Task-62\", \"store_name\": \"Nieznany sklep\", \"normalized_store\": \"Nieznany sklep\", \"items_count\": 1, \"total_amount\": 0.0}\n------------------------------ Captured log call -------------------------------\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:55 Rozpoczynam analizę paragonu\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:170 Pomyślnie sparsowano JSON z LLM\nINFO     backend.core.store_normalizer:store_normalizer.py:130 Nie znaleziono dopasowania dla sklepu: Nieznany sklep\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:638 Znormalizowano nazwę sklepu: Nieznany sklep -> Nieznany sklep (confidence: 0.0)\nINFO     backend.core.product_name_normalizer:product_name_normalizer.py:123 Fuzzy dopasowanie produktu: Mleko 3.2% -> Mleko 3.2%\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:673 Statystyki normalizacji nazw produktów: {'enhanced_normalizer': {'regex_patterns': 13, 'flashtext_keywords': 17, 'fuzzy_choices': 15, 'fuzzy_threshold': 80}, 'product_normalizer': {'normalizations_count': 80}, 'store_normalizer': {'stores_count': 40}, 'total_normalizers': 3}\nINFO     backend.core.google_taxonomy_enhancer:google_taxonomy_enhancer.py:131 Załadowano 5595 kategorii z Google Product Taxonomy\nINFO     backend.core.google_taxonomy_enhancer:google_taxonomy_enhancer.py:179 Załadowano 35 polskich tłumaczeń\nINFO     backend.core.google_taxonomy_enhancer:google_taxonomy_enhancer.py:90 Google Taxonomy Enhancer zainicjalizowany: 5595 kategorii, 774 kategorii żywności\nINFO     backend.core.product_categorizer:product_categorizer.py:335 Rozpoczynam wsadową kategoryzację 1 produktów\nINFO     backend.core.product_categorizer:product_categorizer.py:119 Kategoryzacja Google Taxonomy: Mleko 3.2% -> Mleko\nERROR    backend.core.product_categorizer:product_categorizer.py:144 Błąd podczas kategoryzacji produktu 'Mleko 3.2%': 'path'\nINFO     backend.core.product_categorizer:product_categorizer.py:363 Wsadowa kategoryzacja zakończona: 1 produktów\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:544 Statystyki kategoryzacji: {'Pieczywo > Chleby': 1}\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:114 Analiza paragonu zakończona\n__ TestReceiptAnalysisAgentEnhanced.test_fallback_parser_with_common_products __\ntests/unit/test_receipt_analysis_enhanced.py:175: in test_fallback_parser_with_common_products\n    assert (\nE   assert 0 >= 3\nE    +  where 0 = len([])\n---------------------------- Captured stdout setup -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:05.379683\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:05.379740\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:05.379938\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:05.379959\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:05.380035\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:05.380050\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:05.380085\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:05.380099\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:05.380305\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:05.380323\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:05.380361\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:05.380374\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:05.380592\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:05.380614\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:05.380658\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:05.380671\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n------------------------------ Captured log setup ------------------------------\nINFO     backend.core.product_categorizer:product_categorizer.py:23 Załadowano 35 kategorii produktów\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:109 Loaded configuration from data/config/enhanced_normalizer_config.json\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:72 EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:70 EnhancedNameNormalizer zainicjalizowany\nINFO     backend.core.product_name_normalizer:product_name_normalizer.py:20 Załadowano 80 reguł normalizacji nazw produktów\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:80 ProductNameNormalizer zainicjalizowany\nINFO     backend.core.store_normalizer:store_normalizer.py:17 Załadowano 40 sklepów do normalizacji\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:90 StoreNormalizer zainicjalizowany\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:05.381191\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:05.381221\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:05.384127\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:05.384155\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:05.384232\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:05.384248\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:05.384283\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:05.384297\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:05.384497\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:05.384519\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:05.384557\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:05.384571\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:05.384758\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:05.384777\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:05.384811\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:05.384824\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:05.384858\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Rozpoczynam analiz\\u0119 paragonu\", \"levelno\": 20, \"taskName\": \"Task-78\", \"text_length\": 195, \"agent_name\": \"ReceiptAnalysisAgent\"}\n{\"timestamp\": \"2025-07-06T23:27:05.384881\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Rozpoczynam analiz\\u0119 paragonu\", \"levelno\": 20, \"taskName\": \"Task-78\", \"text_length\": 195, \"agent_name\": \"ReceiptAnalysisAgent\"}\n2025-07-06 23:27:05 [debug    ] Health check failed for model SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c525810>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:05 [debug    ] Health check failed for model SpeakLeash/bielik-4.5b-v3.0-instruct:Q8_0: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c526490>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:05 [debug    ] Health check failed for model gemma3:12b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2cef4d60>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:05 [debug    ] Health check failed for model gemma3:8b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2cef7230>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:05 [debug    ] Health check failed for model llama3.2:3b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2cedb2f0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:05 [debug    ] Health check failed for model mistral:7b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c571480>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:05 [warning  ] No healthy models found, using SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M\n2025-07-06 23:27:05 [info     ] ollama_prompt                  messages=[{'role': 'system', 'content': 'Jesteś specjalistycznym asystentem do analizy paragonów z polskich sklepów. Wyciągnij strukturalne dane z tekstu paragonu.'}, {'role': 'user', 'content': 'Jesteś ekspertem od analizy paragonów. Wyciągnij dane w JSON:\\n- store: nazwa sklepu\\n- address: adres sklepu\\n- date: data w formacie YYYY-MM-DD HH:MM\\n- items: lista produktów (name, quantity, unit_price, total_price, tax_category)\\n- discounts: rabaty (description, amount)\\n- coupons: kupony (code, amount)\\n- vat_summary: podsumowanie VAT (tax_category, net, tax_amount, gross)\\n- total: suma do zapłaty\\nZwróć tylko JSON, bez komentarzy.\\n\\nAnalizuj paragon i zwróć JSON:\\n\\n\\n        MLEKO 3.2% 1L - 4.50 PLN\\n        CHLEB PSZENNY - 3.20 PLN\\n        JABŁKA 1KG - 5.80 PLN\\n        MASŁO 82% - 8.90 PLN\\n        JOGURT NATURALNY - 2.50 PLN\\n        RAZEM: 24.90 PLN\\n        \\n\\nFormat:\\n{\\n  \"store\": \"\",\\n  \"address\": \"\",\\n  \"date\": \"\",\\n  \"items\": [{\"name\": \"\", \"quantity\": 0.0, \"unit_price\": 0.0, \"total_price\": 0.0, \"tax_category\": \"\"}],\\n  \"discounts\": [{\"description\": \"\", \"amount\": 0.0}],\\n  \"coupons\": [{\"code\": \"\", \"amount\": 0.0}],\\n  \"vat_summary\": [{\"tax_category\": \"\", \"net\": 0.0, \"tax_amount\": 0.0, \"gross\": 0.0}],\\n  \"total\": 0.0\\n}'}] model=SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M options={'temperature': 0.1, 'top_p': 0.9, 'top_k': 40, 'repeat_penalty': 1.1, 'num_predict': 512} stream=False\n2025-07-06 23:27:05 [debug    ] Ollama availability check attempt 1 failed: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/version (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c571ae0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:06 [debug    ] Ollama availability check attempt 2 failed: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/version (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c570160>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:07 [debug    ] Ollama availability check attempt 3 failed: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/version (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c570050>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:07 [error    ] Ollama server not available for model SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M\n{\"timestamp\": \"2025-07-06T23:27:07.394839\", \"level\": \"WARNING\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Nie znaleziono JSON w odpowiedzi LLM, u\\u017cywam fallback\", \"levelno\": 30, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:07.394872\", \"level\": \"WARNING\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Nie znaleziono JSON w odpowiedzi LLM, u\\u017cywam fallback\", \"levelno\": 30, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:07.398215\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Nie znaleziono dopasowania dla sklepu: Nieznany Sklep\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:07.398249\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Nie znaleziono dopasowania dla sklepu: Nieznany Sklep\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:07.398311\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Znormalizowano nazw\\u0119 sklepu: Nieznany Sklep -> Nieznany sklep (confidence: 0.0)\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:07.398328\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Znormalizowano nazw\\u0119 sklepu: Nieznany Sklep -> Nieznany sklep (confidence: 0.0)\", \"levelno\": 20, \"taskName\": \"Task-78\"}\n{\"timestamp\": \"2025-07-06T23:27:07.398369\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Analiza paragonu zako\\u0144czona\", \"levelno\": 20, \"taskName\": \"Task-78\", \"store_name\": \"Nieznany Sklep\", \"normalized_store\": \"Nieznany sklep\", \"items_count\": 0, \"total_amount\": 0}\n{\"timestamp\": \"2025-07-06T23:27:07.398392\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Analiza paragonu zako\\u0144czona\", \"levelno\": 20, \"taskName\": \"Task-78\", \"store_name\": \"Nieznany Sklep\", \"normalized_store\": \"Nieznany sklep\", \"items_count\": 0, \"total_amount\": 0}\n------------------------------ Captured log call -------------------------------\nINFO     backend.core.product_categorizer:product_categorizer.py:23 Załadowano 35 kategorii produktów\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:109 Loaded configuration from data/config/enhanced_normalizer_config.json\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:72 EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:70 EnhancedNameNormalizer zainicjalizowany\nINFO     backend.core.product_name_normalizer:product_name_normalizer.py:20 Załadowano 80 reguł normalizacji nazw produktów\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:80 ProductNameNormalizer zainicjalizowany\nINFO     backend.core.store_normalizer:store_normalizer.py:17 Załadowano 40 sklepów do normalizacji\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:90 StoreNormalizer zainicjalizowany\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:55 Rozpoczynam analizę paragonu\nWARNING  backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:178 Nie znaleziono JSON w odpowiedzi LLM, używam fallback\nINFO     backend.core.store_normalizer:store_normalizer.py:130 Nie znaleziono dopasowania dla sklepu: Nieznany Sklep\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:638 Znormalizowano nazwę sklepu: Nieznany Sklep -> Nieznany sklep (confidence: 0.0)\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:114 Analiza paragonu zakończona\n__ TestReceiptAnalysisAgentEnhanced.test_fallback_parser_with_price_patterns ___\ntests/unit/test_receipt_analysis_enhanced.py:198: in test_fallback_parser_with_price_patterns\n    assert len(result.data[\"items\"]) >= 2\nE   assert 0 >= 2\nE    +  where 0 = len([])\n---------------------------- Captured stdout setup -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:07.413823\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:07.413881\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:07.414122\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:07.414148\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:07.414238\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:07.414259\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:07.414303\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:07.414321\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:07.414621\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:07.414649\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:07.414700\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:07.414718\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:07.415026\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:07.415054\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:07.415111\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:07.415135\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n------------------------------ Captured log setup ------------------------------\nINFO     backend.core.product_categorizer:product_categorizer.py:23 Załadowano 35 kategorii produktów\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:109 Loaded configuration from data/config/enhanced_normalizer_config.json\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:72 EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:70 EnhancedNameNormalizer zainicjalizowany\nINFO     backend.core.product_name_normalizer:product_name_normalizer.py:20 Załadowano 80 reguł normalizacji nazw produktów\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:80 ProductNameNormalizer zainicjalizowany\nINFO     backend.core.store_normalizer:store_normalizer.py:17 Załadowano 40 sklepów do normalizacji\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:90 StoreNormalizer zainicjalizowany\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:07.415840\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:07.415880\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:07.416094\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:07.416126\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:07.416230\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:07.416256\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:07.416311\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:07.416334\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:07.416634\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:07.416664\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:07.416722\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:07.416745\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:07.417048\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:07.417075\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:07.417129\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:07.417152\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:07.417209\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Rozpoczynam analiz\\u0119 paragonu\", \"levelno\": 20, \"taskName\": \"Task-82\", \"text_length\": 154, \"agent_name\": \"ReceiptAnalysisAgent\"}\n{\"timestamp\": \"2025-07-06T23:27:07.417243\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Rozpoczynam analiz\\u0119 paragonu\", \"levelno\": 20, \"taskName\": \"Task-82\", \"text_length\": 154, \"agent_name\": \"ReceiptAnalysisAgent\"}\n2025-07-06 23:27:07 [debug    ] Health check failed for model SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c570c00>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:07 [debug    ] Health check failed for model SpeakLeash/bielik-4.5b-v3.0-instruct:Q8_0: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c571480>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:07 [debug    ] Health check failed for model gemma3:12b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c5708d0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:07 [debug    ] Health check failed for model gemma3:8b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c573f00>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:07 [debug    ] Health check failed for model llama3.2:3b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c573ce0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:07 [debug    ] Health check failed for model mistral:7b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c573ac0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:07 [warning  ] No healthy models found, using SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M\n2025-07-06 23:27:07 [info     ] ollama_prompt                  messages=[{'role': 'system', 'content': 'Jesteś specjalistycznym asystentem do analizy paragonów z polskich sklepów. Wyciągnij strukturalne dane z tekstu paragonu.'}, {'role': 'user', 'content': 'Jesteś ekspertem od analizy paragonów. Wyciągnij dane w JSON:\\n- store: nazwa sklepu\\n- address: adres sklepu\\n- date: data w formacie YYYY-MM-DD HH:MM\\n- items: lista produktów (name, quantity, unit_price, total_price, tax_category)\\n- discounts: rabaty (description, amount)\\n- coupons: kupony (code, amount)\\n- vat_summary: podsumowanie VAT (tax_category, net, tax_amount, gross)\\n- total: suma do zapłaty\\nZwróć tylko JSON, bez komentarzy.\\n\\nAnalizuj paragon i zwróć JSON:\\n\\n\\n        PRODUKT 1 - 10.99 zł\\n        PRODUKT 2 x2 - 15.50 PLN\\n        PRODUKT 3 1szt - 5.00\\n        PRODUKT 4 - 12,50 zł\\n        SUMA: 44.49 PLN\\n        \\n\\nFormat:\\n{\\n  \"store\": \"\",\\n  \"address\": \"\",\\n  \"date\": \"\",\\n  \"items\": [{\"name\": \"\", \"quantity\": 0.0, \"unit_price\": 0.0, \"total_price\": 0.0, \"tax_category\": \"\"}],\\n  \"discounts\": [{\"description\": \"\", \"amount\": 0.0}],\\n  \"coupons\": [{\"code\": \"\", \"amount\": 0.0}],\\n  \"vat_summary\": [{\"tax_category\": \"\", \"net\": 0.0, \"tax_amount\": 0.0, \"gross\": 0.0}],\\n  \"total\": 0.0\\n}'}] model=SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M options={'temperature': 0.1, 'top_p': 0.9, 'top_k': 40, 'repeat_penalty': 1.1, 'num_predict': 512} stream=False\n2025-07-06 23:27:07 [debug    ] Ollama availability check attempt 1 failed: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/version (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c570f30>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:08 [debug    ] Ollama availability check attempt 2 failed: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/version (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c573130>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:09 [debug    ] Ollama availability check attempt 3 failed: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/version (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c573570>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:09 [error    ] Ollama server not available for model SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M\n{\"timestamp\": \"2025-07-06T23:27:09.427878\", \"level\": \"WARNING\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Nie znaleziono JSON w odpowiedzi LLM, u\\u017cywam fallback\", \"levelno\": 30, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:09.427915\", \"level\": \"WARNING\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Nie znaleziono JSON w odpowiedzi LLM, u\\u017cywam fallback\", \"levelno\": 30, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:09.432317\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Nie znaleziono dopasowania dla sklepu: Nieznany Sklep\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:09.432360\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Nie znaleziono dopasowania dla sklepu: Nieznany Sklep\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:09.432435\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Znormalizowano nazw\\u0119 sklepu: Nieznany Sklep -> Nieznany sklep (confidence: 0.0)\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:09.432455\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Znormalizowano nazw\\u0119 sklepu: Nieznany Sklep -> Nieznany sklep (confidence: 0.0)\", \"levelno\": 20, \"taskName\": \"Task-82\"}\n{\"timestamp\": \"2025-07-06T23:27:09.432498\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Analiza paragonu zako\\u0144czona\", \"levelno\": 20, \"taskName\": \"Task-82\", \"store_name\": \"Nieznany Sklep\", \"normalized_store\": \"Nieznany sklep\", \"items_count\": 0, \"total_amount\": 0}\n{\"timestamp\": \"2025-07-06T23:27:09.432516\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Analiza paragonu zako\\u0144czona\", \"levelno\": 20, \"taskName\": \"Task-82\", \"store_name\": \"Nieznany Sklep\", \"normalized_store\": \"Nieznany sklep\", \"items_count\": 0, \"total_amount\": 0}\n------------------------------ Captured log call -------------------------------\nINFO     backend.core.product_categorizer:product_categorizer.py:23 Załadowano 35 kategorii produktów\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:109 Loaded configuration from data/config/enhanced_normalizer_config.json\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:72 EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:70 EnhancedNameNormalizer zainicjalizowany\nINFO     backend.core.product_name_normalizer:product_name_normalizer.py:20 Załadowano 80 reguł normalizacji nazw produktów\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:80 ProductNameNormalizer zainicjalizowany\nINFO     backend.core.store_normalizer:store_normalizer.py:17 Załadowano 40 sklepów do normalizacji\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:90 StoreNormalizer zainicjalizowany\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:55 Rozpoczynam analizę paragonu\nWARNING  backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:178 Nie znaleziono JSON w odpowiedzi LLM, używam fallback\nINFO     backend.core.store_normalizer:store_normalizer.py:130 Nie znaleziono dopasowania dla sklepu: Nieznany Sklep\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:638 Znormalizowano nazwę sklepu: Nieznany Sklep -> Nieznany sklep (confidence: 0.0)\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:114 Analiza paragonu zakończona\n__ TestReceiptAnalysisAgentEnhanced.test_date_validation_with_various_formats __\ntests/unit/test_receipt_analysis_enhanced.py:227: in test_date_validation_with_various_formats\n    assert \"date\" in result.data\nE   AssertionError: assert 'date' in {'items': [], 'normalized_store_name': 'Nieznany sklep', 'normalized_store_name_en': 'Unknown store', 'store_chain': 'Unknown', ...}\nE    +  where {'items': [], 'normalized_store_name': 'Nieznany sklep', 'normalized_store_name_en': 'Unknown store', 'store_chain': 'Unknown', ...} = AgentResponse(success=True, text='Paragon został pomyślnie przeanalizowany', data={'store_name': 'Nieznany Sklep', 'items': [], 'normalized_store_name': 'Nieznany sklep', 'normalized_store_name_en': 'Unknown store', 'store_chain': 'Unknown', 'store_type': 'unknown', 'store_confidence': 0.0, 'store_normalization_method': 'unknown', 'store_normalizer': 'store'}, error=None, severity=None, message=None, text_stream=None, metadata=None, timestamp=None, processing_time=None, model_used=None, confidence=None, fallback_used=None, retries=None, warnings=None, raw_response=None, status_code=None, content_type=None, encoding=None, cost=None, tokens_used=None, version='1.0.0', api_version=None, request_id=None, trace_id=None, span_id=None, parent_span_id=None, is_cached=None, cache_key=None, cache_ttl=None).data\n---------------------------- Captured stdout setup -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:09.448191\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:09.448246\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:09.448484\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:09.448517\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:09.448625\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:09.448649\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:09.448704\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:09.448727\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:09.449059\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:09.449087\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:09.449145\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:09.449167\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:09.449478\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:09.449502\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:09.449544\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:09.449558\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n------------------------------ Captured log setup ------------------------------\nINFO     backend.core.product_categorizer:product_categorizer.py:23 Załadowano 35 kategorii produktów\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:109 Loaded configuration from data/config/enhanced_normalizer_config.json\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:72 EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:70 EnhancedNameNormalizer zainicjalizowany\nINFO     backend.core.product_name_normalizer:product_name_normalizer.py:20 Załadowano 80 reguł normalizacji nazw produktów\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:80 ProductNameNormalizer zainicjalizowany\nINFO     backend.core.store_normalizer:store_normalizer.py:17 Załadowano 40 sklepów do normalizacji\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:90 StoreNormalizer zainicjalizowany\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:09.450044\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:09.450075\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:09.450234\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:09.450259\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:09.450328\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:09.450344\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:09.450378\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:09.450403\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:09.450589\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:09.450607\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:09.450642\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:09.450656\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:09.450849\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:09.450868\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:09.450902\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:09.450915\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:09.450951\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Rozpoczynam analiz\\u0119 paragonu\", \"levelno\": 20, \"taskName\": \"Task-86\", \"text_length\": 139, \"agent_name\": \"ReceiptAnalysisAgent\"}\n{\"timestamp\": \"2025-07-06T23:27:09.450974\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Rozpoczynam analiz\\u0119 paragonu\", \"levelno\": 20, \"taskName\": \"Task-86\", \"text_length\": 139, \"agent_name\": \"ReceiptAnalysisAgent\"}\n2025-07-06 23:27:09 [debug    ] Health check failed for model SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c5706b0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:09 [debug    ] Health check failed for model SpeakLeash/bielik-4.5b-v3.0-instruct:Q8_0: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c572250>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:09 [debug    ] Health check failed for model gemma3:12b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c570f30>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:09 [debug    ] Health check failed for model gemma3:8b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c573ac0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:09 [debug    ] Health check failed for model llama3.2:3b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c573ce0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:09 [debug    ] Health check failed for model mistral:7b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c573f00>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:09 [warning  ] No healthy models found, using SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M\n2025-07-06 23:27:09 [info     ] ollama_prompt                  messages=[{'role': 'system', 'content': 'Jesteś specjalistycznym asystentem do analizy paragonów z polskich sklepów. Wyciągnij strukturalne dane z tekstu paragonu.'}, {'role': 'user', 'content': 'Jesteś ekspertem od analizy paragonów. Wyciągnij dane w JSON:\\n- store: nazwa sklepu\\n- address: adres sklepu\\n- date: data w formacie YYYY-MM-DD HH:MM\\n- items: lista produktów (name, quantity, unit_price, total_price, tax_category)\\n- discounts: rabaty (description, amount)\\n- coupons: kupony (code, amount)\\n- vat_summary: podsumowanie VAT (tax_category, net, tax_amount, gross)\\n- total: suma do zapłaty\\nZwróć tylko JSON, bez komentarzy.\\n\\nAnalizuj paragon i zwróć JSON:\\n\\n\\n            DATA: 15.01.2024\\n            PRODUKT 1 - 10.00 PLN\\n            PRODUKT 2 - 15.00 PLN\\n            RAZEM: 25.00 PLN\\n            \\n\\nFormat:\\n{\\n  \"store\": \"\",\\n  \"address\": \"\",\\n  \"date\": \"\",\\n  \"items\": [{\"name\": \"\", \"quantity\": 0.0, \"unit_price\": 0.0, \"total_price\": 0.0, \"tax_category\": \"\"}],\\n  \"discounts\": [{\"description\": \"\", \"amount\": 0.0}],\\n  \"coupons\": [{\"code\": \"\", \"amount\": 0.0}],\\n  \"vat_summary\": [{\"tax_category\": \"\", \"net\": 0.0, \"tax_amount\": 0.0, \"gross\": 0.0}],\\n  \"total\": 0.0\\n}'}] model=SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M options={'temperature': 0.1, 'top_p': 0.9, 'top_k': 40, 'repeat_penalty': 1.1, 'num_predict': 512} stream=False\n2025-07-06 23:27:09 [debug    ] Ollama availability check attempt 1 failed: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/version (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c5705a0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:10 [debug    ] Ollama availability check attempt 2 failed: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/version (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c571370>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:11 [debug    ] Ollama availability check attempt 3 failed: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/version (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c571480>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:11 [error    ] Ollama server not available for model SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M\n{\"timestamp\": \"2025-07-06T23:27:11.459808\", \"level\": \"WARNING\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Nie znaleziono JSON w odpowiedzi LLM, u\\u017cywam fallback\", \"levelno\": 30, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:11.459843\", \"level\": \"WARNING\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Nie znaleziono JSON w odpowiedzi LLM, u\\u017cywam fallback\", \"levelno\": 30, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:11.463181\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Nie znaleziono dopasowania dla sklepu: Nieznany Sklep\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:11.463209\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Nie znaleziono dopasowania dla sklepu: Nieznany Sklep\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:11.463265\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Znormalizowano nazw\\u0119 sklepu: Nieznany Sklep -> Nieznany sklep (confidence: 0.0)\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:11.463283\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Znormalizowano nazw\\u0119 sklepu: Nieznany Sklep -> Nieznany sklep (confidence: 0.0)\", \"levelno\": 20, \"taskName\": \"Task-86\"}\n{\"timestamp\": \"2025-07-06T23:27:11.463327\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Analiza paragonu zako\\u0144czona\", \"levelno\": 20, \"taskName\": \"Task-86\", \"store_name\": \"Nieznany Sklep\", \"normalized_store\": \"Nieznany sklep\", \"items_count\": 0, \"total_amount\": 0}\n{\"timestamp\": \"2025-07-06T23:27:11.463346\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Analiza paragonu zako\\u0144czona\", \"levelno\": 20, \"taskName\": \"Task-86\", \"store_name\": \"Nieznany Sklep\", \"normalized_store\": \"Nieznany sklep\", \"items_count\": 0, \"total_amount\": 0}\n------------------------------ Captured log call -------------------------------\nINFO     backend.core.product_categorizer:product_categorizer.py:23 Załadowano 35 kategorii produktów\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:109 Loaded configuration from data/config/enhanced_normalizer_config.json\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:72 EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:70 EnhancedNameNormalizer zainicjalizowany\nINFO     backend.core.product_name_normalizer:product_name_normalizer.py:20 Załadowano 80 reguł normalizacji nazw produktów\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:80 ProductNameNormalizer zainicjalizowany\nINFO     backend.core.store_normalizer:store_normalizer.py:17 Załadowano 40 sklepów do normalizacji\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:90 StoreNormalizer zainicjalizowany\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:55 Rozpoczynam analizę paragonu\nWARNING  backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:178 Nie znaleziono JSON w odpowiedzi LLM, używam fallback\nINFO     backend.core.store_normalizer:store_normalizer.py:130 Nie znaleziono dopasowania dla sklepu: Nieznany Sklep\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:638 Znormalizowano nazwę sklepu: Nieznany Sklep -> Nieznany sklep (confidence: 0.0)\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:114 Analiza paragonu zakończona\n_______ TestReceiptAnalysisAgentEnhanced.test_fallback_parser_robustness _______\ntests/unit/test_receipt_analysis_enhanced.py:249: in test_fallback_parser_robustness\n    assert len(result.data[\"items\"]) >= 1\nE   assert 0 >= 1\nE    +  where 0 = len([])\n---------------------------- Captured stdout setup -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:11.478745\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:11.478801\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:11.478988\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:11.479009\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:11.479080\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:11.479096\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:11.479130\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:11.479144\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:11.479357\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:11.479376\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:11.479426\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:11.479441\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:11.479657\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:11.479675\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:11.479711\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:11.479725\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n------------------------------ Captured log setup ------------------------------\nINFO     backend.core.product_categorizer:product_categorizer.py:23 Załadowano 35 kategorii produktów\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:109 Loaded configuration from data/config/enhanced_normalizer_config.json\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:72 EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:70 EnhancedNameNormalizer zainicjalizowany\nINFO     backend.core.product_name_normalizer:product_name_normalizer.py:20 Załadowano 80 reguł normalizacji nazw produktów\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:80 ProductNameNormalizer zainicjalizowany\nINFO     backend.core.store_normalizer:store_normalizer.py:17 Załadowano 40 sklepów do normalizacji\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:90 StoreNormalizer zainicjalizowany\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:11.480190\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:11.480222\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:11.480363\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:11.480389\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:11.480461\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:11.480476\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:11.480508\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:11.480520\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:11.480702\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:11.480719\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:11.480755\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:11.480768\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:11.480954\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:11.480971\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:11.481006\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:11.481019\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:11.481054\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Rozpoczynam analiz\\u0119 paragonu\", \"levelno\": 20, \"taskName\": \"Task-90\", \"text_length\": 125, \"agent_name\": \"ReceiptAnalysisAgent\"}\n{\"timestamp\": \"2025-07-06T23:27:11.481077\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Rozpoczynam analiz\\u0119 paragonu\", \"levelno\": 20, \"taskName\": \"Task-90\", \"text_length\": 125, \"agent_name\": \"ReceiptAnalysisAgent\"}\n2025-07-06 23:27:11 [debug    ] Health check failed for model SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c5708d0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:11 [debug    ] Health check failed for model SpeakLeash/bielik-4.5b-v3.0-instruct:Q8_0: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c573f00>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:11 [debug    ] Health check failed for model gemma3:12b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c5709e0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:11 [debug    ] Health check failed for model gemma3:8b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c573240>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:11 [debug    ] Health check failed for model llama3.2:3b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c5739b0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:11 [debug    ] Health check failed for model mistral:7b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c573790>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:11 [warning  ] No healthy models found, using SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M\n2025-07-06 23:27:11 [info     ] ollama_prompt                  messages=[{'role': 'system', 'content': 'Jesteś specjalistycznym asystentem do analizy paragonów z polskich sklepów. Wyciągnij strukturalne dane z tekstu paragonu.'}, {'role': 'user', 'content': 'Jesteś ekspertem od analizy paragonów. Wyciągnij dane w JSON:\\n- store: nazwa sklepu\\n- address: adres sklepu\\n- date: data w formacie YYYY-MM-DD HH:MM\\n- items: lista produktów (name, quantity, unit_price, total_price, tax_category)\\n- discounts: rabaty (description, amount)\\n- coupons: kupony (code, amount)\\n- vat_summary: podsumowanie VAT (tax_category, net, tax_amount, gross)\\n- total: suma do zapłaty\\nZwróć tylko JSON, bez komentarzy.\\n\\nAnalizuj paragon i zwróć JSON:\\n\\n\\n        RÓŻNE PRODUKTY:\\n        - ITEM 1: 5.50\\n        - ITEM 2: 10.25\\n        - ITEM 3: 7.80\\n        KONIEC: 23.55\\n        \\n\\nFormat:\\n{\\n  \"store\": \"\",\\n  \"address\": \"\",\\n  \"date\": \"\",\\n  \"items\": [{\"name\": \"\", \"quantity\": 0.0, \"unit_price\": 0.0, \"total_price\": 0.0, \"tax_category\": \"\"}],\\n  \"discounts\": [{\"description\": \"\", \"amount\": 0.0}],\\n  \"coupons\": [{\"code\": \"\", \"amount\": 0.0}],\\n  \"vat_summary\": [{\"tax_category\": \"\", \"net\": 0.0, \"tax_amount\": 0.0, \"gross\": 0.0}],\\n  \"total\": 0.0\\n}'}] model=SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M options={'temperature': 0.1, 'top_p': 0.9, 'top_k': 40, 'repeat_penalty': 1.1, 'num_predict': 512} stream=False\n2025-07-06 23:27:11 [debug    ] Ollama availability check attempt 1 failed: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/version (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c5705a0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:12 [debug    ] Ollama availability check attempt 2 failed: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/version (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c088050>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:13 [debug    ] Ollama availability check attempt 3 failed: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/version (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c088270>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:13 [error    ] Ollama server not available for model SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M\n{\"timestamp\": \"2025-07-06T23:27:13.490061\", \"level\": \"WARNING\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Nie znaleziono JSON w odpowiedzi LLM, u\\u017cywam fallback\", \"levelno\": 30, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:13.490093\", \"level\": \"WARNING\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Nie znaleziono JSON w odpowiedzi LLM, u\\u017cywam fallback\", \"levelno\": 30, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:13.493543\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Nie znaleziono dopasowania dla sklepu: Nieznany Sklep\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:13.493573\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Nie znaleziono dopasowania dla sklepu: Nieznany Sklep\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:13.493634\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Znormalizowano nazw\\u0119 sklepu: Nieznany Sklep -> Nieznany sklep (confidence: 0.0)\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:13.493651\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Znormalizowano nazw\\u0119 sklepu: Nieznany Sklep -> Nieznany sklep (confidence: 0.0)\", \"levelno\": 20, \"taskName\": \"Task-90\"}\n{\"timestamp\": \"2025-07-06T23:27:13.493693\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Analiza paragonu zako\\u0144czona\", \"levelno\": 20, \"taskName\": \"Task-90\", \"store_name\": \"Nieznany Sklep\", \"normalized_store\": \"Nieznany sklep\", \"items_count\": 0, \"total_amount\": 0}\n{\"timestamp\": \"2025-07-06T23:27:13.493712\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Analiza paragonu zako\\u0144czona\", \"levelno\": 20, \"taskName\": \"Task-90\", \"store_name\": \"Nieznany Sklep\", \"normalized_store\": \"Nieznany sklep\", \"items_count\": 0, \"total_amount\": 0}\n------------------------------ Captured log call -------------------------------\nINFO     backend.core.product_categorizer:product_categorizer.py:23 Załadowano 35 kategorii produktów\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:109 Loaded configuration from data/config/enhanced_normalizer_config.json\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:72 EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:70 EnhancedNameNormalizer zainicjalizowany\nINFO     backend.core.product_name_normalizer:product_name_normalizer.py:20 Załadowano 80 reguł normalizacji nazw produktów\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:80 ProductNameNormalizer zainicjalizowany\nINFO     backend.core.store_normalizer:store_normalizer.py:17 Załadowano 40 sklepów do normalizacji\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:90 StoreNormalizer zainicjalizowany\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:55 Rozpoczynam analizę paragonu\nWARNING  backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:178 Nie znaleziono JSON w odpowiedzi LLM, używam fallback\nINFO     backend.core.store_normalizer:store_normalizer.py:130 Nie znaleziono dopasowania dla sklepu: Nieznany Sklep\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:638 Znormalizowano nazwę sklepu: Nieznany Sklep -> Nieznany sklep (confidence: 0.0)\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:114 Analiza paragonu zakończona\n______ TestReceiptAnalysisAgentEnhanced.test_data_validation_future_date _______\ntests/unit/test_receipt_analysis_enhanced.py:285: in test_data_validation_future_date\n    assert \"date\" in result.data\nE   AssertionError: assert 'date' in {'items': [], 'normalized_store_name': 'Nieznany sklep', 'normalized_store_name_en': 'Unknown store', 'store_chain': 'Unknown', ...}\nE    +  where {'items': [], 'normalized_store_name': 'Nieznany sklep', 'normalized_store_name_en': 'Unknown store', 'store_chain': 'Unknown', ...} = AgentResponse(success=True, text='Paragon został pomyślnie przeanalizowany', data={'store_name': 'Nieznany Sklep', 'items': [], 'normalized_store_name': 'Nieznany sklep', 'normalized_store_name_en': 'Unknown store', 'store_chain': 'Unknown', 'store_type': 'unknown', 'store_confidence': 0.0, 'store_normalization_method': 'unknown', 'store_normalizer': 'store'}, error=None, severity=None, message=None, text_stream=None, metadata=None, timestamp=None, processing_time=None, model_used=None, confidence=None, fallback_used=None, retries=None, warnings=None, raw_response=None, status_code=None, content_type=None, encoding=None, cost=None, tokens_used=None, version='1.0.0', api_version=None, request_id=None, trace_id=None, span_id=None, parent_span_id=None, is_cached=None, cache_key=None, cache_ttl=None).data\n---------------------------- Captured stdout setup -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:13.521847\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:13.521912\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:13.522160\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:13.522192\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:13.522304\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:13.522331\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:13.522405\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:13.522435\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:13.522744\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:13.522773\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:13.522838\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:13.522864\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:13.523190\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:13.523221\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:13.523283\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:13.523309\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n------------------------------ Captured log setup ------------------------------\nINFO     backend.core.product_categorizer:product_categorizer.py:23 Załadowano 35 kategorii produktów\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:109 Loaded configuration from data/config/enhanced_normalizer_config.json\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:72 EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:70 EnhancedNameNormalizer zainicjalizowany\nINFO     backend.core.product_name_normalizer:product_name_normalizer.py:20 Załadowano 80 reguł normalizacji nazw produktów\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:80 ProductNameNormalizer zainicjalizowany\nINFO     backend.core.store_normalizer:store_normalizer.py:17 Załadowano 40 sklepów do normalizacji\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:90 StoreNormalizer zainicjalizowany\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:13.523895\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:13.523934\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:13.524114\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:13.524141\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:13.524228\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:13.524246\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:13.524297\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:13.524330\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:13.524651\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:13.524689\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:13.524752\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:13.524767\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:13.524993\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:13.525016\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:13.525058\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:13.525074\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:13.525113\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Rozpoczynam analiz\\u0119 paragonu\", \"levelno\": 20, \"taskName\": \"Task-98\", \"text_length\": 119, \"agent_name\": \"ReceiptAnalysisAgent\"}\n{\"timestamp\": \"2025-07-06T23:27:13.525138\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Rozpoczynam analiz\\u0119 paragonu\", \"levelno\": 20, \"taskName\": \"Task-98\", \"text_length\": 119, \"agent_name\": \"ReceiptAnalysisAgent\"}\n2025-07-06 23:27:13 [debug    ] Health check failed for model SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c572250>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:13 [debug    ] Health check failed for model SpeakLeash/bielik-4.5b-v3.0-instruct:Q8_0: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c571f20>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:13 [debug    ] Health check failed for model gemma3:12b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c570f30>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:13 [debug    ] Health check failed for model gemma3:8b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c573ac0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:13 [debug    ] Health check failed for model llama3.2:3b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c573ce0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:13 [debug    ] Health check failed for model mistral:7b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c570af0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:13 [warning  ] No healthy models found, using SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M\n2025-07-06 23:27:13 [info     ] ollama_prompt                  messages=[{'role': 'system', 'content': 'Jesteś specjalistycznym asystentem do analizy paragonów z polskich sklepów. Wyciągnij strukturalne dane z tekstu paragonu.'}, {'role': 'user', 'content': 'Jesteś ekspertem od analizy paragonów. Wyciągnij dane w JSON:\\n- store: nazwa sklepu\\n- address: adres sklepu\\n- date: data w formacie YYYY-MM-DD HH:MM\\n- items: lista produktów (name, quantity, unit_price, total_price, tax_category)\\n- discounts: rabaty (description, amount)\\n- coupons: kupony (code, amount)\\n- vat_summary: podsumowanie VAT (tax_category, net, tax_amount, gross)\\n- total: suma do zapłaty\\nZwróć tylko JSON, bez komentarzy.\\n\\nAnalizuj paragon i zwróć JSON:\\n\\n\\n        DATA: 2030-01-01\\n        PRODUKT 1 - 10.00 PLN\\n        PRODUKT 2 - 15.00 PLN\\n        RAZEM: 25.00 PLN\\n        \\n\\nFormat:\\n{\\n  \"store\": \"\",\\n  \"address\": \"\",\\n  \"date\": \"\",\\n  \"items\": [{\"name\": \"\", \"quantity\": 0.0, \"unit_price\": 0.0, \"total_price\": 0.0, \"tax_category\": \"\"}],\\n  \"discounts\": [{\"description\": \"\", \"amount\": 0.0}],\\n  \"coupons\": [{\"code\": \"\", \"amount\": 0.0}],\\n  \"vat_summary\": [{\"tax_category\": \"\", \"net\": 0.0, \"tax_amount\": 0.0, \"gross\": 0.0}],\\n  \"total\": 0.0\\n}'}] model=SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M options={'temperature': 0.1, 'top_p': 0.9, 'top_k': 40, 'repeat_penalty': 1.1, 'num_predict': 512} stream=False\n2025-07-06 23:27:13 [debug    ] Ollama availability check attempt 1 failed: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/version (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c5706b0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:14 [debug    ] Ollama availability check attempt 2 failed: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/version (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c0887c0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:15 [debug    ] Ollama availability check attempt 3 failed: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/version (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c0889e0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:15 [error    ] Ollama server not available for model SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M\n{\"timestamp\": \"2025-07-06T23:27:15.533962\", \"level\": \"WARNING\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Nie znaleziono JSON w odpowiedzi LLM, u\\u017cywam fallback\", \"levelno\": 30, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:15.534001\", \"level\": \"WARNING\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Nie znaleziono JSON w odpowiedzi LLM, u\\u017cywam fallback\", \"levelno\": 30, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:15.538848\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Nie znaleziono dopasowania dla sklepu: Nieznany Sklep\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:15.538884\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Nie znaleziono dopasowania dla sklepu: Nieznany Sklep\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:15.538938\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Znormalizowano nazw\\u0119 sklepu: Nieznany Sklep -> Nieznany sklep (confidence: 0.0)\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:15.538954\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Znormalizowano nazw\\u0119 sklepu: Nieznany Sklep -> Nieznany sklep (confidence: 0.0)\", \"levelno\": 20, \"taskName\": \"Task-98\"}\n{\"timestamp\": \"2025-07-06T23:27:15.538995\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Analiza paragonu zako\\u0144czona\", \"levelno\": 20, \"taskName\": \"Task-98\", \"store_name\": \"Nieznany Sklep\", \"normalized_store\": \"Nieznany sklep\", \"items_count\": 0, \"total_amount\": 0}\n{\"timestamp\": \"2025-07-06T23:27:15.539013\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Analiza paragonu zako\\u0144czona\", \"levelno\": 20, \"taskName\": \"Task-98\", \"store_name\": \"Nieznany Sklep\", \"normalized_store\": \"Nieznany sklep\", \"items_count\": 0, \"total_amount\": 0}\n------------------------------ Captured log call -------------------------------\nINFO     backend.core.product_categorizer:product_categorizer.py:23 Załadowano 35 kategorii produktów\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:109 Loaded configuration from data/config/enhanced_normalizer_config.json\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:72 EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:70 EnhancedNameNormalizer zainicjalizowany\nINFO     backend.core.product_name_normalizer:product_name_normalizer.py:20 Załadowano 80 reguł normalizacji nazw produktów\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:80 ProductNameNormalizer zainicjalizowany\nINFO     backend.core.store_normalizer:store_normalizer.py:17 Załadowano 40 sklepów do normalizacji\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:90 StoreNormalizer zainicjalizowany\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:55 Rozpoczynam analizę paragonu\nWARNING  backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:178 Nie znaleziono JSON w odpowiedzi LLM, używam fallback\nINFO     backend.core.store_normalizer:store_normalizer.py:130 Nie znaleziono dopasowania dla sklepu: Nieznany Sklep\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:638 Znormalizowano nazwę sklepu: Nieznany Sklep -> Nieznany sklep (confidence: 0.0)\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:114 Analiza paragonu zakończona\n__ TestReceiptAnalysisAgentEnhanced.test_complete_receipt_processing_workflow __\ntests/unit/test_receipt_analysis_enhanced.py:413: in test_complete_receipt_processing_workflow\n    assert \"date\" in result.data\nE   AssertionError: assert 'date' in {'items': [], 'normalized_store_name': 'Nieznany sklep', 'normalized_store_name_en': 'Unknown store', 'store_chain': 'Unknown', ...}\nE    +  where {'items': [], 'normalized_store_name': 'Nieznany sklep', 'normalized_store_name_en': 'Unknown store', 'store_chain': 'Unknown', ...} = AgentResponse(success=True, text='Paragon został pomyślnie przeanalizowany', data={'store_name': 'Nieznany Sklep', 'items': [], 'normalized_store_name': 'Nieznany sklep', 'normalized_store_name_en': 'Unknown store', 'store_chain': 'Unknown', 'store_type': 'unknown', 'store_confidence': 0.0, 'store_normalization_method': 'unknown', 'store_normalizer': 'store'}, error=None, severity=None, message=None, text_stream=None, metadata=None, timestamp=None, processing_time=None, model_used=None, confidence=None, fallback_used=None, retries=None, warnings=None, raw_response=None, status_code=None, content_type=None, encoding=None, cost=None, tokens_used=None, version='1.0.0', api_version=None, request_id=None, trace_id=None, span_id=None, parent_span_id=None, is_cached=None, cache_key=None, cache_ttl=None).data\n---------------------------- Captured stdout setup -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:17.852377\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:17.852620\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:17.852866\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:17.852896\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"Loaded configuration from data/config/enhanced_normalizer_config.json\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:17.852986\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:17.853006\", \"level\": \"INFO\", \"logger\": \"backend.core.enhanced_name_normalizer\", \"module\": \"enhanced_name_normalizer\", \"message\": \"EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:17.853049\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:17.853065\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"EnhancedNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:17.853267\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:17.853285\", \"level\": \"INFO\", \"logger\": \"backend.core.product_name_normalizer\", \"module\": \"product_name_normalizer\", \"message\": \"Za\\u0142adowano 80 regu\\u0142 normalizacji nazw produkt\\u00f3w\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:17.853321\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:17.853335\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"ProductNameNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:17.853537\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:17.853558\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Za\\u0142adowano 40 sklep\\u00f3w do normalizacji\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:17.853593\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:17.853626\", \"level\": \"INFO\", \"logger\": \"backend.core.normalizer_adapter\", \"module\": \"normalizer_adapter\", \"message\": \"StoreNormalizer zainicjalizowany\", \"levelno\": 20, \"taskName\": null}\n------------------------------ Captured log setup ------------------------------\nINFO     backend.core.product_categorizer:product_categorizer.py:23 Załadowano 35 kategorii produktów\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:109 Loaded configuration from data/config/enhanced_normalizer_config.json\nINFO     backend.core.enhanced_name_normalizer:enhanced_name_normalizer.py:72 EnhancedNameNormalizer initialized with 13 regex patterns, 17 FlashText keywords, 15 fuzzy choices\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:70 EnhancedNameNormalizer zainicjalizowany\nINFO     backend.core.product_name_normalizer:product_name_normalizer.py:20 Załadowano 80 reguł normalizacji nazw produktów\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:80 ProductNameNormalizer zainicjalizowany\nINFO     backend.core.store_normalizer:store_normalizer.py:17 Załadowano 40 sklepów do normalizacji\nINFO     backend.core.normalizer_adapter:normalizer_adapter.py:90 StoreNormalizer zainicjalizowany\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:17.854939\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Rozpoczynam analiz\\u0119 paragonu\", \"levelno\": 20, \"taskName\": \"Task-124\", \"text_length\": 164, \"agent_name\": \"ReceiptAnalysisAgent\"}\n{\"timestamp\": \"2025-07-06T23:27:17.854975\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Rozpoczynam analiz\\u0119 paragonu\", \"levelno\": 20, \"taskName\": \"Task-124\", \"text_length\": 164, \"agent_name\": \"ReceiptAnalysisAgent\"}\n2025-07-06 23:27:17 [debug    ] Health check failed for model SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c0899d0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:17 [debug    ] Health check failed for model SpeakLeash/bielik-4.5b-v3.0-instruct:Q8_0: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c089bf0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:17 [debug    ] Health check failed for model gemma3:12b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c089f20>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:17 [debug    ] Health check failed for model gemma3:8b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c088050>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:17 [debug    ] Health check failed for model llama3.2:3b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c0889e0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:17 [debug    ] Health check failed for model mistral:7b: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/tags (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c088e20>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:17 [warning  ] No healthy models found, using SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M\n2025-07-06 23:27:17 [info     ] ollama_prompt                  messages=[{'role': 'system', 'content': 'Jesteś specjalistycznym asystentem do analizy paragonów z polskich sklepów. Wyciągnij strukturalne dane z tekstu paragonu.'}, {'role': 'user', 'content': 'Jesteś ekspertem od analizy paragonów. Wyciągnij dane w JSON:\\n- store: nazwa sklepu\\n- address: adres sklepu\\n- date: data w formacie YYYY-MM-DD HH:MM\\n- items: lista produktów (name, quantity, unit_price, total_price, tax_category)\\n- discounts: rabaty (description, amount)\\n- coupons: kupony (code, amount)\\n- vat_summary: podsumowanie VAT (tax_category, net, tax_amount, gross)\\n- total: suma do zapłaty\\nZwróć tylko JSON, bez komentarzy.\\n\\nAnalizuj paragon i zwróć JSON:\\n\\n\\n        Lidl sp. z.o. o. sp. k.\\n        2024-01-15 14:30\\n        Mleko 3.2% 1L 1 * 4,99 4,99 A\\n        Chleb razowy 1 * 3,50 3,50 A\\n        RAZEM PLN 8,49\\n        \\n\\nFormat:\\n{\\n  \"store\": \"\",\\n  \"address\": \"\",\\n  \"date\": \"\",\\n  \"items\": [{\"name\": \"\", \"quantity\": 0.0, \"unit_price\": 0.0, \"total_price\": 0.0, \"tax_category\": \"\"}],\\n  \"discounts\": [{\"description\": \"\", \"amount\": 0.0}],\\n  \"coupons\": [{\"code\": \"\", \"amount\": 0.0}],\\n  \"vat_summary\": [{\"tax_category\": \"\", \"net\": 0.0, \"tax_amount\": 0.0, \"gross\": 0.0}],\\n  \"total\": 0.0\\n}'}] model=SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M options={'temperature': 0.1, 'top_p': 0.9, 'top_k': 40, 'repeat_penalty': 1.1, 'num_predict': 512} stream=False\n2025-07-06 23:27:17 [debug    ] Ollama availability check attempt 1 failed: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/version (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c0897b0>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:18 [debug    ] Ollama availability check attempt 2 failed: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/version (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c08a470>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:19 [debug    ] Ollama availability check attempt 3 failed: HTTPConnectionPool(host='ollama', port=11434): Max retries exceeded with url: /api/version (Caused by NameResolutionError(\"<urllib3.connection.HTTPConnection object at 0x733e2c08a690>: Failed to resolve 'ollama' ([Errno -3] Temporary failure in name resolution)\"))\n2025-07-06 23:27:19 [error    ] Ollama server not available for model SpeakLeash/bielik-11b-v2.3-instruct:Q5_K_M\n{\"timestamp\": \"2025-07-06T23:27:19.865328\", \"level\": \"WARNING\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Nie znaleziono JSON w odpowiedzi LLM, u\\u017cywam fallback\", \"levelno\": 30, \"taskName\": \"Task-124\"}\n{\"timestamp\": \"2025-07-06T23:27:19.865359\", \"level\": \"WARNING\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Nie znaleziono JSON w odpowiedzi LLM, u\\u017cywam fallback\", \"levelno\": 30, \"taskName\": \"Task-124\"}\n{\"timestamp\": \"2025-07-06T23:27:19.868635\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Nie znaleziono dopasowania dla sklepu: Nieznany Sklep\", \"levelno\": 20, \"taskName\": \"Task-124\"}\n{\"timestamp\": \"2025-07-06T23:27:19.868661\", \"level\": \"INFO\", \"logger\": \"backend.core.store_normalizer\", \"module\": \"store_normalizer\", \"message\": \"Nie znaleziono dopasowania dla sklepu: Nieznany Sklep\", \"levelno\": 20, \"taskName\": \"Task-124\"}\n{\"timestamp\": \"2025-07-06T23:27:19.868711\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Znormalizowano nazw\\u0119 sklepu: Nieznany Sklep -> Nieznany sklep (confidence: 0.0)\", \"levelno\": 20, \"taskName\": \"Task-124\"}\n{\"timestamp\": \"2025-07-06T23:27:19.868727\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Znormalizowano nazw\\u0119 sklepu: Nieznany Sklep -> Nieznany sklep (confidence: 0.0)\", \"levelno\": 20, \"taskName\": \"Task-124\"}\n{\"timestamp\": \"2025-07-06T23:27:19.868768\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Analiza paragonu zako\\u0144czona\", \"levelno\": 20, \"taskName\": \"Task-124\", \"store_name\": \"Nieznany Sklep\", \"normalized_store\": \"Nieznany sklep\", \"items_count\": 0, \"total_amount\": 0}\n{\"timestamp\": \"2025-07-06T23:27:19.868786\", \"level\": \"INFO\", \"logger\": \"backend.agents.receipt_analysis_agent\", \"module\": \"receipt_analysis_agent\", \"message\": \"Analiza paragonu zako\\u0144czona\", \"levelno\": 20, \"taskName\": \"Task-124\", \"store_name\": \"Nieznany Sklep\", \"normalized_store\": \"Nieznany sklep\", \"items_count\": 0, \"total_amount\": 0}\n------------------------------ Captured log call -------------------------------\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:55 Rozpoczynam analizę paragonu\nWARNING  backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:178 Nie znaleziono JSON w odpowiedzi LLM, używam fallback\nINFO     backend.core.store_normalizer:store_normalizer.py:130 Nie znaleziono dopasowania dla sklepu: Nieznany Sklep\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:638 Znormalizowano nazwę sklepu: Nieznany Sklep -> Nieznany sklep (confidence: 0.0)\nINFO     backend.agents.receipt_analysis_agent:receipt_analysis_agent.py:114 Analiza paragonu zakończona\n=============================== warnings summary ===============================\n../../../../miniconda3/lib/python3.13/site-packages/faiss/loader.py:49\n  /home/marcin/miniconda3/lib/python3.13/site-packages/faiss/loader.py:49: DeprecationWarning: numpy.core._multiarray_umath is deprecated and has been renamed to numpy._core._multiarray_umath. The numpy._core namespace contains private NumPy internals and its use is discouraged, as NumPy internals can change without warning in any release. In practice, most real-world usage of numpy.core is to access functionality in the public NumPy API. If that is the case, use the public NumPy API. If not, you are using NumPy internals. If you would still like to access an internal attribute, use numpy._core._multiarray_umath.__cpu_features__.\n    from numpy.core._multiarray_umath import __cpu_features__\n\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type SwigPyPacked has no __module__ attribute\n\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type SwigPyObject has no __module__ attribute\n\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type swigvarlink has no __module__ attribute\n\n../../../../miniconda3/lib/python3.13/site-packages/pydantic/_internal/_config.py:295: 14 warnings\n  /home/marcin/miniconda3/lib/python3.13/site-packages/pydantic/_internal/_config.py:295: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/\n    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)\n\nsrc/backend/models/user_profile.py:58\n  /home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/models/user_profile.py:58: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/\n    @validator(\"time_zone\")\n\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: Type google._upb._message.MessageMapContainer uses PyType_Spec with a metaclass that has custom tp_new. This is deprecated and will no longer be allowed in Python 3.14.\n\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: Type google._upb._message.ScalarMapContainer uses PyType_Spec with a metaclass that has custom tp_new. This is deprecated and will no longer be allowed in Python 3.14.\n\nsrc/backend/core/response_length_config.py:277\n  /home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/core/response_length_config.py:277: PydanticDeprecatedSince20: The `copy` method is deprecated; use `model_copy` instead. See the docstring of `BaseModel.copy` for details about how to handle `include` and `exclude`. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/\n    return configs.get(style, DEFAULT_CONCISE_CONFIG).copy()\n\n-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html\n=========================== short test summary info ============================\nFAILED tests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_get_default_receipt_config\nFAILED tests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_get_tesseract_config_with_polish_chars\nFAILED tests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_extract_text_from_image_obj_with_receipt_config\nFAILED tests/unit/test_ocr_enhanced.py::TestOCREnhanced::test_ocr_processor_language_configuration\nFAILED tests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_receipt_analysis_lidl_format\nFAILED tests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_fallback_parser_with_common_products\nFAILED tests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_fallback_parser_with_price_patterns\nFAILED tests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_date_validation_with_various_formats\nFAILED tests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_fallback_parser_robustness\nFAILED tests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_data_validation_future_date\nFAILED tests/unit/test_receipt_analysis_enhanced.py::TestReceiptAnalysisAgentEnhanced::test_complete_receipt_processing_workflow\n================= 11 failed, 26 passed, 27 warnings in 20.04s ==================\n",
      "stderr": "",
      "duration": 27.929840326309204
    },
    "total_success": false
  },
  "backend_integration": {
    "agent_workflow": {
      "success": false,
      "returncode": 1,
      "stdout": "============================= test session starts ==============================\nplatform linux -- Python 3.13.5, pytest-8.4.1, pluggy-1.5.0 -- /home/marcin/miniconda3/bin/python\ncachedir: .pytest_cache\nbenchmark: 5.1.0 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)\nrootdir: /home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO\nconfigfile: pyproject.toml\nplugins: asyncio-1.0.0, benchmark-5.1.0, anyio-4.9.0, langsmith-0.4.4, cov-6.2.1\nasyncio: mode=Mode.STRICT, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function\ncollecting ... collected 17 items\n\ntests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_import_agent_success FAILED [  5%]\ntests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_import_agent_ocr_failure FAILED [ 11%]\ntests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_validation_agent_success FAILED [ 17%]\ntests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_validation_agent_invalid_receipt FAILED [ 23%]\ntests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_validation_agent_nip_validation FAILED [ 29%]\ntests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_categorization_agent_success FAILED [ 35%]\ntests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_categorization_agent_fallback_to_dictionary FAILED [ 41%]\ntests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_complete_workflow_success FAILED [ 47%]\ntests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_workflow_validation_failure FAILED [ 52%]\ntests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_workflow_categorization_failure FAILED [ 58%]\ntests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_error_handling_and_recovery FAILED [ 64%]\ntests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_metadata_tracking FAILED [ 70%]\ntests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_performance_monitoring FAILED [ 76%]\ntests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_concurrent_processing FAILED [ 82%]\ntests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_memory_management FAILED [ 88%]\ntests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_configuration_validation FAILED [ 94%]\ntests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_response_format_consistency FAILED [100%]\n\n=================================== FAILURES ===================================\n__________ TestReceiptAgentWorkflow.test_receipt_import_agent_success __________\ntests/integration/test_receipt_agent_workflow.py:95: in test_receipt_import_agent_success\n    with patch(\"backend.agents.receipt_import_agent.OCRProcessor\") as mock_ocr:\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: in get_original\n    raise AttributeError(\nE   AttributeError: <module 'backend.agents.receipt_import_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_import_agent.py'> does not have the attribute 'OCRProcessor'\n________ TestReceiptAgentWorkflow.test_receipt_import_agent_ocr_failure ________\ntests/integration/test_receipt_agent_workflow.py:117: in test_receipt_import_agent_ocr_failure\n    with patch(\"backend.agents.receipt_import_agent.OCRProcessor\") as mock_ocr:\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: in get_original\n    raise AttributeError(\nE   AttributeError: <module 'backend.agents.receipt_import_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_import_agent.py'> does not have the attribute 'OCRProcessor'\n________ TestReceiptAgentWorkflow.test_receipt_validation_agent_success ________\ntests/integration/test_receipt_agent_workflow.py:137: in test_receipt_validation_agent_success\n    assert result.success is True\nE   assert False is True\nE    +  where False = AgentResponse(success=False, text=None, data=None, error=\"Błąd walidacji danych wejściowych: 1 validation error for ReceiptValidationInput\\n  Input should be a valid dictionary or instance of ReceiptValidationInput [type=model_type, input_value='Lidl sp. z o.o.\\\\n       ...ta: 2024-01-15 14:30:25', input_type=str]\\n    For further information visit https://errors.pydantic.dev/2.10/v/model_type\", severity=None, message=None, text_stream=None, metadata=None, timestamp=None, processing_time=None, model_used=None, confidence=None, fallback_used=None, retries=None, warnings=None, raw_response=None, status_code=None, content_type=None, encoding=None, cost=None, tokens_used=None, version='1.0.0', api_version=None, request_id=None, trace_id=None, span_id=None, parent_span_id=None, is_cached=None, cache_key=None, cache_ttl=None).success\n____ TestReceiptAgentWorkflow.test_receipt_validation_agent_invalid_receipt ____\ntests/integration/test_receipt_agent_workflow.py:153: in test_receipt_validation_agent_invalid_receipt\n    assert result.success is True\nE   assert False is True\nE    +  where False = AgentResponse(success=False, text=None, data=None, error=\"Błąd walidacji danych wejściowych: 1 validation error for ReceiptValidationInput\\n  Input should be a valid dictionary or instance of ReceiptValidationInput [type=model_type, input_value='Invalid receipt text without proper structure', input_type=str]\\n    For further information visit https://errors.pydantic.dev/2.10/v/model_type\", severity=None, message=None, text_stream=None, metadata=None, timestamp=None, processing_time=None, model_used=None, confidence=None, fallback_used=None, retries=None, warnings=None, raw_response=None, status_code=None, content_type=None, encoding=None, cost=None, tokens_used=None, version='1.0.0', api_version=None, request_id=None, trace_id=None, span_id=None, parent_span_id=None, is_cached=None, cache_key=None, cache_ttl=None).success\n____ TestReceiptAgentWorkflow.test_receipt_validation_agent_nip_validation _____\ntests/integration/test_receipt_agent_workflow.py:176: in test_receipt_validation_agent_nip_validation\n    assert result_valid.data[\"nip_valid\"] is True\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE   TypeError: 'NoneType' object is not subscriptable\n______ TestReceiptAgentWorkflow.test_receipt_categorization_agent_success ______\ntests/integration/test_receipt_agent_workflow.py:185: in test_receipt_categorization_agent_success\n    with patch(\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: in get_original\n    raise AttributeError(\nE   AttributeError: <module 'backend.agents.receipt_categorization_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_categorization_agent.py'> does not have the attribute 'BielikAIClient'\n_ TestReceiptAgentWorkflow.test_receipt_categorization_agent_fallback_to_dictionary _\ntests/integration/test_receipt_agent_workflow.py:215: in test_receipt_categorization_agent_fallback_to_dictionary\n    with patch(\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: in get_original\n    raise AttributeError(\nE   AttributeError: <module 'backend.agents.receipt_categorization_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_categorization_agent.py'> does not have the attribute 'BielikAIClient'\n___________ TestReceiptAgentWorkflow.test_complete_workflow_success ____________\ntests/integration/test_receipt_agent_workflow.py:245: in test_complete_workflow_success\n    patch(\"backend.agents.receipt_import_agent.OCRProcessor\") as mock_ocr,\n    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: in get_original\n    raise AttributeError(\nE   AttributeError: <module 'backend.agents.receipt_import_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_import_agent.py'> does not have the attribute 'OCRProcessor'\n__________ TestReceiptAgentWorkflow.test_workflow_validation_failure ___________\ntests/integration/test_receipt_agent_workflow.py:292: in test_workflow_validation_failure\n    patch(\"backend.agents.receipt_import_agent.OCRProcessor\") as mock_ocr,\n    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: in get_original\n    raise AttributeError(\nE   AttributeError: <module 'backend.agents.receipt_import_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_import_agent.py'> does not have the attribute 'OCRProcessor'\n________ TestReceiptAgentWorkflow.test_workflow_categorization_failure _________\ntests/integration/test_receipt_agent_workflow.py:332: in test_workflow_categorization_failure\n    patch(\"backend.agents.receipt_import_agent.OCRProcessor\") as mock_ocr,\n    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: in get_original\n    raise AttributeError(\nE   AttributeError: <module 'backend.agents.receipt_import_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_import_agent.py'> does not have the attribute 'OCRProcessor'\n_______ TestReceiptAgentWorkflow.test_agent_error_handling_and_recovery ________\ntests/integration/test_receipt_agent_workflow.py:370: in test_agent_error_handling_and_recovery\n    with patch(\"backend.agents.receipt_import_agent.OCRProcessor\") as mock_ocr:\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: in get_original\n    raise AttributeError(\nE   AttributeError: <module 'backend.agents.receipt_import_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_import_agent.py'> does not have the attribute 'OCRProcessor'\n____________ TestReceiptAgentWorkflow.test_agent_metadata_tracking _____________\ntests/integration/test_receipt_agent_workflow.py:393: in test_agent_metadata_tracking\n    assert result.success is True\nE   assert False is True\nE    +  where False = AgentResponse(success=False, text=None, data=None, error=\"Błąd walidacji danych wejściowych: 1 validation error for ReceiptValidationInput\\n  Input should be a valid dictionary or instance of ReceiptValidationInput [type=model_type, input_value='Lidl sp. z o.o.\\\\n       ...ta: 2024-01-15 14:30:25', input_type=str]\\n    For further information visit https://errors.pydantic.dev/2.10/v/model_type\", severity=None, message=None, text_stream=None, metadata=None, timestamp=None, processing_time=None, model_used=None, confidence=None, fallback_used=None, retries=None, warnings=None, raw_response=None, status_code=None, content_type=None, encoding=None, cost=None, tokens_used=None, version='1.0.0', api_version=None, request_id=None, trace_id=None, span_id=None, parent_span_id=None, is_cached=None, cache_key=None, cache_ttl=None).success\n__________ TestReceiptAgentWorkflow.test_agent_performance_monitoring __________\ntests/integration/test_receipt_agent_workflow.py:411: in test_agent_performance_monitoring\n    assert result.success is True\nE   assert False is True\nE    +  where False = AgentResponse(success=False, text=None, data=None, error=\"Błąd walidacji danych wejściowych: 1 validation error for ReceiptValidationInput\\n  Input should be a valid dictionary or instance of ReceiptValidationInput [type=model_type, input_value='Lidl sp. z o.o.\\\\n       ...ta: 2024-01-15 14:30:25', input_type=str]\\n    For further information visit https://errors.pydantic.dev/2.10/v/model_type\", severity=None, message=None, text_stream=None, metadata=None, timestamp=None, processing_time=None, model_used=None, confidence=None, fallback_used=None, retries=None, warnings=None, raw_response=None, status_code=None, content_type=None, encoding=None, cost=None, tokens_used=None, version='1.0.0', api_version=None, request_id=None, trace_id=None, span_id=None, parent_span_id=None, is_cached=None, cache_key=None, cache_ttl=None).success\n__________ TestReceiptAgentWorkflow.test_agent_concurrent_processing ___________\ntests/integration/test_receipt_agent_workflow.py:437: in test_agent_concurrent_processing\n    assert result.success is True\nE   assert False is True\nE    +  where False = AgentResponse(success=False, text=None, data=None, error=\"Błąd walidacji danych wejściowych: 1 validation error for ReceiptValidationInput\\n  Input should be a valid dictionary or instance of ReceiptValidationInput [type=model_type, input_value='Lidl sp. z o.o.\\\\n       ...ta: 2024-01-15 14:30:25', input_type=str]\\n    For further information visit https://errors.pydantic.dev/2.10/v/model_type\", severity=None, message=None, text_stream=None, metadata=None, timestamp=None, processing_time=None, model_used=None, confidence=None, fallback_used=None, retries=None, warnings=None, raw_response=None, status_code=None, content_type=None, encoding=None, cost=None, tokens_used=None, version='1.0.0', api_version=None, request_id=None, trace_id=None, span_id=None, parent_span_id=None, is_cached=None, cache_key=None, cache_ttl=None).success\n____________ TestReceiptAgentWorkflow.test_agent_memory_management _____________\ntests/integration/test_receipt_agent_workflow.py:446: in test_agent_memory_management\n    with patch(\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: in get_original\n    raise AttributeError(\nE   AttributeError: <module 'backend.agents.receipt_categorization_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_categorization_agent.py'> does not have the attribute 'BielikAIClient'\n_________ TestReceiptAgentWorkflow.test_agent_configuration_validation _________\ntests/integration/test_receipt_agent_workflow.py:474: in test_agent_configuration_validation\n    assert hasattr(agent, \"description\")\nE   AssertionError: assert False\nE    +  where False = hasattr(<backend.agents.receipt_validation_agent.ReceiptValidationAgent object at 0x7ff8a0bdb460>, 'description')\n_______ TestReceiptAgentWorkflow.test_agent_response_format_consistency ________\ntests/integration/test_receipt_agent_workflow.py:498: in test_agent_response_format_consistency\n    assert isinstance(result.data, dict)\nE   assert False\nE    +  where False = isinstance(None, dict)\nE    +    where None = AgentResponse(success=False, text=None, data=None, error=\"Błąd walidacji danych wejściowych: 1 validation error for ReceiptValidationInput\\n  Input should be a valid dictionary or instance of ReceiptValidationInput [type=model_type, input_value='Lidl sp. z o.o.\\\\n       ...ta: 2024-01-15 14:30:25', input_type=str]\\n    For further information visit https://errors.pydantic.dev/2.10/v/model_type\", severity=None, message=None, text_stream=None, metadata=None, timestamp=None, processing_time=None, model_used=None, confidence=None, fallback_used=None, retries=None, warnings=None, raw_response=None, status_code=None, content_type=None, encoding=None, cost=None, tokens_used=None, version='1.0.0', api_version=None, request_id=None, trace_id=None, span_id=None, parent_span_id=None, is_cached=None, cache_key=None, cache_ttl=None).data\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:28.707944\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-69\"}\n{\"timestamp\": \"2025-07-06T23:27:28.708009\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-69\"}\n------------------------------ Captured log call -------------------------------\nINFO     backend.core.product_categorizer:product_categorizer.py:23 Załadowano 35 kategorii produktów\n=============================== warnings summary ===============================\n../../../../miniconda3/lib/python3.13/site-packages/faiss/loader.py:49\n  /home/marcin/miniconda3/lib/python3.13/site-packages/faiss/loader.py:49: DeprecationWarning: numpy.core._multiarray_umath is deprecated and has been renamed to numpy._core._multiarray_umath. The numpy._core namespace contains private NumPy internals and its use is discouraged, as NumPy internals can change without warning in any release. In practice, most real-world usage of numpy.core is to access functionality in the public NumPy API. If that is the case, use the public NumPy API. If not, you are using NumPy internals. If you would still like to access an internal attribute, use numpy._core._multiarray_umath.__cpu_features__.\n    from numpy.core._multiarray_umath import __cpu_features__\n\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type SwigPyPacked has no __module__ attribute\n\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type SwigPyObject has no __module__ attribute\n\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type swigvarlink has no __module__ attribute\n\n../../../../miniconda3/lib/python3.13/site-packages/pydantic/_internal/_config.py:295: 14 warnings\n  /home/marcin/miniconda3/lib/python3.13/site-packages/pydantic/_internal/_config.py:295: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/\n    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)\n\nsrc/backend/models/user_profile.py:58\n  /home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/models/user_profile.py:58: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/\n    @validator(\"time_zone\")\n\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: Type google._upb._message.MessageMapContainer uses PyType_Spec with a metaclass that has custom tp_new. This is deprecated and will no longer be allowed in Python 3.14.\n\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: Type google._upb._message.ScalarMapContainer uses PyType_Spec with a metaclass that has custom tp_new. This is deprecated and will no longer be allowed in Python 3.14.\n\nsrc/backend/core/response_length_config.py:277\n  /home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/core/response_length_config.py:277: PydanticDeprecatedSince20: The `copy` method is deprecated; use `model_copy` instead. See the docstring of `BaseModel.copy` for details about how to handle `include` and `exclude`. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/\n    return configs.get(style, DEFAULT_CONCISE_CONFIG).copy()\n\n-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html\n=========================== short test summary info ============================\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_import_agent_success\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_import_agent_ocr_failure\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_validation_agent_success\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_validation_agent_invalid_receipt\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_validation_agent_nip_validation\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_categorization_agent_success\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_categorization_agent_fallback_to_dictionary\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_complete_workflow_success\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_workflow_validation_failure\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_workflow_categorization_failure\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_error_handling_and_recovery\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_metadata_tracking\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_performance_monitoring\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_concurrent_processing\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_memory_management\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_configuration_validation\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_response_format_consistency\n======================= 17 failed, 27 warnings in 0.98s ========================\n",
      "stderr": "",
      "duration": 8.991988182067871
    },
    "endpoints": {
      "success": false,
      "returncode": 1,
      "stdout": "============================= test session starts ==============================\nplatform linux -- Python 3.13.5, pytest-8.4.1, pluggy-1.5.0 -- /home/marcin/miniconda3/bin/python\ncachedir: .pytest_cache\nbenchmark: 5.1.0 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)\nrootdir: /home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO\nconfigfile: pyproject.toml\nplugins: asyncio-1.0.0, benchmark-5.1.0, anyio-4.9.0, langsmith-0.4.4, cov-6.2.1\nasyncio: mode=Mode.STRICT, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function\ncollecting ... collected 17 items\n\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_complete_success FAILED [  5%]\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_ocr_failure FAILED [ 11%]\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_analysis_failure FAILED [ 17%]\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_file_too_large FAILED [ 23%]\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_unsupported_file_type FAILED [ 29%]\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_missing_content_type FAILED [ 35%]\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_upload_receipt_enhanced_success FAILED [ 41%]\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_analyze_receipt_enhanced_success FAILED [ 47%]\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_analyze_receipt_empty_text FAILED [ 52%]\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_analyze_receipt_whitespace_only FAILED [ 58%]\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_analyze_receipt_analysis_failure FAILED [ 64%]\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_upload_receipt_pdf_success FAILED [ 70%]\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_pdf_success FAILED [ 76%]\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_upload_receipt_ocr_failure_enhanced FAILED [ 82%]\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_exception_handling FAILED [ 88%]\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_upload_receipt_with_metadata FAILED [ 94%]\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_workflow_steps FAILED [100%]\n\n=================================== FAILURES ===================================\n______ TestReceiptEndpointsEnhanced.test_process_receipt_complete_success ______\nasync def functions are not natively supported.\nYou need to install a suitable plugin for your async framework, for example:\n  - anyio\n  - pytest-asyncio\n  - pytest-tornasync\n  - pytest-trio\n  - pytest-twisted\n________ TestReceiptEndpointsEnhanced.test_process_receipt_ocr_failure _________\nasync def functions are not natively supported.\nYou need to install a suitable plugin for your async framework, for example:\n  - anyio\n  - pytest-asyncio\n  - pytest-tornasync\n  - pytest-trio\n  - pytest-twisted\n______ TestReceiptEndpointsEnhanced.test_process_receipt_analysis_failure ______\nasync def functions are not natively supported.\nYou need to install a suitable plugin for your async framework, for example:\n  - anyio\n  - pytest-asyncio\n  - pytest-tornasync\n  - pytest-trio\n  - pytest-twisted\n_______ TestReceiptEndpointsEnhanced.test_process_receipt_file_too_large _______\ntests/integration/test_receipt_endpoints_enhanced.py:130: in test_process_receipt_file_too_large\n    assert response.status_code == 400\nE   assert 404 == 400\nE    +  where 404 = <Response [404 Not Found]>.status_code\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:37.189840\", \"level\": \"INFO\", \"logger\": \"httpx\", \"module\": \"_client\", \"message\": \"HTTP Request: POST http://testserver/api/v2/receipts/receipts/process \\\"HTTP/1.1 404 Not Found\\\"\", \"levelno\": 20, \"taskName\": null}\n------------------------------ Captured log call -------------------------------\nINFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/api/v2/receipts/receipts/process \"HTTP/1.1 404 Not Found\"\n___ TestReceiptEndpointsEnhanced.test_process_receipt_unsupported_file_type ____\ntests/integration/test_receipt_endpoints_enhanced.py:139: in test_process_receipt_unsupported_file_type\n    assert response.status_code == 400\nE   assert 404 == 400\nE    +  where 404 = <Response [404 Not Found]>.status_code\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:37.269783\", \"level\": \"INFO\", \"logger\": \"httpx\", \"module\": \"_client\", \"message\": \"HTTP Request: POST http://testserver/api/v2/receipts/receipts/process \\\"HTTP/1.1 404 Not Found\\\"\", \"levelno\": 20, \"taskName\": null}\n------------------------------ Captured log call -------------------------------\nINFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/api/v2/receipts/receipts/process \"HTTP/1.1 404 Not Found\"\n____ TestReceiptEndpointsEnhanced.test_process_receipt_missing_content_type ____\ntests/integration/test_receipt_endpoints_enhanced.py:148: in test_process_receipt_missing_content_type\n    assert response.status_code == 400\nE   assert 404 == 400\nE    +  where 404 = <Response [404 Not Found]>.status_code\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:37.289125\", \"level\": \"INFO\", \"logger\": \"httpx\", \"module\": \"_client\", \"message\": \"HTTP Request: POST http://testserver/api/v2/receipts/receipts/process \\\"HTTP/1.1 404 Not Found\\\"\", \"levelno\": 20, \"taskName\": null}\n------------------------------ Captured log call -------------------------------\nINFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/api/v2/receipts/receipts/process \"HTTP/1.1 404 Not Found\"\n______ TestReceiptEndpointsEnhanced.test_upload_receipt_enhanced_success _______\nasync def functions are not natively supported.\nYou need to install a suitable plugin for your async framework, for example:\n  - anyio\n  - pytest-asyncio\n  - pytest-tornasync\n  - pytest-trio\n  - pytest-twisted\n______ TestReceiptEndpointsEnhanced.test_analyze_receipt_enhanced_success ______\nasync def functions are not natively supported.\nYou need to install a suitable plugin for your async framework, for example:\n  - anyio\n  - pytest-asyncio\n  - pytest-tornasync\n  - pytest-trio\n  - pytest-twisted\n_________ TestReceiptEndpointsEnhanced.test_analyze_receipt_empty_text _________\ntests/integration/test_receipt_endpoints_enhanced.py:193: in test_analyze_receipt_empty_text\n    assert response.status_code == 400\nE   assert 404 == 400\nE    +  where 404 = <Response [404 Not Found]>.status_code\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:37.332991\", \"level\": \"INFO\", \"logger\": \"httpx\", \"module\": \"_client\", \"message\": \"HTTP Request: POST http://testserver/api/v2/receipts/receipts/analyze \\\"HTTP/1.1 404 Not Found\\\"\", \"levelno\": 20, \"taskName\": null}\n------------------------------ Captured log call -------------------------------\nINFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/api/v2/receipts/receipts/analyze \"HTTP/1.1 404 Not Found\"\n______ TestReceiptEndpointsEnhanced.test_analyze_receipt_whitespace_only _______\ntests/integration/test_receipt_endpoints_enhanced.py:203: in test_analyze_receipt_whitespace_only\n    assert response.status_code == 400\nE   assert 404 == 400\nE    +  where 404 = <Response [404 Not Found]>.status_code\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:37.350327\", \"level\": \"INFO\", \"logger\": \"httpx\", \"module\": \"_client\", \"message\": \"HTTP Request: POST http://testserver/api/v2/receipts/receipts/analyze \\\"HTTP/1.1 404 Not Found\\\"\", \"levelno\": 20, \"taskName\": null}\n------------------------------ Captured log call -------------------------------\nINFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/api/v2/receipts/receipts/analyze \"HTTP/1.1 404 Not Found\"\n______ TestReceiptEndpointsEnhanced.test_analyze_receipt_analysis_failure ______\nasync def functions are not natively supported.\nYou need to install a suitable plugin for your async framework, for example:\n  - anyio\n  - pytest-asyncio\n  - pytest-tornasync\n  - pytest-trio\n  - pytest-twisted\n_________ TestReceiptEndpointsEnhanced.test_upload_receipt_pdf_success _________\nasync def functions are not natively supported.\nYou need to install a suitable plugin for your async framework, for example:\n  - anyio\n  - pytest-asyncio\n  - pytest-tornasync\n  - pytest-trio\n  - pytest-twisted\n________ TestReceiptEndpointsEnhanced.test_process_receipt_pdf_success _________\ntests/integration/test_receipt_endpoints_enhanced.py:260: in test_process_receipt_pdf_success\n    assert response.status_code == 200\nE   assert 404 == 200\nE    +  where 404 = <Response [404 Not Found]>.status_code\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:37.394132\", \"level\": \"INFO\", \"logger\": \"httpx\", \"module\": \"_client\", \"message\": \"HTTP Request: POST http://testserver/api/v2/receipts/receipts/process \\\"HTTP/1.1 404 Not Found\\\"\", \"levelno\": 20, \"taskName\": null}\n------------------------------ Captured log call -------------------------------\nINFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/api/v2/receipts/receipts/process \"HTTP/1.1 404 Not Found\"\n____ TestReceiptEndpointsEnhanced.test_upload_receipt_ocr_failure_enhanced _____\nasync def functions are not natively supported.\nYou need to install a suitable plugin for your async framework, for example:\n  - anyio\n  - pytest-asyncio\n  - pytest-tornasync\n  - pytest-trio\n  - pytest-twisted\n_____ TestReceiptEndpointsEnhanced.test_process_receipt_exception_handling _____\ntests/integration/test_receipt_endpoints_enhanced.py:289: in test_process_receipt_exception_handling\n    assert response.status_code == 500\nE   assert 404 == 500\nE    +  where 404 = <Response [404 Not Found]>.status_code\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:37.425079\", \"level\": \"INFO\", \"logger\": \"httpx\", \"module\": \"_client\", \"message\": \"HTTP Request: POST http://testserver/api/v2/receipts/receipts/process \\\"HTTP/1.1 404 Not Found\\\"\", \"levelno\": 20, \"taskName\": null}\n------------------------------ Captured log call -------------------------------\nINFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/api/v2/receipts/receipts/process \"HTTP/1.1 404 Not Found\"\n________ TestReceiptEndpointsEnhanced.test_upload_receipt_with_metadata ________\nasync def functions are not natively supported.\nYou need to install a suitable plugin for your async framework, for example:\n  - anyio\n  - pytest-asyncio\n  - pytest-tornasync\n  - pytest-trio\n  - pytest-twisted\n_______ TestReceiptEndpointsEnhanced.test_process_receipt_workflow_steps _______\ntests/integration/test_receipt_endpoints_enhanced.py:331: in test_process_receipt_workflow_steps\n    assert response.status_code == 200\nE   assert 404 == 200\nE    +  where 404 = <Response [404 Not Found]>.status_code\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:37.456268\", \"level\": \"INFO\", \"logger\": \"httpx\", \"module\": \"_client\", \"message\": \"HTTP Request: POST http://testserver/api/v2/receipts/receipts/process \\\"HTTP/1.1 404 Not Found\\\"\", \"levelno\": 20, \"taskName\": null}\n------------------------------ Captured log call -------------------------------\nINFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/api/v2/receipts/receipts/process \"HTTP/1.1 404 Not Found\"\n=============================== warnings summary ===============================\n../../../../miniconda3/lib/python3.13/site-packages/faiss/loader.py:49\n  /home/marcin/miniconda3/lib/python3.13/site-packages/faiss/loader.py:49: DeprecationWarning: numpy.core._multiarray_umath is deprecated and has been renamed to numpy._core._multiarray_umath. The numpy._core namespace contains private NumPy internals and its use is discouraged, as NumPy internals can change without warning in any release. In practice, most real-world usage of numpy.core is to access functionality in the public NumPy API. If that is the case, use the public NumPy API. If not, you are using NumPy internals. If you would still like to access an internal attribute, use numpy._core._multiarray_umath.__cpu_features__.\n    from numpy.core._multiarray_umath import __cpu_features__\n\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type SwigPyPacked has no __module__ attribute\n\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type SwigPyObject has no __module__ attribute\n\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type swigvarlink has no __module__ attribute\n\n../../../../miniconda3/lib/python3.13/site-packages/pydantic/_internal/_config.py:295: 14 warnings\n  /home/marcin/miniconda3/lib/python3.13/site-packages/pydantic/_internal/_config.py:295: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/\n    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)\n\nsrc/backend/models/user_profile.py:58\n  /home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/models/user_profile.py:58: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/\n    @validator(\"time_zone\")\n\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: Type google._upb._message.MessageMapContainer uses PyType_Spec with a metaclass that has custom tp_new. This is deprecated and will no longer be allowed in Python 3.14.\n\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: Type google._upb._message.ScalarMapContainer uses PyType_Spec with a metaclass that has custom tp_new. This is deprecated and will no longer be allowed in Python 3.14.\n\nsrc/backend/core/response_length_config.py:277\n  /home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/core/response_length_config.py:277: PydanticDeprecatedSince20: The `copy` method is deprecated; use `model_copy` instead. See the docstring of `BaseModel.copy` for details about how to handle `include` and `exclude`. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/\n    return configs.get(style, DEFAULT_CONCISE_CONFIG).copy()\n\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_complete_success\n  tests/integration/test_receipt_endpoints_enhanced.py:59: PytestWarning: The test <Function test_process_receipt_complete_success> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.\n    @patch(\"backend.agents.ocr_agent.OCRAgent.process\")\n\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_ocr_failure\n  tests/integration/test_receipt_endpoints_enhanced.py:88: PytestWarning: The test <Function test_process_receipt_ocr_failure> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.\n    @patch(\"backend.agents.ocr_agent.OCRAgent.process\")\n\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_analysis_failure\n  tests/integration/test_receipt_endpoints_enhanced.py:104: PytestWarning: The test <Function test_process_receipt_analysis_failure> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.\n    @patch(\"backend.agents.ocr_agent.OCRAgent.process\")\n\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_upload_receipt_enhanced_success\n  tests/integration/test_receipt_endpoints_enhanced.py:152: PytestWarning: The test <Function test_upload_receipt_enhanced_success> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.\n    @patch(\"backend.agents.ocr_agent.OCRAgent.process\")\n\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_analyze_receipt_enhanced_success\n  tests/integration/test_receipt_endpoints_enhanced.py:169: PytestWarning: The test <Function test_analyze_receipt_enhanced_success> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.\n    @patch(\"backend.agents.receipt_analysis_agent.ReceiptAnalysisAgent.process\")\n\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_analyze_receipt_analysis_failure\n  tests/integration/test_receipt_endpoints_enhanced.py:207: PytestWarning: The test <Function test_analyze_receipt_analysis_failure> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.\n    @patch(\"backend.agents.receipt_analysis_agent.ReceiptAnalysisAgent.process\")\n\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_upload_receipt_pdf_success\n  tests/integration/test_receipt_endpoints_enhanced.py:222: PytestWarning: The test <Function test_upload_receipt_pdf_success> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.\n    @patch(\"backend.agents.ocr_agent.OCRAgent.process\")\n\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_upload_receipt_ocr_failure_enhanced\n  tests/integration/test_receipt_endpoints_enhanced.py:264: PytestWarning: The test <Function test_upload_receipt_ocr_failure_enhanced> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.\n    @patch(\"backend.agents.ocr_agent.OCRAgent.process\")\n\ntests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_upload_receipt_with_metadata\n  tests/integration/test_receipt_endpoints_enhanced.py:293: PytestWarning: The test <Function test_upload_receipt_with_metadata> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.\n    @patch(\"backend.agents.ocr_agent.OCRAgent.process\")\n\n-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html\n=========================== short test summary info ============================\nFAILED tests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_complete_success\nFAILED tests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_ocr_failure\nFAILED tests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_analysis_failure\nFAILED tests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_file_too_large\nFAILED tests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_unsupported_file_type\nFAILED tests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_missing_content_type\nFAILED tests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_upload_receipt_enhanced_success\nFAILED tests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_analyze_receipt_enhanced_success\nFAILED tests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_analyze_receipt_empty_text\nFAILED tests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_analyze_receipt_whitespace_only\nFAILED tests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_analyze_receipt_analysis_failure\nFAILED tests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_upload_receipt_pdf_success\nFAILED tests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_pdf_success\nFAILED tests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_upload_receipt_ocr_failure_enhanced\nFAILED tests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_exception_handling\nFAILED tests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_upload_receipt_with_metadata\nFAILED tests/integration/test_receipt_endpoints_enhanced.py::TestReceiptEndpointsEnhanced::test_process_receipt_workflow_steps\n======================= 17 failed, 36 warnings in 0.70s ========================\n",
      "stderr": "",
      "duration": 8.64210033416748
    },
    "total_success": false
  },
  "backend_performance": {
    "ocr_performance": {
      "success": false,
      "returncode": 1,
      "stdout": "============================= test session starts ==============================\nplatform linux -- Python 3.13.5, pytest-8.4.1, pluggy-1.5.0 -- /home/marcin/miniconda3/bin/python\ncachedir: .pytest_cache\nbenchmark: 5.1.0 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)\nrootdir: /home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO\nconfigfile: pyproject.toml\nplugins: asyncio-1.0.0, benchmark-5.1.0, anyio-4.9.0, langsmith-0.4.4, cov-6.2.1\nasyncio: mode=Mode.STRICT, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function\ncollecting ... collected 11 items\n\ntests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_contour_detection_performance PASSED [  9%]\ntests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_perspective_correction_performance FAILED [ 18%]\ntests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_adaptive_thresholding_performance FAILED [ 27%]\ntests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_300_dpi_scaling_performance PASSED [ 36%]\ntests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_full_preprocessing_pipeline_performance FAILED [ 45%]\ntests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_agent_workflow_performance FAILED [ 54%]\ntests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_memory_usage_during_preprocessing PASSED [ 63%]\ntests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_concurrent_processing_performance FAILED [ 72%]\ntests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_large_batch_processing_performance PASSED [ 81%]\ntests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_accuracy_vs_performance_tradeoff PASSED [ 90%]\ntests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_resource_utilization_under_load PASSED [100%]\n\n=================================== FAILURES ===================================\n______ TestOCRPerformanceEnhanced.test_perspective_correction_performance ______\ntests/performance/test_ocr_performance_enhanced.py:117: in test_perspective_correction_performance\n    ocr_processor._correct_perspective(image, contour_points)\n    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE   AttributeError: 'OCRProcessor' object has no attribute '_correct_perspective'\n______ TestOCRPerformanceEnhanced.test_adaptive_thresholding_performance _______\ntests/performance/test_ocr_performance_enhanced.py:152: in test_adaptive_thresholding_performance\n    ocr_processor._apply_adaptive_thresholding(image)\n    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE   AttributeError: 'OCRProcessor' object has no attribute '_apply_adaptive_thresholding'\n___ TestOCRPerformanceEnhanced.test_full_preprocessing_pipeline_performance ____\ntests/performance/test_ocr_performance_enhanced.py:228: in test_full_preprocessing_pipeline_performance\n    assert \"preprocessing_time\" in result.metadata\nE   AssertionError: assert 'preprocessing_time' in {'confidence_distribution': {'high': 2, 'low': 0, 'medium': 1}, 'language': 'eng', 'original_metadata': {'file_size_bytes': 2787, 'format': 'PNG', 'mode': 'RGB', 'size': (800, 600)}, 'pages': 1, ...}\nE    +  where {'confidence_distribution': {'high': 2, 'low': 0, 'medium': 1}, 'language': 'eng', 'original_metadata': {'file_size_bytes': 2787, 'format': 'PNG', 'mode': 'RGB', 'size': (800, 600)}, 'pages': 1, ...} = OCRResult(text='Test\\nreceipt\\ntext', confidence=85.0, metadata={'source': 'image', 'pages': 1, 'language': 'eng', 'preprocessing_applied': True, 'preprocessing_steps': ['image_preprocessing'], 'original_metadata': {'size': (800, 600), 'mode': 'RGB', 'format': 'PNG', 'file_size_bytes': 2787}, 'preprocessing_metadata': {'original_size': (800, 600), 'processed_size': (800, 600), 'preprocessing_steps': ['image_preprocessing']}, 'tesseract_config': '--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyzĄĆĘŁŃÓŚŹŻąćęłńóśźż.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng', 'processing_time_seconds': 0.006613016128540039, 'text_blocks': 3, 'confidence_distribution': {'high': 2, 'medium': 1, 'low': 0}}).metadata\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:45.781051\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:45.781131\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:45.781552\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='139915742059824'>\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:45.781582\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='139915742059824'>\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:45.781630\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:45.781646\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:45.782058\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:45.782080\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:45.782571\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:45.782596\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:45.782677\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": null, \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:45.782699\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": null, \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:45.782748\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": null, \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:45.782766\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": null, \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:45.782842\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": null, \"confidence\": 85.0, \"text_length\": 17, \"language\": \"eng\", \"processing_time_seconds\": 0.006613016128540039, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 3}\n{\"timestamp\": \"2025-07-06T23:27:45.782877\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": null, \"confidence\": 85.0, \"text_length\": 17, \"language\": \"eng\", \"processing_time_seconds\": 0.006613016128540039, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 3}\n------------------------------ Captured log call -------------------------------\nINFO     backend.core.ocr:ocr.py:118 Nie znaleziono konturów w obrazie\nINFO     backend.core.ocr:ocr.py:271 Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='139915742059824'>\nINFO     backend.core.ocr:ocr.py:326 Przeskalowano do 300 DPI\nINFO     backend.core.ocr:ocr.py:330 Ulepszono kontrast i ostrość\nINFO     backend.core.ocr:ocr.py:334 Zastosowano adaptacyjny threshold\nINFO     backend.core.ocr:ocr.py:339 Preprocessing obrazu zakończony\nINFO     backend.core.ocr:ocr.py:383 Rozpoczynam OCR z ulepszoną konfiguracją\nINFO     backend.core.ocr:ocr.py:427 OCR przetwarzanie obrazu zakończone pomyślnie\n__________ TestOCRPerformanceEnhanced.test_agent_workflow_performance __________\ntests/performance/test_ocr_performance_enhanced.py:236: in test_agent_workflow_performance\n    with patch(\"backend.agents.receipt_import_agent.OCRProcessor\") as mock_ocr:\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: in get_original\n    raise AttributeError(\nE   AttributeError: <module 'backend.agents.receipt_import_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_import_agent.py'> does not have the attribute 'OCRProcessor'\n______ TestOCRPerformanceEnhanced.test_concurrent_processing_performance _______\ntests/performance/test_ocr_performance_enhanced.py:402: in test_concurrent_processing_performance\n    asyncio.gather(\n../../../../miniconda3/lib/python3.13/asyncio/tasks.py:884: in gather\n    fut = ensure_future(arg, loop=loop)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/asyncio/tasks.py:746: in ensure_future\n    loop = events.get_event_loop()\n           ^^^^^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/asyncio/events.py:716: in get_event_loop\n    raise RuntimeError('There is no current event loop in thread %r.'\nE   RuntimeError: There is no current event loop in thread 'MainThread'.\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:45.938963\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-24\"}\n{\"timestamp\": \"2025-07-06T23:27:45.939036\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-24\"}\n{\"timestamp\": \"2025-07-06T23:27:45.939400\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='139915741401776'>\", \"levelno\": 20, \"taskName\": \"Task-24\"}\n{\"timestamp\": \"2025-07-06T23:27:45.939427\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='139915741401776'>\", \"levelno\": 20, \"taskName\": \"Task-24\"}\n{\"timestamp\": \"2025-07-06T23:27:45.939467\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-24\"}\n{\"timestamp\": \"2025-07-06T23:27:45.939481\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-24\"}\n{\"timestamp\": \"2025-07-06T23:27:45.939871\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-24\"}\n{\"timestamp\": \"2025-07-06T23:27:45.939891\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-24\"}\n{\"timestamp\": \"2025-07-06T23:27:45.940308\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-24\"}\n{\"timestamp\": \"2025-07-06T23:27:45.940329\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-24\"}\n{\"timestamp\": \"2025-07-06T23:27:45.940422\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-24\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:45.940445\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-24\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:45.940491\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-24\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:45.940525\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-24\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:45.940592\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-24\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.007615089416503906, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n{\"timestamp\": \"2025-07-06T23:27:45.940622\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-24\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.007615089416503906, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n{\"timestamp\": \"2025-07-06T23:27:45.949425\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-27\"}\n{\"timestamp\": \"2025-07-06T23:27:45.949484\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-27\"}\n{\"timestamp\": \"2025-07-06T23:27:45.949826\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='139915742061168'>\", \"levelno\": 20, \"taskName\": \"Task-27\"}\n{\"timestamp\": \"2025-07-06T23:27:45.949848\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='139915742061168'>\", \"levelno\": 20, \"taskName\": \"Task-27\"}\n{\"timestamp\": \"2025-07-06T23:27:45.949887\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-27\"}\n{\"timestamp\": \"2025-07-06T23:27:45.949901\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-27\"}\n{\"timestamp\": \"2025-07-06T23:27:45.950271\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-27\"}\n{\"timestamp\": \"2025-07-06T23:27:45.950291\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-27\"}\n{\"timestamp\": \"2025-07-06T23:27:45.950728\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-27\"}\n{\"timestamp\": \"2025-07-06T23:27:45.950751\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-27\"}\n{\"timestamp\": \"2025-07-06T23:27:45.950816\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-27\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:45.950835\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-27\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:45.950879\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-27\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:45.950897\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-27\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:45.950975\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-27\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.006155729293823242, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n{\"timestamp\": \"2025-07-06T23:27:45.950999\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-27\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.006155729293823242, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n{\"timestamp\": \"2025-07-06T23:27:45.958020\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-30\"}\n{\"timestamp\": \"2025-07-06T23:27:45.958089\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-30\"}\n{\"timestamp\": \"2025-07-06T23:27:45.958563\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='139915742136704'>\", \"levelno\": 20, \"taskName\": \"Task-30\"}\n{\"timestamp\": \"2025-07-06T23:27:45.958589\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='139915742136704'>\", \"levelno\": 20, \"taskName\": \"Task-30\"}\n{\"timestamp\": \"2025-07-06T23:27:45.958631\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-30\"}\n{\"timestamp\": \"2025-07-06T23:27:45.958646\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-30\"}\n{\"timestamp\": \"2025-07-06T23:27:45.959034\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-30\"}\n{\"timestamp\": \"2025-07-06T23:27:45.959054\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-30\"}\n{\"timestamp\": \"2025-07-06T23:27:45.959482\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-30\"}\n{\"timestamp\": \"2025-07-06T23:27:45.959505\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-30\"}\n{\"timestamp\": \"2025-07-06T23:27:45.959578\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-30\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:45.959598\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-30\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:45.959643\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-30\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:45.959671\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-30\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:45.959745\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-30\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.006615638732910156, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n{\"timestamp\": \"2025-07-06T23:27:45.959768\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-30\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.006615638732910156, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n{\"timestamp\": \"2025-07-06T23:27:45.966312\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-33\"}\n{\"timestamp\": \"2025-07-06T23:27:45.966351\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-33\"}\n{\"timestamp\": \"2025-07-06T23:27:45.966759\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='139915741316160'>\", \"levelno\": 20, \"taskName\": \"Task-33\"}\n{\"timestamp\": \"2025-07-06T23:27:45.966783\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='139915741316160'>\", \"levelno\": 20, \"taskName\": \"Task-33\"}\n{\"timestamp\": \"2025-07-06T23:27:45.966822\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-33\"}\n{\"timestamp\": \"2025-07-06T23:27:45.966836\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-33\"}\n{\"timestamp\": \"2025-07-06T23:27:45.967208\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-33\"}\n{\"timestamp\": \"2025-07-06T23:27:45.967229\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-33\"}\n{\"timestamp\": \"2025-07-06T23:27:45.967654\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-33\"}\n{\"timestamp\": \"2025-07-06T23:27:45.967688\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-33\"}\n{\"timestamp\": \"2025-07-06T23:27:45.967749\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-33\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:45.967777\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-33\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:45.967821\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-33\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:45.967838\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-33\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:45.967902\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-33\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.005955219268798828, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n{\"timestamp\": \"2025-07-06T23:27:45.967923\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-33\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.005955219268798828, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n{\"timestamp\": \"2025-07-06T23:27:45.975837\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-36\"}\n{\"timestamp\": \"2025-07-06T23:27:45.975901\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-36\"}\n{\"timestamp\": \"2025-07-06T23:27:45.976233\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='139915741330944'>\", \"levelno\": 20, \"taskName\": \"Task-36\"}\n{\"timestamp\": \"2025-07-06T23:27:45.976254\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='139915741330944'>\", \"levelno\": 20, \"taskName\": \"Task-36\"}\n{\"timestamp\": \"2025-07-06T23:27:45.976291\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-36\"}\n{\"timestamp\": \"2025-07-06T23:27:45.976305\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-36\"}\n{\"timestamp\": \"2025-07-06T23:27:45.976780\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-36\"}\n{\"timestamp\": \"2025-07-06T23:27:45.976811\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-36\"}\n{\"timestamp\": \"2025-07-06T23:27:45.977232\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-36\"}\n{\"timestamp\": \"2025-07-06T23:27:45.977253\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-36\"}\n{\"timestamp\": \"2025-07-06T23:27:45.977321\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-36\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:45.977340\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-36\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:45.977393\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-36\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:45.977420\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-36\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:45.977490\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-36\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.006976127624511719, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n{\"timestamp\": \"2025-07-06T23:27:45.977513\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-36\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.006976127624511719, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n------------------------------ Captured log call -------------------------------\nINFO     backend.core.ocr:ocr.py:118 Nie znaleziono konturów w obrazie\nINFO     backend.core.ocr:ocr.py:271 Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='139915741401776'>\nINFO     backend.core.ocr:ocr.py:326 Przeskalowano do 300 DPI\nINFO     backend.core.ocr:ocr.py:330 Ulepszono kontrast i ostrość\nINFO     backend.core.ocr:ocr.py:334 Zastosowano adaptacyjny threshold\nINFO     backend.core.ocr:ocr.py:339 Preprocessing obrazu zakończony\nINFO     backend.core.ocr:ocr.py:383 Rozpoczynam OCR z ulepszoną konfiguracją\nINFO     backend.core.ocr:ocr.py:427 OCR przetwarzanie obrazu zakończone pomyślnie\nINFO     backend.core.ocr:ocr.py:118 Nie znaleziono konturów w obrazie\nINFO     backend.core.ocr:ocr.py:271 Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='139915742061168'>\nINFO     backend.core.ocr:ocr.py:326 Przeskalowano do 300 DPI\nINFO     backend.core.ocr:ocr.py:330 Ulepszono kontrast i ostrość\nINFO     backend.core.ocr:ocr.py:334 Zastosowano adaptacyjny threshold\nINFO     backend.core.ocr:ocr.py:339 Preprocessing obrazu zakończony\nINFO     backend.core.ocr:ocr.py:383 Rozpoczynam OCR z ulepszoną konfiguracją\nINFO     backend.core.ocr:ocr.py:427 OCR przetwarzanie obrazu zakończone pomyślnie\nINFO     backend.core.ocr:ocr.py:118 Nie znaleziono konturów w obrazie\nINFO     backend.core.ocr:ocr.py:271 Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='139915742136704'>\nINFO     backend.core.ocr:ocr.py:326 Przeskalowano do 300 DPI\nINFO     backend.core.ocr:ocr.py:330 Ulepszono kontrast i ostrość\nINFO     backend.core.ocr:ocr.py:334 Zastosowano adaptacyjny threshold\nINFO     backend.core.ocr:ocr.py:339 Preprocessing obrazu zakończony\nINFO     backend.core.ocr:ocr.py:383 Rozpoczynam OCR z ulepszoną konfiguracją\nINFO     backend.core.ocr:ocr.py:427 OCR przetwarzanie obrazu zakończone pomyślnie\nINFO     backend.core.ocr:ocr.py:118 Nie znaleziono konturów w obrazie\nINFO     backend.core.ocr:ocr.py:271 Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='139915741316160'>\nINFO     backend.core.ocr:ocr.py:326 Przeskalowano do 300 DPI\nINFO     backend.core.ocr:ocr.py:330 Ulepszono kontrast i ostrość\nINFO     backend.core.ocr:ocr.py:334 Zastosowano adaptacyjny threshold\nINFO     backend.core.ocr:ocr.py:339 Preprocessing obrazu zakończony\nINFO     backend.core.ocr:ocr.py:383 Rozpoczynam OCR z ulepszoną konfiguracją\nINFO     backend.core.ocr:ocr.py:427 OCR przetwarzanie obrazu zakończone pomyślnie\nINFO     backend.core.ocr:ocr.py:118 Nie znaleziono konturów w obrazie\nINFO     backend.core.ocr:ocr.py:271 Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='139915741330944'>\nINFO     backend.core.ocr:ocr.py:326 Przeskalowano do 300 DPI\nINFO     backend.core.ocr:ocr.py:330 Ulepszono kontrast i ostrość\nINFO     backend.core.ocr:ocr.py:334 Zastosowano adaptacyjny threshold\nINFO     backend.core.ocr:ocr.py:339 Preprocessing obrazu zakończony\nINFO     backend.core.ocr:ocr.py:383 Rozpoczynam OCR z ulepszoną konfiguracją\nINFO     backend.core.ocr:ocr.py:427 OCR przetwarzanie obrazu zakończone pomyślnie\n=============================== warnings summary ===============================\n../../../../miniconda3/lib/python3.13/site-packages/faiss/loader.py:49\n  /home/marcin/miniconda3/lib/python3.13/site-packages/faiss/loader.py:49: DeprecationWarning: numpy.core._multiarray_umath is deprecated and has been renamed to numpy._core._multiarray_umath. The numpy._core namespace contains private NumPy internals and its use is discouraged, as NumPy internals can change without warning in any release. In practice, most real-world usage of numpy.core is to access functionality in the public NumPy API. If that is the case, use the public NumPy API. If not, you are using NumPy internals. If you would still like to access an internal attribute, use numpy._core._multiarray_umath.__cpu_features__.\n    from numpy.core._multiarray_umath import __cpu_features__\n\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type SwigPyPacked has no __module__ attribute\n\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type SwigPyObject has no __module__ attribute\n\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type swigvarlink has no __module__ attribute\n\n../../../../miniconda3/lib/python3.13/site-packages/pydantic/_internal/_config.py:295: 14 warnings\n  /home/marcin/miniconda3/lib/python3.13/site-packages/pydantic/_internal/_config.py:295: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/\n    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)\n\nsrc/backend/models/user_profile.py:58\n  /home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/models/user_profile.py:58: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/\n    @validator(\"time_zone\")\n\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: Type google._upb._message.MessageMapContainer uses PyType_Spec with a metaclass that has custom tp_new. This is deprecated and will no longer be allowed in Python 3.14.\n\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: Type google._upb._message.ScalarMapContainer uses PyType_Spec with a metaclass that has custom tp_new. This is deprecated and will no longer be allowed in Python 3.14.\n\nsrc/backend/core/response_length_config.py:277\n  /home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/core/response_length_config.py:277: PydanticDeprecatedSince20: The `copy` method is deprecated; use `model_copy` instead. See the docstring of `BaseModel.copy` for details about how to handle `include` and `exclude`. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/\n    return configs.get(style, DEFAULT_CONCISE_CONFIG).copy()\n\ntests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_large_batch_processing_performance\n  /home/marcin/miniconda3/lib/python3.13/re/_parser.py:175: RuntimeWarning: coroutine 'TestOCRPerformanceEnhanced.test_concurrent_processing_performance.<locals>.process_single_image' was never awaited\n    def append(self, code):\n  Enable tracemalloc to get traceback where the object was allocated.\n  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.\n\n-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html\n============================= slowest 10 durations =============================\n0.76s call     tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_large_batch_processing_performance\n0.14s call     tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_resource_utilization_under_load\n0.09s call     tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_concurrent_processing_performance\n0.04s call     tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_accuracy_vs_performance_tradeoff\n0.02s setup    tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_contour_detection_performance\n0.01s setup    tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_full_preprocessing_pipeline_performance\n0.01s call     tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_memory_usage_during_preprocessing\n0.01s teardown tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_contour_detection_performance\n0.01s teardown tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_perspective_correction_performance\n0.01s teardown tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_large_batch_processing_performance\n=========================== short test summary info ============================\nFAILED tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_perspective_correction_performance\nFAILED tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_adaptive_thresholding_performance\nFAILED tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_full_preprocessing_pipeline_performance\nFAILED tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_agent_workflow_performance\nFAILED tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_concurrent_processing_performance\n=================== 5 failed, 6 passed, 28 warnings in 1.69s ===================\n",
      "stderr": "",
      "duration": 9.502238273620605
    },
    "total_success": false
  },
  "coverage": {
    "coverage": {
      "success": false,
      "returncode": 1,
      "stdout": "============================= test session starts ==============================\nplatform linux -- Python 3.13.5, pytest-8.4.1, pluggy-1.5.0\nbenchmark: 5.1.0 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)\nrootdir: /home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO\nconfigfile: pyproject.toml\nplugins: asyncio-1.0.0, benchmark-5.1.0, anyio-4.9.0, langsmith-0.4.4, cov-6.2.1\nasyncio: mode=Mode.STRICT, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function\ncollected 44 items\n\ntests/unit/test_ocr_advanced_preprocessing.py FFFFFFFFF.FFFFF.           [ 36%]\ntests/integration/test_receipt_agent_workflow.py FFFFFFFFFFFFFFFFF       [ 75%]\ntests/performance/test_ocr_performance_enhanced.py .FF.FF.F...           [100%]\n\n=================================== FAILURES ===================================\n_________ TestOCRAdvancedPreprocessing.test_enhanced_contour_detection _________\n\nself = <test_ocr_advanced_preprocessing.TestOCRAdvancedPreprocessing object at 0x7bbf0c6af890>\nocr_processor = <backend.core.ocr.OCRProcessor object at 0x7bbf0c705940>\nsample_receipt_image = <PIL.Image.Image image mode=RGB size=400x300 at 0x7BBF0C5279D0>\n\n    def test_enhanced_contour_detection(self, ocr_processor, sample_receipt_image):\n        \"\"\"Test ulepszonej detekcji konturów paragonu.\"\"\"\n        # Mock OpenCV functions\n        with patch(\"backend.core.ocr.cv2\") as mock_cv2:\n            # Mock contour detection\n            mock_contours = [\n                np.array([[50, 30], [350, 30], [350, 270], [50, 270]], dtype=np.int32)\n            ]\n            mock_cv2.findContours.return_value = (mock_contours, None)\n            mock_cv2.contourArea.return_value = 80000  # Duży obszar\n            mock_cv2.arcLength.return_value = 1000\n            mock_cv2.approxPolyDP.return_value = np.array(\n                [[50, 30], [350, 30], [350, 270], [50, 270]], dtype=np.int32\n            )\n            mock_cv2.boundingRect.return_value = (50, 30, 300, 240)\n    \n            # Mock image conversion\n            mock_cv2.cvtColor.return_value = np.array(sample_receipt_image)\n            mock_cv2.COLOR_RGB2GRAY = 7\n    \n            result = ocr_processor._detect_receipt_contour(sample_receipt_image)\n    \n>           assert result is not None\nE           assert None is not None\n\ntests/unit/test_ocr_advanced_preprocessing.py:71: AssertionError\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:57.693086\", \"level\": \"WARNING\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"B\\u0142\\u0105d podczas wykrywania konturu: 'Image' object has no attribute 'shape'\", \"levelno\": 30, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:57.693194\", \"level\": \"WARNING\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"B\\u0142\\u0105d podczas wykrywania konturu: 'Image' object has no attribute 'shape'\", \"levelno\": 30, \"taskName\": null}\n------------------------------ Captured log call -------------------------------\nWARNING  backend.core.ocr:ocr.py:154 Błąd podczas wykrywania konturu: 'Image' object has no attribute 'shape'\n_ TestOCRAdvancedPreprocessing.test_contour_detection_fallback_to_bounding_rect _\n\nself = <test_ocr_advanced_preprocessing.TestOCRAdvancedPreprocessing object at 0x7bbf0c6afd90>\nocr_processor = <backend.core.ocr.OCRProcessor object at 0x7bbf0c527890>\nsample_receipt_image = <PIL.Image.Image image mode=RGB size=400x300 at 0x7BBF0C2DC3E0>\n\n    def test_contour_detection_fallback_to_bounding_rect(\n        self, ocr_processor, sample_receipt_image\n    ):\n        \"\"\"Test fallback do minimalnego prostokąta ograniczającego.\"\"\"\n        with patch(\"backend.core.ocr.cv2\") as mock_cv2:\n            # Mock brak konturów\n            mock_cv2.findContours.return_value = ([], None)\n            mock_cv2.boundingRect.return_value = (0, 0, 400, 300)\n    \n            # Mock image conversion\n            mock_cv2.cvtColor.return_value = np.array(sample_receipt_image)\n            mock_cv2.COLOR_RGB2GRAY = 7\n    \n            result = ocr_processor._detect_receipt_contour(sample_receipt_image)\n    \n>           assert result is not None\nE           assert None is not None\n\ntests/unit/test_ocr_advanced_preprocessing.py:90: AssertionError\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:57.804584\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:57.804661\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": null}\n------------------------------ Captured log call -------------------------------\nINFO     backend.core.ocr:ocr.py:118 Nie znaleziono konturów w obrazie\n___________ TestOCRAdvancedPreprocessing.test_perspective_correction ___________\n\nself = <test_ocr_advanced_preprocessing.TestOCRAdvancedPreprocessing object at 0x7bbf0c6ddba0>\nocr_processor = <backend.core.ocr.OCRProcessor object at 0x7bbf0c3e8550>\n\n    def test_perspective_correction(self, ocr_processor):\n        \"\"\"Test korekcji perspektywy.\"\"\"\n        # Mock OpenCV functions\n        with patch(\"backend.core.ocr.cv2\") as mock_cv2:\n            # Mock perspective transform\n            mock_cv2.getPerspectiveTransform.return_value = np.eye(3)\n            mock_cv2.warpPerspective.return_value = np.array(\n                Image.new(\"RGB\", (400, 300), \"white\")\n            )\n    \n            # Mock contour points\n            contour_points = np.array(\n                [[50, 30], [350, 30], [350, 270], [50, 270]], dtype=np.int32\n            )\n    \n>           result = ocr_processor._correct_perspective(\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n                Image.new(\"RGB\", (400, 300), \"white\"), contour_points\n            )\nE           AttributeError: 'OCRProcessor' object has no attribute '_correct_perspective'\n\ntests/unit/test_ocr_advanced_preprocessing.py:109: AttributeError\n________ TestOCRAdvancedPreprocessing.test_adaptive_thresholding_clahe _________\n\nself = <test_ocr_advanced_preprocessing.TestOCRAdvancedPreprocessing object at 0x7bbf0c6dde00>\nocr_processor = <backend.core.ocr.OCRProcessor object at 0x7bbf0c2dce90>\n\n    def test_adaptive_thresholding_clahe(self, ocr_processor):\n        \"\"\"Test adaptacyjnego progowania z CLAHE.\"\"\"\n        with patch(\"backend.core.ocr.cv2\") as mock_cv2:\n            # Mock CLAHE\n            mock_clahe = Mock()\n            mock_cv2.createCLAHE.return_value = mock_clahe\n            mock_clahe.apply.return_value = np.array(Image.new(\"L\", (400, 300), 128))\n    \n            # Mock morphological operations\n            mock_cv2.morphologyEx.return_value = np.array(\n                Image.new(\"L\", (400, 300), 128)\n            )\n            mock_cv2.MORPH_CLOSE = 3\n            mock_cv2.getStructuringElement.return_value = np.ones((3, 3))\n            mock_cv2.MORPH_RECT = 0\n    \n            image = Image.new(\"L\", (400, 300), 128)\n>           result = ocr_processor._apply_adaptive_thresholding(image)\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE           AttributeError: 'OCRProcessor' object has no attribute '_apply_adaptive_thresholding'\n\ntests/unit/test_ocr_advanced_preprocessing.py:134: AttributeError\n______________ TestOCRAdvancedPreprocessing.test_300_dpi_scaling _______________\n\nself = <test_ocr_advanced_preprocessing.TestOCRAdvancedPreprocessing object at 0x7bbf0c71a0f0>\nocr_processor = <backend.core.ocr.OCRProcessor object at 0x7bbf0c2dd0f0>\n\n    def test_300_dpi_scaling(self, ocr_processor):\n        \"\"\"Test skalowania do 300 DPI.\"\"\"\n        # Tworzy mały obraz\n        small_image = Image.new(\"RGB\", (200, 150), \"white\")\n    \n        result = ocr_processor._scale_to_300_dpi(small_image)\n    \n        # Sprawdź czy obraz został powiększony\n>       assert result.size[0] > small_image.size[0]\nE       assert 200 > 200\n\ntests/unit/test_ocr_advanced_preprocessing.py:150: AssertionError\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:57.874543\", \"level\": \"WARNING\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"B\\u0142\\u0105d podczas skalowania do 300 DPI: 'Image' object has no attribute 'shape'\", \"levelno\": 30, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:57.874686\", \"level\": \"WARNING\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"B\\u0142\\u0105d podczas skalowania do 300 DPI: 'Image' object has no attribute 'shape'\", \"levelno\": 30, \"taskName\": null}\n------------------------------ Captured log call -------------------------------\nWARNING  backend.core.ocr:ocr.py:275 Błąd podczas skalowania do 300 DPI: 'Image' object has no attribute 'shape'\n____________ TestOCRAdvancedPreprocessing.test_contrast_enhancement ____________\n\nself = <test_ocr_advanced_preprocessing.TestOCRAdvancedPreprocessing object at 0x7bbf0c86e690>\nocr_processor = <backend.core.ocr.OCRProcessor object at 0x7bbf0c2ddba0>\n\n    def test_contrast_enhancement(self, ocr_processor):\n        \"\"\"Test zwiększania kontrastu.\"\"\"\n        # Tworzy obraz o niskim kontraście\n        low_contrast_image = Image.new(\"RGB\", (100, 100), (128, 128, 128))\n    \n>       result = ocr_processor._enhance_contrast(low_contrast_image)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE       AttributeError: 'OCRProcessor' object has no attribute '_enhance_contrast'\n\ntests/unit/test_ocr_advanced_preprocessing.py:163: AttributeError\n___________ TestOCRAdvancedPreprocessing.test_sharpness_enhancement ____________\n\nself = <test_ocr_advanced_preprocessing.TestOCRAdvancedPreprocessing object at 0x7bbf0c86e8b0>\nocr_processor = <backend.core.ocr.OCRProcessor object at 0x7bbf0c2de060>\n\n    def test_sharpness_enhancement(self, ocr_processor):\n        \"\"\"Test zwiększania ostrości.\"\"\"\n        # Tworzy rozmyty obraz\n        blurry_image = Image.new(\"RGB\", (100, 100), \"white\")\n    \n>       result = ocr_processor._enhance_sharpness(blurry_image)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE       AttributeError: 'OCRProcessor' object has no attribute '_enhance_sharpness'\n\ntests/unit/test_ocr_advanced_preprocessing.py:173: AttributeError\n_________ TestOCRAdvancedPreprocessing.test_lstm_engine_configuration __________\n\nself = <test_ocr_advanced_preprocessing.TestOCRAdvancedPreprocessing object at 0x7bbf0c6e4e50>\nocr_processor = <backend.core.ocr.OCRProcessor object at 0x7bbf0c2dd220>\n\n    def test_lstm_engine_configuration(self, ocr_processor):\n        \"\"\"Test konfiguracji silnika LSTM.\"\"\"\n        config = ocr_processor._get_default_receipt_config()\n    \n        # Sprawdź czy używa LSTM engine\n        assert \"--oem 1\" in config  # LSTM engine\n        assert \"--psm 6\" in config  # Uniform block of text\n>       assert \"-l pol\" in config  # Polish language\n        ^^^^^^^^^^^^^^^^^^^^^^^^^\nE       AssertionError: assert '-l pol' in '--oem 1 --psm 6'\n\ntests/unit/test_ocr_advanced_preprocessing.py:185: AssertionError\n_ TestOCRAdvancedPreprocessing.test_process_image_with_advanced_preprocessing __\n\nself = <test_ocr_advanced_preprocessing.TestOCRAdvancedPreprocessing object at 0x7bbf0c6e5050>\nmock_tesseract = <MagicMock name='pytesseract' id='136060477668528'>\nocr_processor = <backend.core.ocr.OCRProcessor object at 0x7bbf0c2de190>\nsample_receipt_image_bytes = b\"\\x89PNG\\r\\n\\x1a\\n\\x00\\x00\\x00\\rIHDR\\x00\\x00\\x01\\x90\\x00\\x00\\x01,\\x08\\x02\\x00\\x00\\x00b\\xd5r\\x95\\x00\\x00\\x04KIDATx\\x9c...@\\x86`\\x01\\x19\\x82\\x05d\\x08\\x16\\x90!X@\\x86`\\x01\\x19\\x82\\x05d\\xbc\\x01gp\\xb9>d\\xa9\\x05\\xb0\\x00\\x00\\x00\\x00IEND\\xaeB`\\x82\"\n\n    @patch(\"backend.core.ocr.pytesseract\")\n    def test_process_image_with_advanced_preprocessing(\n        self, mock_tesseract, ocr_processor, sample_receipt_image_bytes\n    ):\n        \"\"\"Test przetwarzania obrazu z zaawansowanym preprocessingiem.\"\"\"\n        # Mock odpowiedzi Tesseract\n        mock_data = {\n            \"text\": [\"Lidl\", \"Mleko 3.2% 1L 4,99 PLN\", \"RAZEM 4,99 PLN\"],\n            \"conf\": [95, 90, 85],\n        }\n        mock_tesseract.image_to_data.return_value = mock_data\n        mock_tesseract.Output.DICT = \"dict\"\n    \n        # Mock OpenCV functions\n        with patch(\"backend.core.ocr.cv2\") as mock_cv2:\n            mock_cv2.findContours.return_value = ([], None)\n            mock_cv2.boundingRect.return_value = (0, 0, 400, 300)\n            mock_cv2.cvtColor.return_value = np.array(\n                Image.new(\"RGB\", (400, 300), \"white\")\n            )\n            mock_cv2.COLOR_RGB2GRAY = 7\n            mock_cv2.getPerspectiveTransform.return_value = np.eye(3)\n            mock_cv2.warpPerspective.return_value = np.array(\n                Image.new(\"RGB\", (400, 300), \"white\")\n            )\n            mock_cv2.createCLAHE.return_value = Mock()\n            mock_cv2.morphologyEx.return_value = np.array(\n                Image.new(\"L\", (400, 300), 128)\n            )\n            mock_cv2.MORPH_CLOSE = 3\n            mock_cv2.getStructuringElement.return_value = np.ones((3, 3))\n            mock_cv2.MORPH_RECT = 0\n    \n        result = ocr_processor.process_image(sample_receipt_image_bytes)\n    \n        assert result.text == \"Lidl\\nMleko 3.2% 1L 4,99 PLN\\nRAZEM 4,99 PLN\"\n        assert result.confidence > 0\n        assert result.metadata[\"preprocessing_applied\"] is True\n>       assert \"contour_detection\" in result.metadata\nE       AssertionError: assert 'contour_detection' in {'confidence_distribution': {'high': 3, 'low': 0, 'medium': 0}, 'language': 'eng', 'original_metadata': {'file_size_bytes': 1156, 'format': 'PNG', 'mode': 'RGB', 'size': (400, 300)}, 'pages': 1, ...}\nE        +  where {'confidence_distribution': {'high': 3, 'low': 0, 'medium': 0}, 'language': 'eng', 'original_metadata': {'file_size_bytes': 1156, 'format': 'PNG', 'mode': 'RGB', 'size': (400, 300)}, 'pages': 1, ...} = OCRResult(text='Lidl\\nMleko 3.2% 1L 4,99 PLN\\nRAZEM 4,99 PLN', confidence=90.0, metadata={'source': 'image', 'pages': ..._time_seconds': 0.011956453323364258, 'text_blocks': 3, 'confidence_distribution': {'high': 3, 'medium': 0, 'low': 0}}).metadata\n\ntests/unit/test_ocr_advanced_preprocessing.py:225: AssertionError\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:57.991626\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Kontur za ma\\u0142y: 12.93% obrazu\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:57.991724\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Kontur za ma\\u0142y: 12.93% obrazu\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:57.993890\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (300, 400, 3) -> (708, 944, 3)\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:57.993937\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (300, 400, 3) -> (708, 944, 3)\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:57.994052\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:57.994081\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:57.996477\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:57.996513\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:58.000184\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:58.000219\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:58.000370\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": null, \"original_size\": [400, 300], \"processed_size\": [944, 708], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:58.000412\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": null, \"original_size\": [400, 300], \"processed_size\": [944, 708], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:58.000506\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": null, \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:58.000532\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": null, \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:58.000691\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": null, \"confidence\": 90.0, \"text_length\": 42, \"language\": \"eng\", \"processing_time_seconds\": 0.011956453323364258, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 3}\n{\"timestamp\": \"2025-07-06T23:27:58.000730\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": null, \"confidence\": 90.0, \"text_length\": 42, \"language\": \"eng\", \"processing_time_seconds\": 0.011956453323364258, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 3}\n------------------------------ Captured log call -------------------------------\nINFO     backend.core.ocr:ocr.py:129 Kontur za mały: 12.93% obrazu\nINFO     backend.core.ocr:ocr.py:271 Skalowanie do 300 DPI: (300, 400, 3) -> (708, 944, 3)\nINFO     backend.core.ocr:ocr.py:326 Przeskalowano do 300 DPI\nINFO     backend.core.ocr:ocr.py:330 Ulepszono kontrast i ostrość\nINFO     backend.core.ocr:ocr.py:334 Zastosowano adaptacyjny threshold\nINFO     backend.core.ocr:ocr.py:339 Preprocessing obrazu zakończony\nINFO     backend.core.ocr:ocr.py:383 Rozpoczynam OCR z ulepszoną konfiguracją\nINFO     backend.core.ocr:ocr.py:427 OCR przetwarzanie obrazu zakończone pomyślnie\n_____________ TestOCRAdvancedPreprocessing.test_metadata_tracking ______________\n\nself = <test_ocr_advanced_preprocessing.TestOCRAdvancedPreprocessing object at 0x7bbf0c867200>\nocr_processor = <backend.core.ocr.OCRProcessor object at 0x7bbf0c2df100>\n\n    def test_metadata_tracking(self, ocr_processor):\n        \"\"\"Test śledzenia metadanych preprocessingu.\"\"\"\n        metadata = {}\n    \n        # Symuluj różne kroki preprocessingu\n>       ocr_processor._add_preprocessing_step(metadata, \"contour_detection\", True)\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE       AttributeError: 'OCRProcessor' object has no attribute '_add_preprocessing_step'\n\ntests/unit/test_ocr_advanced_preprocessing.py:247: AttributeError\n____ TestOCRAdvancedPreprocessing.test_confidence_distribution_calculation _____\n\nself = <test_ocr_advanced_preprocessing.TestOCRAdvancedPreprocessing object at 0x7bbf0c72e0b0>\nocr_processor = <backend.core.ocr.OCRProcessor object at 0x7bbf0c2deea0>\n\n    def test_confidence_distribution_calculation(self, ocr_processor):\n        \"\"\"Test obliczania rozkładu pewności.\"\"\"\n        # Mock dane pewności\n        confidences = [95, 90, 85, 80, 75, 70, 65, 60, 55, 50]\n    \n>       distribution = ocr_processor._calculate_confidence_distribution(confidences)\n                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE       AttributeError: 'OCRProcessor' object has no attribute '_calculate_confidence_distribution'\n\ntests/unit/test_ocr_advanced_preprocessing.py:265: AttributeError\n__________ TestOCRAdvancedPreprocessing.test_processing_time_tracking __________\n\nself = <test_ocr_advanced_preprocessing.TestOCRAdvancedPreprocessing object at 0x7bbf0c72e510>\nocr_processor = <backend.core.ocr.OCRProcessor object at 0x7bbf0c2df360>\n\n    def test_processing_time_tracking(self, ocr_processor):\n        \"\"\"Test śledzenia czasu przetwarzania.\"\"\"\n        metadata = {}\n    \n        # Symuluj pomiar czasu\n>       with ocr_processor._measure_processing_time(metadata, \"ocr_processing\"):\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE       AttributeError: 'OCRProcessor' object has no attribute '_measure_processing_time'\n\ntests/unit/test_ocr_advanced_preprocessing.py:279: AttributeError\n______ TestOCRAdvancedPreprocessing.test_polish_receipt_text_recognition _______\n\nself = <test_ocr_advanced_preprocessing.TestOCRAdvancedPreprocessing object at 0x7bbf0c74c050>\nmock_tesseract = <MagicMock name='pytesseract' id='136060474353920'>\nocr_processor = <backend.core.ocr.OCRProcessor object at 0x7bbf0c2dec40>\nsample_receipt_image_bytes = b\"\\x89PNG\\r\\n\\x1a\\n\\x00\\x00\\x00\\rIHDR\\x00\\x00\\x01\\x90\\x00\\x00\\x01,\\x08\\x02\\x00\\x00\\x00b\\xd5r\\x95\\x00\\x00\\x04KIDATx\\x9c...@\\x86`\\x01\\x19\\x82\\x05d\\x08\\x16\\x90!X@\\x86`\\x01\\x19\\x82\\x05d\\xbc\\x01gp\\xb9>d\\xa9\\x05\\xb0\\x00\\x00\\x00\\x00IEND\\xaeB`\\x82\"\n\n    @patch(\"backend.core.ocr.pytesseract\")\n    def test_polish_receipt_text_recognition(\n        self, mock_tesseract, ocr_processor, sample_receipt_image_bytes\n    ):\n        \"\"\"Test rozpoznawania polskiego tekstu paragonu.\"\"\"\n        # Mock polski tekst paragonu\n        polish_text = [\n            \"Lidl sp. z o.o.\",\n            \"Mleko 3,2% 1L 4,99 zł\",\n            \"Chleb żytni 3,50 zł\",\n            \"RAZEM: 8,49 zł\",\n            \"NIP: 123-456-78-90\",\n        ]\n        mock_data = {\"text\": polish_text, \"conf\": [95, 90, 88, 92, 85]}\n        mock_tesseract.image_to_data.return_value = mock_data\n        mock_tesseract.Output.DICT = \"dict\"\n    \n        # Mock OpenCV functions\n        with patch(\"backend.core.ocr.cv2\") as mock_cv2:\n            mock_cv2.findContours.return_value = ([], None)\n            mock_cv2.boundingRect.return_value = (0, 0, 400, 300)\n            mock_cv2.cvtColor.return_value = np.array(\n                Image.new(\"RGB\", (400, 300), \"white\")\n            )\n            mock_cv2.COLOR_RGB2GRAY = 7\n            mock_cv2.getPerspectiveTransform.return_value = np.eye(3)\n            mock_cv2.warpPerspective.return_value = np.array(\n                Image.new(\"RGB\", (400, 300), \"white\")\n            )\n            mock_cv2.createCLAHE.return_value = Mock()\n            mock_cv2.morphologyEx.return_value = np.array(\n                Image.new(\"L\", (400, 300), 128)\n            )\n            mock_cv2.MORPH_CLOSE = 3\n            mock_cv2.getStructuringElement.return_value = np.ones((3, 3))\n            mock_cv2.MORPH_RECT = 0\n    \n        result = ocr_processor.process_image(sample_receipt_image_bytes)\n    \n        # Sprawdź czy polskie znaki zostały poprawnie rozpoznane\n        assert \"Lidl sp. z o.o.\" in result.text\n        assert \"Mleko 3,2% 1L 4,99 zł\" in result.text\n        assert \"Chleb żytni 3,50 zł\" in result.text\n        assert \"RAZEM: 8,49 zł\" in result.text\n        assert \"NIP: 123-456-78-90\" in result.text\n>       assert result.metadata[\"language\"] == \"pol\"\nE       AssertionError: assert 'eng' == 'pol'\nE         \nE         - pol\nE         + eng\n\ntests/unit/test_ocr_advanced_preprocessing.py:332: AssertionError\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:58.112344\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Kontur za ma\\u0142y: 12.93% obrazu\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:58.112439\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Kontur za ma\\u0142y: 12.93% obrazu\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:58.114436\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (300, 400, 3) -> (708, 944, 3)\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:58.114473\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (300, 400, 3) -> (708, 944, 3)\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:58.114572\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:58.114600\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:58.115949\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:58.115978\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:58.119613\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:58.119647\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:58.119766\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": null, \"original_size\": [400, 300], \"processed_size\": [944, 708], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:58.119793\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": null, \"original_size\": [400, 300], \"processed_size\": [944, 708], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:58.119875\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": null, \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:58.119902\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": null, \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:58.120052\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": null, \"confidence\": 90.0, \"text_length\": 91, \"language\": \"eng\", \"processing_time_seconds\": 0.009248733520507812, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 5}\n{\"timestamp\": \"2025-07-06T23:27:58.120095\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": null, \"confidence\": 90.0, \"text_length\": 91, \"language\": \"eng\", \"processing_time_seconds\": 0.009248733520507812, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 5}\n------------------------------ Captured log call -------------------------------\nINFO     backend.core.ocr:ocr.py:129 Kontur za mały: 12.93% obrazu\nINFO     backend.core.ocr:ocr.py:271 Skalowanie do 300 DPI: (300, 400, 3) -> (708, 944, 3)\nINFO     backend.core.ocr:ocr.py:326 Przeskalowano do 300 DPI\nINFO     backend.core.ocr:ocr.py:330 Ulepszono kontrast i ostrość\nINFO     backend.core.ocr:ocr.py:334 Zastosowano adaptacyjny threshold\nINFO     backend.core.ocr:ocr.py:339 Preprocessing obrazu zakończony\nINFO     backend.core.ocr:ocr.py:383 Rozpoczynam OCR z ulepszoną konfiguracją\nINFO     backend.core.ocr:ocr.py:427 OCR przetwarzanie obrazu zakończone pomyślnie\n___________ TestOCRAdvancedPreprocessing.test_image_quality_analysis ___________\n\nself = <test_ocr_advanced_preprocessing.TestOCRAdvancedPreprocessing object at 0x7bbf0c7441d0>\nocr_processor = <backend.core.ocr.OCRProcessor object at 0x7bbf0c2df950>\n\n    def test_image_quality_analysis(self, ocr_processor):\n        \"\"\"Test analizy jakości obrazu.\"\"\"\n        # Tworzy obraz o różnej jakości\n        good_image = Image.new(\"RGB\", (800, 600), \"white\")\n        poor_image = Image.new(\"RGB\", (200, 150), \"gray\")\n    \n        # Test dobrej jakości\n>       quality_good = ocr_processor._analyze_image_quality(good_image)\n                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE       AttributeError: 'OCRProcessor' object has no attribute '_analyze_image_quality'\n\ntests/unit/test_ocr_advanced_preprocessing.py:341: AttributeError\n__________ TestReceiptAgentWorkflow.test_receipt_import_agent_success __________\n\nself = <test_receipt_agent_workflow.TestReceiptAgentWorkflow object at 0x7bbf0c526c10>\nsample_receipt_image_bytes = b'fake_receipt_image_bytes'\n\n    @pytest.mark.asyncio\n    async def test_receipt_import_agent_success(self, sample_receipt_image_bytes):\n        \"\"\"Test pomyślnego działania ReceiptImportAgent.\"\"\"\n>       with patch(\"backend.agents.receipt_import_agent.OCRProcessor\") as mock_ocr:\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntests/integration/test_receipt_agent_workflow.py:95: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <unittest.mock._patch object at 0x7bbf0c2cbbd0>\n\n    def get_original(self):\n        target = self.getter()\n        name = self.attribute\n    \n        original = DEFAULT\n        local = False\n    \n        try:\n            original = target.__dict__[name]\n        except (AttributeError, KeyError):\n            original = getattr(target, name, DEFAULT)\n        else:\n            local = True\n    \n        if name in _builtins and isinstance(target, ModuleType):\n            self.create = True\n    \n        if not self.create and original is DEFAULT:\n>           raise AttributeError(\n                \"%s does not have the attribute %r\" % (target, name)\n            )\nE           AttributeError: <module 'backend.agents.receipt_import_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_import_agent.py'> does not have the attribute 'OCRProcessor'\n\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: AttributeError\n________ TestReceiptAgentWorkflow.test_receipt_import_agent_ocr_failure ________\n\nself = <test_receipt_agent_workflow.TestReceiptAgentWorkflow object at 0x7bbf0c526d50>\nsample_receipt_image_bytes = b'fake_receipt_image_bytes'\n\n    @pytest.mark.asyncio\n    async def test_receipt_import_agent_ocr_failure(self, sample_receipt_image_bytes):\n        \"\"\"Test błędu OCR w ReceiptImportAgent.\"\"\"\n>       with patch(\"backend.agents.receipt_import_agent.OCRProcessor\") as mock_ocr:\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntests/integration/test_receipt_agent_workflow.py:117: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <unittest.mock._patch object at 0x7bbf0c2ed010>\n\n    def get_original(self):\n        target = self.getter()\n        name = self.attribute\n    \n        original = DEFAULT\n        local = False\n    \n        try:\n            original = target.__dict__[name]\n        except (AttributeError, KeyError):\n            original = getattr(target, name, DEFAULT)\n        else:\n            local = True\n    \n        if name in _builtins and isinstance(target, ModuleType):\n            self.create = True\n    \n        if not self.create and original is DEFAULT:\n>           raise AttributeError(\n                \"%s does not have the attribute %r\" % (target, name)\n            )\nE           AttributeError: <module 'backend.agents.receipt_import_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_import_agent.py'> does not have the attribute 'OCRProcessor'\n\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: AttributeError\n________ TestReceiptAgentWorkflow.test_receipt_validation_agent_success ________\n\nself = <test_receipt_agent_workflow.TestReceiptAgentWorkflow object at 0x7bbf0c6de2c0>\nmock_ocr_text = 'Lidl sp. z o.o.\\n        ul. Testowa 123, 00-000 Warszawa\\n        NIP: 123-456-78-90\\n\\n        Mleko 3,2% 1L 4,99 z...\\n        Jogurt naturalny 2,99 zł\\n\\n        RAZEM: 11,48 zł\\n        VAT: 2,23 zł\\n        Data: 2024-01-15 14:30:25'\n\n    @pytest.mark.asyncio\n    async def test_receipt_validation_agent_success(self, mock_ocr_text):\n        \"\"\"Test pomyślnego działania ReceiptValidationAgent.\"\"\"\n        agent = ReceiptValidationAgent()\n        result = await agent.process(mock_ocr_text)\n    \n>       assert result.success is True\nE       assert False is True\nE        +  where False = AgentResponse(success=False, text=None, data=None, error=\"Błąd walidacji danych wejściowych: 1 validation error for Re...one, request_id=None, trace_id=None, span_id=None, parent_span_id=None, is_cached=None, cache_key=None, cache_ttl=None).success\n\ntests/integration/test_receipt_agent_workflow.py:137: AssertionError\n____ TestReceiptAgentWorkflow.test_receipt_validation_agent_invalid_receipt ____\n\nself = <test_receipt_agent_workflow.TestReceiptAgentWorkflow object at 0x7bbf0c6de3f0>\n\n    @pytest.mark.asyncio\n    async def test_receipt_validation_agent_invalid_receipt(self):\n        \"\"\"Test walidacji nieprawidłowego paragonu.\"\"\"\n        invalid_text = \"Invalid receipt text without proper structure\"\n    \n        agent = ReceiptValidationAgent()\n        result = await agent.process(invalid_text)\n    \n>       assert result.success is True\nE       assert False is True\nE        +  where False = AgentResponse(success=False, text=None, data=None, error=\"Błąd walidacji danych wejściowych: 1 validation error for Re...one, request_id=None, trace_id=None, span_id=None, parent_span_id=None, is_cached=None, cache_key=None, cache_ttl=None).success\n\ntests/integration/test_receipt_agent_workflow.py:153: AssertionError\n____ TestReceiptAgentWorkflow.test_receipt_validation_agent_nip_validation _____\n\nself = <test_receipt_agent_workflow.TestReceiptAgentWorkflow object at 0x7bbf0c56c710>\n\n    @pytest.mark.asyncio\n    async def test_receipt_validation_agent_nip_validation(self):\n        \"\"\"Test walidacji NIP.\"\"\"\n        text_with_valid_nip = \"\"\"Lidl sp. z o.o.\n        NIP: 123-456-78-90\n        Mleko 3,2% 1L 4,99 zł\n        RAZEM: 4,99 zł\"\"\"\n    \n        text_with_invalid_nip = \"\"\"Lidl sp. z o.o.\n        NIP: 123-456-78-XX\n        Mleko 3,2% 1L 4,99 zł\n        RAZEM: 4,99 zł\"\"\"\n    \n        agent = ReceiptValidationAgent()\n    \n        # Test z poprawnym NIP\n        result_valid = await agent.process(text_with_valid_nip)\n>       assert result_valid.data[\"nip_valid\"] is True\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE       TypeError: 'NoneType' object is not subscriptable\n\ntests/integration/test_receipt_agent_workflow.py:176: TypeError\n______ TestReceiptAgentWorkflow.test_receipt_categorization_agent_success ______\n\nself = <test_receipt_agent_workflow.TestReceiptAgentWorkflow object at 0x7bbf0c86f570>\nmock_ocr_text = 'Lidl sp. z o.o.\\n        ul. Testowa 123, 00-000 Warszawa\\n        NIP: 123-456-78-90\\n\\n        Mleko 3,2% 1L 4,99 z...\\n        Jogurt naturalny 2,99 zł\\n\\n        RAZEM: 11,48 zł\\n        VAT: 2,23 zł\\n        Data: 2024-01-15 14:30:25'\n\n    @pytest.mark.asyncio\n    async def test_receipt_categorization_agent_success(self, mock_ocr_text):\n        \"\"\"Test pomyślnego działania ReceiptCategorizationAgent.\"\"\"\n>       with patch(\n            \"backend.agents.receipt_categorization_agent.BielikAIClient\"\n        ) as mock_bielik:\n\ntests/integration/test_receipt_agent_workflow.py:185: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <unittest.mock._patch object at 0x7bbf0c453850>\n\n    def get_original(self):\n        target = self.getter()\n        name = self.attribute\n    \n        original = DEFAULT\n        local = False\n    \n        try:\n            original = target.__dict__[name]\n        except (AttributeError, KeyError):\n            original = getattr(target, name, DEFAULT)\n        else:\n            local = True\n    \n        if name in _builtins and isinstance(target, ModuleType):\n            self.create = True\n    \n        if not self.create and original is DEFAULT:\n>           raise AttributeError(\n                \"%s does not have the attribute %r\" % (target, name)\n            )\nE           AttributeError: <module 'backend.agents.receipt_categorization_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_categorization_agent.py'> does not have the attribute 'BielikAIClient'\n\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: AttributeError\n_ TestReceiptAgentWorkflow.test_receipt_categorization_agent_fallback_to_dictionary _\n\nself = <test_receipt_agent_workflow.TestReceiptAgentWorkflow object at 0x7bbf0c86f680>\nmock_ocr_text = 'Lidl sp. z o.o.\\n        ul. Testowa 123, 00-000 Warszawa\\n        NIP: 123-456-78-90\\n\\n        Mleko 3,2% 1L 4,99 z...\\n        Jogurt naturalny 2,99 zł\\n\\n        RAZEM: 11,48 zł\\n        VAT: 2,23 zł\\n        Data: 2024-01-15 14:30:25'\n\n    @pytest.mark.asyncio\n    async def test_receipt_categorization_agent_fallback_to_dictionary(\n        self, mock_ocr_text\n    ):\n        \"\"\"Test fallback do słownika kategorii.\"\"\"\n>       with patch(\n            \"backend.agents.receipt_categorization_agent.BielikAIClient\"\n        ) as mock_bielik:\n\ntests/integration/test_receipt_agent_workflow.py:215: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <unittest.mock._patch object at 0x7bbf0c4533f0>\n\n    def get_original(self):\n        target = self.getter()\n        name = self.attribute\n    \n        original = DEFAULT\n        local = False\n    \n        try:\n            original = target.__dict__[name]\n        except (AttributeError, KeyError):\n            original = getattr(target, name, DEFAULT)\n        else:\n            local = True\n    \n        if name in _builtins and isinstance(target, ModuleType):\n            self.create = True\n    \n        if not self.create and original is DEFAULT:\n>           raise AttributeError(\n                \"%s does not have the attribute %r\" % (target, name)\n            )\nE           AttributeError: <module 'backend.agents.receipt_categorization_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_categorization_agent.py'> does not have the attribute 'BielikAIClient'\n\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: AttributeError\n___________ TestReceiptAgentWorkflow.test_complete_workflow_success ____________\n\nself = <test_receipt_agent_workflow.TestReceiptAgentWorkflow object at 0x7bbf0c6e6250>\nclient = <starlette.testclient.TestClient object at 0x7bbf0c707cb0>\nsample_receipt_image_bytes = b'fake_receipt_image_bytes'\nmock_ocr_text = 'Lidl sp. z o.o.\\n        ul. Testowa 123, 00-000 Warszawa\\n        NIP: 123-456-78-90\\n\\n        Mleko 3,2% 1L 4,99 z...\\n        Jogurt naturalny 2,99 zł\\n\\n        RAZEM: 11,48 zł\\n        VAT: 2,23 zł\\n        Data: 2024-01-15 14:30:25'\nmock_validation_result = {'is_valid': True, 'recommendations': ['Consider retaking photo for better NIP clarity'], 'score': 85.5, 'should_proceed': True, ...}\nmock_categorization_result = {'date': '2024-01-15', 'products': [{'category': 'Dairy Products', 'confidence': 0.95, 'name': 'Mleko 3,2% 1L', 'quant...ts', 'confidence': 0.92, 'name': 'Jogurt naturalny', 'quantity': 1, ...}], 'store_name': 'Lidl', 'total_amount': 11.48}\n\n    @pytest.mark.asyncio\n    async def test_complete_workflow_success(\n        self,\n        client,\n        sample_receipt_image_bytes,\n        mock_ocr_text,\n        mock_validation_result,\n        mock_categorization_result,\n    ):\n        \"\"\"Test kompletnego workflow'u przetwarzania paragonu.\"\"\"\n        with (\n>           patch(\"backend.agents.receipt_import_agent.OCRProcessor\") as mock_ocr,\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n            patch(\n                \"backend.agents.receipt_validation_agent.ReceiptValidationAgent.process\"\n            ) as mock_validation,\n            patch(\n                \"backend.agents.receipt_categorization_agent.ReceiptCategorizationAgent.process\"\n            ) as mock_categorization,\n        ):\n\ntests/integration/test_receipt_agent_workflow.py:245: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <unittest.mock._patch object at 0x7bbf0c39c2f0>\n\n    def get_original(self):\n        target = self.getter()\n        name = self.attribute\n    \n        original = DEFAULT\n        local = False\n    \n        try:\n            original = target.__dict__[name]\n        except (AttributeError, KeyError):\n            original = getattr(target, name, DEFAULT)\n        else:\n            local = True\n    \n        if name in _builtins and isinstance(target, ModuleType):\n            self.create = True\n    \n        if not self.create and original is DEFAULT:\n>           raise AttributeError(\n                \"%s does not have the attribute %r\" % (target, name)\n            )\nE           AttributeError: <module 'backend.agents.receipt_import_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_import_agent.py'> does not have the attribute 'OCRProcessor'\n\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: AttributeError\n__________ TestReceiptAgentWorkflow.test_workflow_validation_failure ___________\n\nself = <test_receipt_agent_workflow.TestReceiptAgentWorkflow object at 0x7bbf0c6e6350>\nclient = <starlette.testclient.TestClient object at 0x7bbf0c3ea710>\nsample_receipt_image_bytes = b'fake_receipt_image_bytes'\nmock_ocr_text = 'Lidl sp. z o.o.\\n        ul. Testowa 123, 00-000 Warszawa\\n        NIP: 123-456-78-90\\n\\n        Mleko 3,2% 1L 4,99 z...\\n        Jogurt naturalny 2,99 zł\\n\\n        RAZEM: 11,48 zł\\n        VAT: 2,23 zł\\n        Data: 2024-01-15 14:30:25'\n\n    @pytest.mark.asyncio\n    async def test_workflow_validation_failure(\n        self, client, sample_receipt_image_bytes, mock_ocr_text\n    ):\n        \"\"\"Test workflow'u z błędem walidacji.\"\"\"\n        with (\n>           patch(\"backend.agents.receipt_import_agent.OCRProcessor\") as mock_ocr,\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n            patch(\n                \"backend.agents.receipt_validation_agent.ReceiptValidationAgent.process\"\n            ) as mock_validation,\n        ):\n\ntests/integration/test_receipt_agent_workflow.py:292: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <unittest.mock._patch object at 0x7bbf0c39ecf0>\n\n    def get_original(self):\n        target = self.getter()\n        name = self.attribute\n    \n        original = DEFAULT\n        local = False\n    \n        try:\n            original = target.__dict__[name]\n        except (AttributeError, KeyError):\n            original = getattr(target, name, DEFAULT)\n        else:\n            local = True\n    \n        if name in _builtins and isinstance(target, ModuleType):\n            self.create = True\n    \n        if not self.create and original is DEFAULT:\n>           raise AttributeError(\n                \"%s does not have the attribute %r\" % (target, name)\n            )\nE           AttributeError: <module 'backend.agents.receipt_import_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_import_agent.py'> does not have the attribute 'OCRProcessor'\n\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: AttributeError\n________ TestReceiptAgentWorkflow.test_workflow_categorization_failure _________\n\nself = <test_receipt_agent_workflow.TestReceiptAgentWorkflow object at 0x7bbf0c5477a0>\nclient = <starlette.testclient.TestClient object at 0x7bbf0c3ea350>\nsample_receipt_image_bytes = b'fake_receipt_image_bytes'\nmock_ocr_text = 'Lidl sp. z o.o.\\n        ul. Testowa 123, 00-000 Warszawa\\n        NIP: 123-456-78-90\\n\\n        Mleko 3,2% 1L 4,99 z...\\n        Jogurt naturalny 2,99 zł\\n\\n        RAZEM: 11,48 zł\\n        VAT: 2,23 zł\\n        Data: 2024-01-15 14:30:25'\nmock_validation_result = {'is_valid': True, 'recommendations': ['Consider retaking photo for better NIP clarity'], 'score': 85.5, 'should_proceed': True, ...}\n\n    @pytest.mark.asyncio\n    async def test_workflow_categorization_failure(\n        self, client, sample_receipt_image_bytes, mock_ocr_text, mock_validation_result\n    ):\n        \"\"\"Test workflow'u z błędem kategoryzacji.\"\"\"\n        with (\n>           patch(\"backend.agents.receipt_import_agent.OCRProcessor\") as mock_ocr,\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n            patch(\n                \"backend.agents.receipt_validation_agent.ReceiptValidationAgent.process\"\n            ) as mock_validation,\n            patch(\n                \"backend.agents.receipt_categorization_agent.ReceiptCategorizationAgent.process\"\n            ) as mock_categorization,\n        ):\n\ntests/integration/test_receipt_agent_workflow.py:332: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <unittest.mock._patch object at 0x7bbf0c4527b0>\n\n    def get_original(self):\n        target = self.getter()\n        name = self.attribute\n    \n        original = DEFAULT\n        local = False\n    \n        try:\n            original = target.__dict__[name]\n        except (AttributeError, KeyError):\n            original = getattr(target, name, DEFAULT)\n        else:\n            local = True\n    \n        if name in _builtins and isinstance(target, ModuleType):\n            self.create = True\n    \n        if not self.create and original is DEFAULT:\n>           raise AttributeError(\n                \"%s does not have the attribute %r\" % (target, name)\n            )\nE           AttributeError: <module 'backend.agents.receipt_import_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_import_agent.py'> does not have the attribute 'OCRProcessor'\n\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: AttributeError\n_______ TestReceiptAgentWorkflow.test_agent_error_handling_and_recovery ________\n\nself = <test_receipt_agent_workflow.TestReceiptAgentWorkflow object at 0x7bbf0c547890>\nsample_receipt_image_bytes = b'fake_receipt_image_bytes'\n\n    @pytest.mark.asyncio\n    async def test_agent_error_handling_and_recovery(self, sample_receipt_image_bytes):\n        \"\"\"Test obsługi błędów i odzyskiwania w agentach.\"\"\"\n        # Test ReceiptImportAgent z błędem i retry\n>       with patch(\"backend.agents.receipt_import_agent.OCRProcessor\") as mock_ocr:\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntests/integration/test_receipt_agent_workflow.py:370: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <unittest.mock._patch object at 0x7bbf0c584f30>\n\n    def get_original(self):\n        target = self.getter()\n        name = self.attribute\n    \n        original = DEFAULT\n        local = False\n    \n        try:\n            original = target.__dict__[name]\n        except (AttributeError, KeyError):\n            original = getattr(target, name, DEFAULT)\n        else:\n            local = True\n    \n        if name in _builtins and isinstance(target, ModuleType):\n            self.create = True\n    \n        if not self.create and original is DEFAULT:\n>           raise AttributeError(\n                \"%s does not have the attribute %r\" % (target, name)\n            )\nE           AttributeError: <module 'backend.agents.receipt_import_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_import_agent.py'> does not have the attribute 'OCRProcessor'\n\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: AttributeError\n____________ TestReceiptAgentWorkflow.test_agent_metadata_tracking _____________\n\nself = <test_receipt_agent_workflow.TestReceiptAgentWorkflow object at 0x7bbf0c585b70>\nmock_ocr_text = 'Lidl sp. z o.o.\\n        ul. Testowa 123, 00-000 Warszawa\\n        NIP: 123-456-78-90\\n\\n        Mleko 3,2% 1L 4,99 z...\\n        Jogurt naturalny 2,99 zł\\n\\n        RAZEM: 11,48 zł\\n        VAT: 2,23 zł\\n        Data: 2024-01-15 14:30:25'\n\n    @pytest.mark.asyncio\n    async def test_agent_metadata_tracking(self, mock_ocr_text):\n        \"\"\"Test śledzenia metadanych w agentach.\"\"\"\n        # Test ReceiptValidationAgent z metadanymi\n        agent = ReceiptValidationAgent()\n        result = await agent.process(mock_ocr_text)\n    \n>       assert result.success is True\nE       assert False is True\nE        +  where False = AgentResponse(success=False, text=None, data=None, error=\"Błąd walidacji danych wejściowych: 1 validation error for Re...one, request_id=None, trace_id=None, span_id=None, parent_span_id=None, is_cached=None, cache_key=None, cache_ttl=None).success\n\ntests/integration/test_receipt_agent_workflow.py:393: AssertionError\n__________ TestReceiptAgentWorkflow.test_agent_performance_monitoring __________\n\nself = <test_receipt_agent_workflow.TestReceiptAgentWorkflow object at 0x7bbf0c585fd0>\nmock_ocr_text = 'Lidl sp. z o.o.\\n        ul. Testowa 123, 00-000 Warszawa\\n        NIP: 123-456-78-90\\n\\n        Mleko 3,2% 1L 4,99 z...\\n        Jogurt naturalny 2,99 zł\\n\\n        RAZEM: 11,48 zł\\n        VAT: 2,23 zł\\n        Data: 2024-01-15 14:30:25'\n\n    @pytest.mark.asyncio\n    async def test_agent_performance_monitoring(self, mock_ocr_text):\n        \"\"\"Test monitorowania wydajności agentów.\"\"\"\n        import time\n    \n        # Test czasu przetwarzania ReceiptValidationAgent\n        start_time = time.time()\n        agent = ReceiptValidationAgent()\n        result = await agent.process(mock_ocr_text)\n        end_time = time.time()\n    \n        processing_time = end_time - start_time\n    \n>       assert result.success is True\nE       assert False is True\nE        +  where False = AgentResponse(success=False, text=None, data=None, error=\"Błąd walidacji danych wejściowych: 1 validation error for Re...one, request_id=None, trace_id=None, span_id=None, parent_span_id=None, is_cached=None, cache_key=None, cache_ttl=None).success\n\ntests/integration/test_receipt_agent_workflow.py:411: AssertionError\n__________ TestReceiptAgentWorkflow.test_agent_concurrent_processing ___________\n\nself = <test_receipt_agent_workflow.TestReceiptAgentWorkflow object at 0x7bbf0c54af70>\nmock_ocr_text = 'Lidl sp. z o.o.\\n        ul. Testowa 123, 00-000 Warszawa\\n        NIP: 123-456-78-90\\n\\n        Mleko 3,2% 1L 4,99 z...\\n        Jogurt naturalny 2,99 zł\\n\\n        RAZEM: 11,48 zł\\n        VAT: 2,23 zł\\n        Data: 2024-01-15 14:30:25'\n\n    @pytest.mark.asyncio\n    async def test_agent_concurrent_processing(self, mock_ocr_text):\n        \"\"\"Test współbieżnego przetwarzania przez agentów.\"\"\"\n        import asyncio\n    \n        # Test współbieżnego przetwarzania przez ReceiptValidationAgent\n        agent = ReceiptValidationAgent()\n    \n        # Uruchom kilka zadań współbieżnie\n        tasks = [\n            agent.process(mock_ocr_text),\n            agent.process(mock_ocr_text),\n            agent.process(mock_ocr_text),\n        ]\n    \n        results = await asyncio.gather(*tasks)\n    \n        # Sprawdź czy wszystkie zadania zakończyły się sukcesem\n        for result in results:\n>           assert result.success is True\nE           assert False is True\nE            +  where False = AgentResponse(success=False, text=None, data=None, error=\"Błąd walidacji danych wejściowych: 1 validation error for Re...one, request_id=None, trace_id=None, span_id=None, parent_span_id=None, is_cached=None, cache_key=None, cache_ttl=None).success\n\ntests/integration/test_receipt_agent_workflow.py:437: AssertionError\n____________ TestReceiptAgentWorkflow.test_agent_memory_management _____________\n\nself = <test_receipt_agent_workflow.TestReceiptAgentWorkflow object at 0x7bbf0c744050>\nmock_ocr_text = 'Lidl sp. z o.o.\\n        ul. Testowa 123, 00-000 Warszawa\\n        NIP: 123-456-78-90\\n\\n        Mleko 3,2% 1L 4,99 z...\\n        Jogurt naturalny 2,99 zł\\n\\n        RAZEM: 11,48 zł\\n        VAT: 2,23 zł\\n        Data: 2024-01-15 14:30:25'\n\n    @pytest.mark.asyncio\n    async def test_agent_memory_management(self, mock_ocr_text):\n        \"\"\"Test zarządzania pamięcią przez agentów.\"\"\"\n        import gc\n    \n        # Test ReceiptCategorizationAgent z zarządzaniem pamięcią\n>       with patch(\n            \"backend.agents.receipt_categorization_agent.BielikAIClient\"\n        ) as mock_bielik:\n\ntests/integration/test_receipt_agent_workflow.py:446: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <unittest.mock._patch object at 0x7bbf0c39def0>\n\n    def get_original(self):\n        target = self.getter()\n        name = self.attribute\n    \n        original = DEFAULT\n        local = False\n    \n        try:\n            original = target.__dict__[name]\n        except (AttributeError, KeyError):\n            original = getattr(target, name, DEFAULT)\n        else:\n            local = True\n    \n        if name in _builtins and isinstance(target, ModuleType):\n            self.create = True\n    \n        if not self.create and original is DEFAULT:\n>           raise AttributeError(\n                \"%s does not have the attribute %r\" % (target, name)\n            )\nE           AttributeError: <module 'backend.agents.receipt_categorization_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_categorization_agent.py'> does not have the attribute 'BielikAIClient'\n\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: AttributeError\n_________ TestReceiptAgentWorkflow.test_agent_configuration_validation _________\n\nself = <test_receipt_agent_workflow.TestReceiptAgentWorkflow object at 0x7bbf0c744950>\n\n    @pytest.mark.asyncio\n    async def test_agent_configuration_validation(self):\n        \"\"\"Test walidacji konfiguracji agentów.\"\"\"\n        # Test ReceiptValidationAgent z nieprawidłową konfiguracją\n        agent = ReceiptValidationAgent()\n    \n        # Sprawdź czy agent ma wymagane atrybuty\n        assert hasattr(agent, \"name\")\n>       assert hasattr(agent, \"description\")\nE       AssertionError: assert False\nE        +  where False = hasattr(<backend.agents.receipt_validation_agent.ReceiptValidationAgent object at 0x7bbf0c2a1bf0>, 'description')\n\ntests/integration/test_receipt_agent_workflow.py:474: AssertionError\n_______ TestReceiptAgentWorkflow.test_agent_response_format_consistency ________\n\nself = <test_receipt_agent_workflow.TestReceiptAgentWorkflow object at 0x7bbf0c75d0d0>\nmock_ocr_text = 'Lidl sp. z o.o.\\n        ul. Testowa 123, 00-000 Warszawa\\n        NIP: 123-456-78-90\\n\\n        Mleko 3,2% 1L 4,99 z...\\n        Jogurt naturalny 2,99 zł\\n\\n        RAZEM: 11,48 zł\\n        VAT: 2,23 zł\\n        Data: 2024-01-15 14:30:25'\n\n    @pytest.mark.asyncio\n    async def test_agent_response_format_consistency(self, mock_ocr_text):\n        \"\"\"Test spójności formatu odpowiedzi agentów.\"\"\"\n        # Test wszystkich agentów\n        agents = [ReceiptValidationAgent(), ReceiptCategorizationAgent()]\n    \n        for agent in agents:\n            result = await agent.process(mock_ocr_text)\n    \n            # Sprawdź spójny format odpowiedzi\n            assert hasattr(result, \"success\")\n            assert hasattr(result, \"data\")\n            assert hasattr(result, \"metadata\")\n            assert hasattr(result, \"error\")\n    \n            # Sprawdź typy danych\n            assert isinstance(result.success, bool)\n>           assert isinstance(result.data, dict)\nE           assert False\nE            +  where False = isinstance(None, dict)\nE            +    where None = AgentResponse(success=False, text=None, data=None, error=\"Błąd walidacji danych wejściowych: 1 validation error for Re...one, request_id=None, trace_id=None, span_id=None, parent_span_id=None, is_cached=None, cache_key=None, cache_ttl=None).data\n\ntests/integration/test_receipt_agent_workflow.py:498: AssertionError\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:59.233875\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-117\"}\n{\"timestamp\": \"2025-07-06T23:27:59.233938\", \"level\": \"INFO\", \"logger\": \"backend.core.product_categorizer\", \"module\": \"product_categorizer\", \"message\": \"Za\\u0142adowano 35 kategorii produkt\\u00f3w\", \"levelno\": 20, \"taskName\": \"Task-117\"}\n------------------------------ Captured log call -------------------------------\nINFO     backend.core.product_categorizer:product_categorizer.py:23 Załadowano 35 kategorii produktów\n______ TestOCRPerformanceEnhanced.test_perspective_correction_performance ______\n\nself = <test_ocr_performance_enhanced.TestOCRPerformanceEnhanced object at 0x7bbf0c527110>\nocr_processor = <backend.core.ocr.OCRProcessor object at 0x7bbf0c354d60>\n\n    def test_perspective_correction_performance(self, ocr_processor):\n        \"\"\"Test wydajności korekcji perspektywy.\"\"\"\n        with patch(\"backend.core.ocr.cv2\") as mock_cv2:\n            # Mock OpenCV functions\n            mock_cv2.getPerspectiveTransform.return_value = np.eye(3)\n            mock_cv2.warpPerspective.return_value = np.array(\n                Image.new(\"RGB\", (400, 300), \"white\")\n            )\n    \n            # Test różnych rozmiarów obrazów\n            image_sizes = [(400, 300), (800, 600), (1600, 1200)]\n    \n            for width, height in image_sizes:\n                image = Image.new(\"RGB\", (width, height), \"white\")\n                contour_points = np.array(\n                    [[0, 0], [width, 0], [width, height], [0, height]], dtype=np.int32\n                )\n    \n                start_time = time.time()\n    \n>               ocr_processor._correct_perspective(image, contour_points)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE               AttributeError: 'OCRProcessor' object has no attribute '_correct_perspective'\n\ntests/performance/test_ocr_performance_enhanced.py:117: AttributeError\n______ TestOCRPerformanceEnhanced.test_adaptive_thresholding_performance _______\n\nself = <test_ocr_performance_enhanced.TestOCRPerformanceEnhanced object at 0x7bbf0c6de8b0>\nocr_processor = <backend.core.ocr.OCRProcessor object at 0x7bbf0c2df820>\n\n    def test_adaptive_thresholding_performance(self, ocr_processor):\n        \"\"\"Test wydajności adaptacyjnego progowania.\"\"\"\n        with patch(\"backend.core.ocr.cv2\") as mock_cv2:\n            # Mock CLAHE\n            mock_clahe = Mock()\n            mock_cv2.createCLAHE.return_value = mock_clahe\n            mock_clahe.apply.return_value = np.array(Image.new(\"L\", (400, 300), 128))\n    \n            # Mock morphological operations\n            mock_cv2.morphologyEx.return_value = np.array(\n                Image.new(\"L\", (400, 300), 128)\n            )\n            mock_cv2.MORPH_CLOSE = 3\n            mock_cv2.getStructuringElement.return_value = np.ones((3, 3))\n            mock_cv2.MORPH_RECT = 0\n    \n            # Test różnych rozmiarów obrazów\n            image_sizes = [(400, 300), (800, 600), (1600, 1200)]\n    \n            for width, height in image_sizes:\n                image = Image.new(\"L\", (width, height), 128)\n    \n                start_time = time.time()\n    \n>               ocr_processor._apply_adaptive_thresholding(image)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE               AttributeError: 'OCRProcessor' object has no attribute '_apply_adaptive_thresholding'\n\ntests/performance/test_ocr_performance_enhanced.py:152: AttributeError\n___ TestOCRPerformanceEnhanced.test_full_preprocessing_pipeline_performance ____\n\nself = <test_ocr_performance_enhanced.TestOCRPerformanceEnhanced object at 0x7bbf0c56e7b0>\nmock_tesseract = <MagicMock name='pytesseract' id='136060477665840'>\nocr_processor = <backend.core.ocr.OCRProcessor object at 0x7bbf0c2dec40>\nsample_receipt_image_bytes = b\"\\x89PNG\\r\\n\\x1a\\n\\x00\\x00\\x00\\rIHDR\\x00\\x00\\x03 \\x00\\x00\\x02X\\x08\\x02\\x00\\x00\\x00\\x15\\x14\\x15'\\x00\\x00\\n\\xaaIDATx\\x9...1\\x83\\x05\\x00\\x103X\\x00\\x001\\x83\\x05\\x00\\x103X\\x00\\x00\\xb1\\x0b\\x01d\\x07\\xad4\\xd1\\xd3\\x85\\x00\\x00\\x00\\x00IEND\\xaeB`\\x82\"\n\n    @patch(\"backend.core.ocr.pytesseract\")\n    def test_full_preprocessing_pipeline_performance(\n        self, mock_tesseract, ocr_processor, sample_receipt_image_bytes\n    ):\n        \"\"\"Test wydajności całego pipeline'u preprocessingu.\"\"\"\n        # Mock Tesseract\n        mock_data = {\"text\": [\"Test\", \"receipt\", \"text\"], \"conf\": [90, 85, 80]}\n        mock_tesseract.image_to_data.return_value = mock_data\n        mock_tesseract.Output.DICT = \"dict\"\n    \n        # Mock OpenCV functions\n        with patch(\"backend.core.ocr.cv2\") as mock_cv2:\n            mock_cv2.findContours.return_value = ([], None)\n            mock_cv2.boundingRect.return_value = (0, 0, 800, 600)\n            mock_cv2.cvtColor.return_value = np.array(\n                Image.new(\"RGB\", (800, 600), \"white\")\n            )\n            mock_cv2.COLOR_RGB2GRAY = 7\n            mock_cv2.getPerspectiveTransform.return_value = np.eye(3)\n            mock_cv2.warpPerspective.return_value = np.array(\n                Image.new(\"RGB\", (800, 600), \"white\")\n            )\n            mock_cv2.createCLAHE.return_value = Mock()\n            mock_cv2.morphologyEx.return_value = np.array(\n                Image.new(\"L\", (800, 600), 128)\n            )\n            mock_cv2.MORPH_CLOSE = 3\n            mock_cv2.getStructuringElement.return_value = np.ones((3, 3))\n            mock_cv2.MORPH_RECT = 0\n    \n            start_time = time.time()\n    \n            result = ocr_processor.process_image(sample_receipt_image_bytes)\n    \n            end_time = time.time()\n            total_processing_time = end_time - start_time\n    \n            # Sprawdź czy całkowity czas przetwarzania jest rozsądny\n            assert total_processing_time < 2.0, (\n                f\"Full pipeline took too long: {total_processing_time}s\"\n            )\n    \n    \n            # Sprawdź metadane czasowe\n>           assert \"preprocessing_time\" in result.metadata\nE           AssertionError: assert 'preprocessing_time' in {'confidence_distribution': {'high': 2, 'low': 0, 'medium': 1}, 'language': 'eng', 'original_metadata': {'file_size_bytes': 2787, 'format': 'PNG', 'mode': 'RGB', 'size': (800, 600)}, 'pages': 1, ...}\nE            +  where {'confidence_distribution': {'high': 2, 'low': 0, 'medium': 1}, 'language': 'eng', 'original_metadata': {'file_size_bytes': 2787, 'format': 'PNG', 'mode': 'RGB', 'size': (800, 600)}, 'pages': 1, ...} = OCRResult(text='Test\\nreceipt\\ntext', confidence=85.0, metadata={'source': 'image', 'pages': 1, 'language': 'eng', 'pr..._time_seconds': 0.008418798446655273, 'text_blocks': 3, 'confidence_distribution': {'high': 2, 'medium': 1, 'low': 0}}).metadata\n\ntests/performance/test_ocr_performance_enhanced.py:228: AssertionError\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:59.376260\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:59.376348\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:59.376950\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='136060474352576'>\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:59.376981\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='136060474352576'>\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:59.377049\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:59.377069\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:59.377753\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:59.377783\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:59.378541\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:59.378570\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": null}\n{\"timestamp\": \"2025-07-06T23:27:59.378679\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": null, \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:59.378705\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": null, \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:59.378781\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": null, \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:59.378805\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": null, \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:59.378928\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": null, \"confidence\": 85.0, \"text_length\": 17, \"language\": \"eng\", \"processing_time_seconds\": 0.008418798446655273, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 3}\n{\"timestamp\": \"2025-07-06T23:27:59.378965\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": null, \"confidence\": 85.0, \"text_length\": 17, \"language\": \"eng\", \"processing_time_seconds\": 0.008418798446655273, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 3}\n------------------------------ Captured log call -------------------------------\nINFO     backend.core.ocr:ocr.py:118 Nie znaleziono konturów w obrazie\nINFO     backend.core.ocr:ocr.py:271 Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='136060474352576'>\nINFO     backend.core.ocr:ocr.py:326 Przeskalowano do 300 DPI\nINFO     backend.core.ocr:ocr.py:330 Ulepszono kontrast i ostrość\nINFO     backend.core.ocr:ocr.py:334 Zastosowano adaptacyjny threshold\nINFO     backend.core.ocr:ocr.py:339 Preprocessing obrazu zakończony\nINFO     backend.core.ocr:ocr.py:383 Rozpoczynam OCR z ulepszoną konfiguracją\nINFO     backend.core.ocr:ocr.py:427 OCR przetwarzanie obrazu zakończone pomyślnie\n__________ TestOCRPerformanceEnhanced.test_agent_workflow_performance __________\n\nself = <test_ocr_performance_enhanced.TestOCRPerformanceEnhanced object at 0x7bbf0c86fac0>\nsample_receipt_image_bytes = b\"\\x89PNG\\r\\n\\x1a\\n\\x00\\x00\\x00\\rIHDR\\x00\\x00\\x03 \\x00\\x00\\x02X\\x08\\x02\\x00\\x00\\x00\\x15\\x14\\x15'\\x00\\x00\\n\\xaaIDATx\\x9...1\\x83\\x05\\x00\\x103X\\x00\\x001\\x83\\x05\\x00\\x103X\\x00\\x00\\xb1\\x0b\\x01d\\x07\\xad4\\xd1\\xd3\\x85\\x00\\x00\\x00\\x00IEND\\xaeB`\\x82\"\n\n    @pytest.mark.asyncio\n    async def test_agent_workflow_performance(self, sample_receipt_image_bytes):\n        \"\"\"Test wydajności całego workflow'u agentów.\"\"\"\n        # Mock OCR agent\n>       with patch(\"backend.agents.receipt_import_agent.OCRProcessor\") as mock_ocr:\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntests/performance/test_ocr_performance_enhanced.py:236: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../../../miniconda3/lib/python3.13/unittest/mock.py:1497: in __enter__\n    original, local = self.get_original()\n                      ^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <unittest.mock._patch object at 0x7bbf0c2c9010>\n\n    def get_original(self):\n        target = self.getter()\n        name = self.attribute\n    \n        original = DEFAULT\n        local = False\n    \n        try:\n            original = target.__dict__[name]\n        except (AttributeError, KeyError):\n            original = getattr(target, name, DEFAULT)\n        else:\n            local = True\n    \n        if name in _builtins and isinstance(target, ModuleType):\n            self.create = True\n    \n        if not self.create and original is DEFAULT:\n>           raise AttributeError(\n                \"%s does not have the attribute %r\" % (target, name)\n            )\nE           AttributeError: <module 'backend.agents.receipt_import_agent' from '/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/receipt_import_agent.py'> does not have the attribute 'OCRProcessor'\n\n../../../../miniconda3/lib/python3.13/unittest/mock.py:1467: AttributeError\n______ TestOCRPerformanceEnhanced.test_concurrent_processing_performance _______\n\nself = <test_ocr_performance_enhanced.TestOCRPerformanceEnhanced object at 0x7bbf0c6e6450>\nocr_processor = <backend.core.ocr.OCRProcessor object at 0x7bbf0c2df100>\n\n    def test_concurrent_processing_performance(self, ocr_processor):\n        \"\"\"Test wydajności przetwarzania współbieżnego.\"\"\"\n    \n        async def process_single_image(image_bytes):\n            with (\n                patch(\"backend.core.ocr.pytesseract\") as mock_tesseract,\n                patch(\"backend.core.ocr.cv2\") as mock_cv2,\n            ):\n                mock_tesseract.image_to_data.return_value = {\n                    \"text\": [\"test\"],\n                    \"conf\": [90],\n                }\n                mock_tesseract.Output.DICT = \"dict\"\n                mock_cv2.findContours.return_value = ([], None)\n                mock_cv2.boundingRect.return_value = (0, 0, 800, 600)\n                mock_cv2.cvtColor.return_value = np.array(\n                    Image.new(\"RGB\", (800, 600), \"white\")\n                )\n                mock_cv2.COLOR_RGB2GRAY = 7\n                mock_cv2.getPerspectiveTransform.return_value = np.eye(3)\n                mock_cv2.warpPerspective.return_value = np.array(\n                    Image.new(\"RGB\", (800, 600), \"white\")\n                )\n                mock_cv2.createCLAHE.return_value = Mock()\n                mock_cv2.morphologyEx.return_value = np.array(\n                    Image.new(\"L\", (800, 600), 128)\n                )\n                mock_cv2.MORPH_CLOSE = 3\n                mock_cv2.getStructuringElement.return_value = np.ones((3, 3))\n                mock_cv2.MORPH_RECT = 0\n    \n                return ocr_processor.process_image(image_bytes)\n    \n        # Tworzy kilka obrazów testowych\n        test_images = []\n        for i in range(5):\n            image = Image.new(\"RGB\", (800, 600), \"white\")\n            import io\n    \n            img_byte_arr = io.BytesIO()\n            image.save(img_byte_arr, format=\"PNG\")\n            test_images.append(img_byte_arr.getvalue())\n    \n        # Test przetwarzania sekwencyjnego\n        start_time = time.time()\n        sequential_results = []\n        for image_bytes in test_images:\n            result = asyncio.run(process_single_image(image_bytes))\n            sequential_results.append(result)\n        sequential_time = time.time() - start_time\n    \n        # Test przetwarzania współbieżnego\n        start_time = time.time()\n        asyncio.run(\n>           asyncio.gather(\n                *[process_single_image(image_bytes) for image_bytes in test_images]\n            )\n        )\n\ntests/performance/test_ocr_performance_enhanced.py:402: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n../../../../miniconda3/lib/python3.13/asyncio/tasks.py:884: in gather\n    fut = ensure_future(arg, loop=loop)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n../../../../miniconda3/lib/python3.13/asyncio/tasks.py:746: in ensure_future\n    loop = events.get_event_loop()\n           ^^^^^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <asyncio.unix_events._UnixDefaultEventLoopPolicy object at 0x7bbf0c704050>\n\n    def get_event_loop(self):\n        \"\"\"Get the event loop for the current context.\n    \n        Returns an instance of EventLoop or raises an exception.\n        \"\"\"\n        if (self._local._loop is None and\n                not self._local._set_called and\n                threading.current_thread() is threading.main_thread()):\n            stacklevel = 2\n            try:\n                f = sys._getframe(1)\n            except AttributeError:\n                pass\n            else:\n                # Move up the call stack so that the warning is attached\n                # to the line outside asyncio itself.\n                while f:\n                    module = f.f_globals.get('__name__')\n                    if not (module == 'asyncio' or module.startswith('asyncio.')):\n                        break\n                    f = f.f_back\n                    stacklevel += 1\n            import warnings\n            warnings.warn('There is no current event loop',\n                          DeprecationWarning, stacklevel=stacklevel)\n            self.set_event_loop(self.new_event_loop())\n    \n        if self._local._loop is None:\n>           raise RuntimeError('There is no current event loop in thread %r.'\n                               % threading.current_thread().name)\nE           RuntimeError: There is no current event loop in thread 'MainThread'.\n\n../../../../miniconda3/lib/python3.13/asyncio/events.py:716: RuntimeError\n----------------------------- Captured stdout call -----------------------------\n{\"timestamp\": \"2025-07-06T23:27:59.610661\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-143\"}\n{\"timestamp\": \"2025-07-06T23:27:59.610747\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-143\"}\n{\"timestamp\": \"2025-07-06T23:27:59.611335\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='136060472129392'>\", \"levelno\": 20, \"taskName\": \"Task-143\"}\n{\"timestamp\": \"2025-07-06T23:27:59.611364\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='136060472129392'>\", \"levelno\": 20, \"taskName\": \"Task-143\"}\n{\"timestamp\": \"2025-07-06T23:27:59.611440\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-143\"}\n{\"timestamp\": \"2025-07-06T23:27:59.611463\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-143\"}\n{\"timestamp\": \"2025-07-06T23:27:59.612115\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-143\"}\n{\"timestamp\": \"2025-07-06T23:27:59.612141\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-143\"}\n{\"timestamp\": \"2025-07-06T23:27:59.612967\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-143\"}\n{\"timestamp\": \"2025-07-06T23:27:59.612997\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-143\"}\n{\"timestamp\": \"2025-07-06T23:27:59.613125\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-143\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:59.613152\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-143\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:59.613228\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-143\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:59.613253\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-143\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:59.613371\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-143\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.008663654327392578, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n{\"timestamp\": \"2025-07-06T23:27:59.613417\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-143\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.008663654327392578, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n{\"timestamp\": \"2025-07-06T23:27:59.624864\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-146\"}\n{\"timestamp\": \"2025-07-06T23:27:59.624946\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-146\"}\n{\"timestamp\": \"2025-07-06T23:27:59.625609\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='136060472620912'>\", \"levelno\": 20, \"taskName\": \"Task-146\"}\n{\"timestamp\": \"2025-07-06T23:27:59.625641\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='136060472620912'>\", \"levelno\": 20, \"taskName\": \"Task-146\"}\n{\"timestamp\": \"2025-07-06T23:27:59.625709\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-146\"}\n{\"timestamp\": \"2025-07-06T23:27:59.625730\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-146\"}\n{\"timestamp\": \"2025-07-06T23:27:59.626380\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-146\"}\n{\"timestamp\": \"2025-07-06T23:27:59.626415\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-146\"}\n{\"timestamp\": \"2025-07-06T23:27:59.627177\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-146\"}\n{\"timestamp\": \"2025-07-06T23:27:59.627204\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-146\"}\n{\"timestamp\": \"2025-07-06T23:27:59.627331\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-146\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:59.627357\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-146\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:59.627438\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-146\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:59.627466\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-146\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:59.627594\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-146\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.01031351089477539, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n{\"timestamp\": \"2025-07-06T23:27:59.627624\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-146\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.01031351089477539, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n{\"timestamp\": \"2025-07-06T23:27:59.635581\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-149\"}\n{\"timestamp\": \"2025-07-06T23:27:59.635645\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-149\"}\n{\"timestamp\": \"2025-07-06T23:27:59.636217\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='136060474350560'>\", \"levelno\": 20, \"taskName\": \"Task-149\"}\n{\"timestamp\": \"2025-07-06T23:27:59.636245\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='136060474350560'>\", \"levelno\": 20, \"taskName\": \"Task-149\"}\n{\"timestamp\": \"2025-07-06T23:27:59.636313\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-149\"}\n{\"timestamp\": \"2025-07-06T23:27:59.636333\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-149\"}\n{\"timestamp\": \"2025-07-06T23:27:59.637011\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-149\"}\n{\"timestamp\": \"2025-07-06T23:27:59.637040\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-149\"}\n{\"timestamp\": \"2025-07-06T23:27:59.637821\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-149\"}\n{\"timestamp\": \"2025-07-06T23:27:59.637850\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-149\"}\n{\"timestamp\": \"2025-07-06T23:27:59.637956\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-149\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:59.637982\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-149\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:59.638059\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-149\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:59.638106\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-149\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:59.638226\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-149\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.00768589973449707, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n{\"timestamp\": \"2025-07-06T23:27:59.638256\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-149\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.00768589973449707, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n{\"timestamp\": \"2025-07-06T23:27:59.646847\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-152\"}\n{\"timestamp\": \"2025-07-06T23:27:59.646925\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-152\"}\n{\"timestamp\": \"2025-07-06T23:27:59.647613\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='136060470832704'>\", \"levelno\": 20, \"taskName\": \"Task-152\"}\n{\"timestamp\": \"2025-07-06T23:27:59.647644\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='136060470832704'>\", \"levelno\": 20, \"taskName\": \"Task-152\"}\n{\"timestamp\": \"2025-07-06T23:27:59.647716\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-152\"}\n{\"timestamp\": \"2025-07-06T23:27:59.647737\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-152\"}\n{\"timestamp\": \"2025-07-06T23:27:59.648399\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-152\"}\n{\"timestamp\": \"2025-07-06T23:27:59.648428\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-152\"}\n{\"timestamp\": \"2025-07-06T23:27:59.649201\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-152\"}\n{\"timestamp\": \"2025-07-06T23:27:59.649227\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-152\"}\n{\"timestamp\": \"2025-07-06T23:27:59.649336\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-152\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:59.649371\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-152\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:59.649465\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-152\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:59.649490\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-152\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:59.649610\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-152\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.007949113845825195, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n{\"timestamp\": \"2025-07-06T23:27:59.649638\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-152\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.007949113845825195, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n{\"timestamp\": \"2025-07-06T23:27:59.657800\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-155\"}\n{\"timestamp\": \"2025-07-06T23:27:59.657880\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Nie znaleziono kontur\\u00f3w w obrazie\", \"levelno\": 20, \"taskName\": \"Task-155\"}\n{\"timestamp\": \"2025-07-06T23:27:59.658573\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='136060471290112'>\", \"levelno\": 20, \"taskName\": \"Task-155\"}\n{\"timestamp\": \"2025-07-06T23:27:59.658605\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='136060471290112'>\", \"levelno\": 20, \"taskName\": \"Task-155\"}\n{\"timestamp\": \"2025-07-06T23:27:59.658674\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-155\"}\n{\"timestamp\": \"2025-07-06T23:27:59.658695\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Przeskalowano do 300 DPI\", \"levelno\": 20, \"taskName\": \"Task-155\"}\n{\"timestamp\": \"2025-07-06T23:27:59.659345\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-155\"}\n{\"timestamp\": \"2025-07-06T23:27:59.659371\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Ulepszono kontrast i ostro\\u015b\\u0107\", \"levelno\": 20, \"taskName\": \"Task-155\"}\n{\"timestamp\": \"2025-07-06T23:27:59.660151\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-155\"}\n{\"timestamp\": \"2025-07-06T23:27:59.660180\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Zastosowano adaptacyjny threshold\", \"levelno\": 20, \"taskName\": \"Task-155\"}\n{\"timestamp\": \"2025-07-06T23:27:59.660296\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-155\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:59.660321\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Preprocessing obrazu zako\\u0144czony\", \"levelno\": 20, \"taskName\": \"Task-155\", \"original_size\": [800, 600], \"processed_size\": [800, 600], \"contour_detected\": false}\n{\"timestamp\": \"2025-07-06T23:27:59.660406\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-155\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:59.660433\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"Rozpoczynam OCR z ulepszon\\u0105 konfiguracj\\u0105\", \"levelno\": 20, \"taskName\": \"Task-155\", \"tesseract_config\": \"--oem 1 --psm 6 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\\u0104\\u0106\\u0118\\u0141\\u0143\\u00d3\\u015a\\u0179\\u017b\\u0105\\u0107\\u0119\\u0142\\u0144\\u00f3\\u015b\\u017a\\u017c.,:-/%()[] -c tessedit_pageseg_mode=6 -c tessedit_ocr_engine_mode=1 -c preserve_interword_spaces=1 -c textord_heavy_nr=1 -c textord_min_linesize=2.0  -l eng\", \"languages\": [\"eng\"], \"preprocessing_applied\": true}\n{\"timestamp\": \"2025-07-06T23:27:59.660555\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-155\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.007997274398803711, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n{\"timestamp\": \"2025-07-06T23:27:59.660585\", \"level\": \"INFO\", \"logger\": \"backend.core.ocr\", \"module\": \"ocr\", \"message\": \"OCR przetwarzanie obrazu zako\\u0144czone pomy\\u015blnie\", \"levelno\": 20, \"taskName\": \"Task-155\", \"confidence\": 90.0, \"text_length\": 4, \"language\": \"eng\", \"processing_time_seconds\": 0.007997274398803711, \"preprocessing_steps\": [\"image_preprocessing\"], \"text_blocks\": 1}\n------------------------------ Captured log call -------------------------------\nINFO     backend.core.ocr:ocr.py:118 Nie znaleziono konturów w obrazie\nINFO     backend.core.ocr:ocr.py:271 Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='136060472129392'>\nINFO     backend.core.ocr:ocr.py:326 Przeskalowano do 300 DPI\nINFO     backend.core.ocr:ocr.py:330 Ulepszono kontrast i ostrość\nINFO     backend.core.ocr:ocr.py:334 Zastosowano adaptacyjny threshold\nINFO     backend.core.ocr:ocr.py:339 Preprocessing obrazu zakończony\nINFO     backend.core.ocr:ocr.py:383 Rozpoczynam OCR z ulepszoną konfiguracją\nINFO     backend.core.ocr:ocr.py:427 OCR przetwarzanie obrazu zakończone pomyślnie\nINFO     backend.core.ocr:ocr.py:118 Nie znaleziono konturów w obrazie\nINFO     backend.core.ocr:ocr.py:271 Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='136060472620912'>\nINFO     backend.core.ocr:ocr.py:326 Przeskalowano do 300 DPI\nINFO     backend.core.ocr:ocr.py:330 Ulepszono kontrast i ostrość\nINFO     backend.core.ocr:ocr.py:334 Zastosowano adaptacyjny threshold\nINFO     backend.core.ocr:ocr.py:339 Preprocessing obrazu zakończony\nINFO     backend.core.ocr:ocr.py:383 Rozpoczynam OCR z ulepszoną konfiguracją\nINFO     backend.core.ocr:ocr.py:427 OCR przetwarzanie obrazu zakończone pomyślnie\nINFO     backend.core.ocr:ocr.py:118 Nie znaleziono konturów w obrazie\nINFO     backend.core.ocr:ocr.py:271 Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='136060474350560'>\nINFO     backend.core.ocr:ocr.py:326 Przeskalowano do 300 DPI\nINFO     backend.core.ocr:ocr.py:330 Ulepszono kontrast i ostrość\nINFO     backend.core.ocr:ocr.py:334 Zastosowano adaptacyjny threshold\nINFO     backend.core.ocr:ocr.py:339 Preprocessing obrazu zakończony\nINFO     backend.core.ocr:ocr.py:383 Rozpoczynam OCR z ulepszoną konfiguracją\nINFO     backend.core.ocr:ocr.py:427 OCR przetwarzanie obrazu zakończone pomyślnie\nINFO     backend.core.ocr:ocr.py:118 Nie znaleziono konturów w obrazie\nINFO     backend.core.ocr:ocr.py:271 Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='136060470832704'>\nINFO     backend.core.ocr:ocr.py:326 Przeskalowano do 300 DPI\nINFO     backend.core.ocr:ocr.py:330 Ulepszono kontrast i ostrość\nINFO     backend.core.ocr:ocr.py:334 Zastosowano adaptacyjny threshold\nINFO     backend.core.ocr:ocr.py:339 Preprocessing obrazu zakończony\nINFO     backend.core.ocr:ocr.py:383 Rozpoczynam OCR z ulepszoną konfiguracją\nINFO     backend.core.ocr:ocr.py:427 OCR przetwarzanie obrazu zakończone pomyślnie\nINFO     backend.core.ocr:ocr.py:118 Nie znaleziono konturów w obrazie\nINFO     backend.core.ocr:ocr.py:271 Skalowanie do 300 DPI: (600, 800, 3) -> <MagicMock name='cv2.resize().shape' id='136060471290112'>\nINFO     backend.core.ocr:ocr.py:326 Przeskalowano do 300 DPI\nINFO     backend.core.ocr:ocr.py:330 Ulepszono kontrast i ostrość\nINFO     backend.core.ocr:ocr.py:334 Zastosowano adaptacyjny threshold\nINFO     backend.core.ocr:ocr.py:339 Preprocessing obrazu zakończony\nINFO     backend.core.ocr:ocr.py:383 Rozpoczynam OCR z ulepszoną konfiguracją\nINFO     backend.core.ocr:ocr.py:427 OCR przetwarzanie obrazu zakończone pomyślnie\n=============================== warnings summary ===============================\n../../../../miniconda3/lib/python3.13/site-packages/faiss/loader.py:49\n  /home/marcin/miniconda3/lib/python3.13/site-packages/faiss/loader.py:49: DeprecationWarning: numpy.core._multiarray_umath is deprecated and has been renamed to numpy._core._multiarray_umath. The numpy._core namespace contains private NumPy internals and its use is discouraged, as NumPy internals can change without warning in any release. In practice, most real-world usage of numpy.core is to access functionality in the public NumPy API. If that is the case, use the public NumPy API. If not, you are using NumPy internals. If you would still like to access an internal attribute, use numpy._core._multiarray_umath.__cpu_features__.\n    from numpy.core._multiarray_umath import __cpu_features__\n\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type SwigPyPacked has no __module__ attribute\n\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type SwigPyObject has no __module__ attribute\n\n<frozen importlib._bootstrap>:488\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: builtin type swigvarlink has no __module__ attribute\n\n../../../../miniconda3/lib/python3.13/site-packages/pydantic/_internal/_config.py:295: 14 warnings\n  /home/marcin/miniconda3/lib/python3.13/site-packages/pydantic/_internal/_config.py:295: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/\n    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)\n\nsrc/backend/models/user_profile.py:58\n  /home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/models/user_profile.py:58: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/\n    @validator(\"time_zone\")\n\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: Type google._upb._message.MessageMapContainer uses PyType_Spec with a metaclass that has custom tp_new. This is deprecated and will no longer be allowed in Python 3.14.\n\n<frozen importlib._bootstrap>:488\n  <frozen importlib._bootstrap>:488: DeprecationWarning: Type google._upb._message.ScalarMapContainer uses PyType_Spec with a metaclass that has custom tp_new. This is deprecated and will no longer be allowed in Python 3.14.\n\nsrc/backend/core/response_length_config.py:277\n  /home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/core/response_length_config.py:277: PydanticDeprecatedSince20: The `copy` method is deprecated; use `model_copy` instead. See the docstring of `BaseModel.copy` for details about how to handle `include` and `exclude`. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/\n    return configs.get(style, DEFAULT_CONCISE_CONFIG).copy()\n\ntests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_large_batch_processing_performance\n  <frozen os>:798: RuntimeWarning: coroutine 'TestOCRPerformanceEnhanced.test_concurrent_processing_performance.<locals>.process_single_image' was never awaited\n  Enable tracemalloc to get traceback where the object was allocated.\n  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.\n\n-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html\n================================ tests coverage ================================\n_______________ coverage: platform linux, python 3.13.5-final-0 ________________\n\nName                                                                       Stmts   Miss  Cover   Missing\n--------------------------------------------------------------------------------------------------------\nsrc/backend/agents/__init__.py                                                 3      0   100%\nsrc/backend/agents/agent_builder.py                                           98     98     0%   1-245\nsrc/backend/agents/agent_container.py                                         24     16    33%   12, 16, 20, 24-43\nsrc/backend/agents/agent_factory.py                                          112     70    38%   94-119, 123-162, 173, 196-227, 232-274, 281, 288-290, 295-297\nsrc/backend/agents/agent_registry.py                                          34     14    59%   37-43, 51, 55-59, 63, 69, 73\nsrc/backend/agents/analytics_agent.py                                         12      5    58%   16, 21-26\nsrc/backend/agents/anti_hallucination/__init__.py                              8      0   100%\nsrc/backend/agents/anti_hallucination/confidence_scorer.py                   114     92    19%   39-42, 54-107, 127-154, 168-220, 242, 259-273\nsrc/backend/agents/anti_hallucination/consensus_validator.py                 170    136    20%   42-45, 55, 67-93, 108-134, 154-184, 206-227, 246-278, 291-304, 317-327, 342-355, 370-404, 408-416, 420-427, 431-435, 449-459, 473\nsrc/backend/agents/anti_hallucination/enhanced_ocr_agent.py                  107     84    21%   41-59, 74-134, 141-143, 147-149, 164-179, 191-234, 249-253, 287-294, 299-307, 311-324, 328-341, 360, 383-403\nsrc/backend/agents/anti_hallucination/enhanced_receipt_analysis_agent.py     162    136    16%   42-64, 76-132, 150-194, 210-215, 231-256, 272-280, 295, 318, 352-364, 379-387, 401-431, 443-477, 490-515, 529-544, 563-573, 595-618\nsrc/backend/agents/anti_hallucination/hallucination_monitor.py               176    135    23%   53-69, 93-119, 127-131, 135-140, 145-167, 174-197, 204-219, 223, 235-245, 257-284, 295-312, 332-374, 385-413, 417-425, 437-462\nsrc/backend/agents/anti_hallucination/structured_output_validator.py         117     92    21%   35-36, 48-53, 202-255, 270-289, 303-350, 366-384, 397-410, 419\nsrc/backend/agents/anti_hallucination/validation_pipeline.py                 222    171    23%   57-64, 69-99, 128-136, 151-219, 235-254, 260-285, 291-328, 339-351, 363-365, 380-402, 414, 424-438, 442-446, 450-456, 462-474, 478-494, 503-515, 521, 528, 544-546, 550-572\nsrc/backend/agents/base_agent.py                                              73     43    41%   45, 49, 53, 57, 61-67, 81-89, 95-99, 103-107, 115-127, 141-144, 148-154\nsrc/backend/agents/categorization_agent.py                                    18     10    44%   17, 22-54\nsrc/backend/agents/chef_agent.py                                              71     71     0%   1-220\nsrc/backend/agents/circuit_breaker_monitor.py                                 14     14     0%   1-29\nsrc/backend/agents/circuit_breaker_wrapper.py                                 34     34     0%   1-89\nsrc/backend/agents/concise_response_agent.py                                  90     67    26%   71-99, 118-164, 179-241, 260-304, 312-317, 321, 338-340\nsrc/backend/agents/enhanced_memory_manager.py                                314    314     0%   6-625\nsrc/backend/agents/error_types.py                                             42      8    81%   46-48, 57, 69-70, 82-83\nsrc/backend/agents/executor.py                                               195    156    20%   48-52, 56-61, 65, 80-225, 234-260, 276-306, 317-350, 359-379, 385-402, 406-415, 419-428, 432-454\nsrc/backend/agents/fallback_manager.py                                        40     40     0%   1-92\nsrc/backend/agents/general_conversation_agent.py                             354    312    12%   47-53, 58-454, 470-475, 480-525, 530-616, 632-742, 758-813, 826-837, 845-940, 949-971, 976-984, 989-995, 1002-1012, 1016-1032, 1039-1085, 1089-1192\nsrc/backend/agents/hierarchical_architecture.py                              412    412     0%   6-910\nsrc/backend/agents/intent_detector.py                                        113    100    12%   17, 21-27, 33-96, 100-502\nsrc/backend/agents/interfaces.py                                             238     43    82%   131-133, 140-145, 218, 222, 226, 239, 245, 253, 257, 265, 269, 356-360, 364-371, 375-377, 384-387, 396-399, 403-405\nsrc/backend/agents/meal_planner_agent.py                                      47     33    30%   24, 29-92\nsrc/backend/agents/memory_manager.py                                         356    291    18%   47-52, 56-59, 75-78, 82-93, 117-128, 132, 138-145, 149-152, 156-189, 195-200, 207-294, 303-304, 318-333, 337-340, 344-363, 367-368, 373-399, 403-408, 414-438, 444-465, 470-482, 486-519, 523-581, 585-611, 615-627, 631-637, 641-659, 669-674, 680-685, 689-699, 703-708, 712-713, 717-723, 728-732, 736, 740, 744, 748-749\nsrc/backend/agents/ml_intent_detector.py                                      95     95     0%   1-194\nsrc/backend/agents/ocr_agent.py                                               53     37    30%   34-49, 66-117, 137-148, 166-168\nsrc/backend/agents/orchestration_components.py                                40     40     0%   1-71\nsrc/backend/agents/orchestrator.py                                           214    182    15%   18-26, 39-46, 54-93, 110-148, 152-161, 165-174, 178-184, 204-294, 300, 315-357, 369-451, 462-522, 526-531, 535-539, 545\nsrc/backend/agents/orchestrator_errors.py                                     24      5    79%   23, 32, 44, 53, 60\nsrc/backend/agents/orchestrator_factory.py                                    30     18    40%   26-67\nsrc/backend/agents/planner.py                                                194    158    19%   44-45, 49-55, 70-103, 107-109, 194-203, 207-237, 241-341, 345-417, 421-449, 455-467, 477-485, 494-518, 522-535\nsrc/backend/agents/plugin_interface.py                                        11     11     0%   1-21\nsrc/backend/agents/plugin_manager.py                                          28     28     0%   1-55\nsrc/backend/agents/promo_scraping_agent.py                                   130    106    18%   22-43, 55-71, 79-91, 95-137, 145-159, 163-175, 181-211, 215-236, 240, 291-299, 303-308, 312-319, 327-332, 338, 350\nsrc/backend/agents/prompts.py                                                 39     24    38%   76-105, 114-149, 158-175, 181-182, 201-204, 217, 239, 254\nsrc/backend/agents/rag_agent.py                                               88     67    24%   45-50, 54-75, 91-94, 109, 124, 143-146, 152-156, 177-188, 207-306, 314\nsrc/backend/agents/receipt_analysis_agent.py                                 308    281     9%   38-43, 48-124, 133-160, 166-180, 184, 201-216, 222-240, 244-430, 434-461, 465-524, 529-549, 553-614, 618-648, 652-682\nsrc/backend/agents/receipt_categorization_agent.py                           136    100    26%   76-172, 181-197, 203-232, 238-274, 280-323, 329-347, 353-378, 384-391, 395, 410, 414\nsrc/backend/agents/receipt_import_agent.py                                    67     46    31%   46-50, 65-142, 157-179, 183-185, 189, 199, 203\nsrc/backend/agents/receipt_validation_agent.py                               121     84    31%   83-153, 160-206, 217-252, 258-273, 279-302, 306, 321, 325\nsrc/backend/agents/response_generator.py                                      29     20    31%   13, 23-57, 67-69, 81\nsrc/backend/agents/router_service.py                                          55     41    25%   22-40, 46, 52, 58, 63-128\nsrc/backend/agents/search_agent.py                                           264    231    12%   26-30, 42-49, 56-84, 92-111, 117-167, 176-237, 244-291, 301-366, 370-389, 395-417, 421-460, 464-499, 503-530, 535, 545, 561, 567-596\nsrc/backend/agents/state.py                                                   42     42     0%   3-78\nsrc/backend/agents/synthesizer.py                                            118     98    17%   21, 25-29, 48-76, 82-107, 113-137, 141-221, 225, 262-284, 290-307, 313-324, 340, 353-355\nsrc/backend/agents/tools/__init__.py                                           3      0   100%\nsrc/backend/agents/tools/date_parser.py                                       24     24     0%   1-69\nsrc/backend/agents/tools/registry.py                                          82     37    55%   37, 44, 48, 52-63, 67-83, 87-104, 150, 167, 186, 207, 224, 229-233\nsrc/backend/agents/tools/search_providers.py                                  57     36    37%   35, 41-73, 77, 84, 90-136, 140\nsrc/backend/agents/tools/tools.py                                            119     99    17%   22-48, 55-81, 91-99, 108-147, 154-170, 180-187, 195-202, 209-218\nsrc/backend/agents/utils.py                                                   72     62    14%   15-49, 56-86, 93, 100-104, 114-136\nsrc/backend/agents/weather_agent.py                                          306    211    31%   48, 137, 142-143, 149, 158-245, 249-252, 260-289, 295-410, 416-549, 553-576, 580-588, 592-598, 604-664, 674-676, 682-699, 703, 707, 711, 725, 731, 738, 744-774\nsrc/backend/core/ocr.py                                                      307    156    49%   62-75, 84, 133-151, 161-215, 222, 242-244, 263-264, 298-300, 307, 321-322, 350-352, 466-501, 524-535, 546-600, 610-626, 636-665\n--------------------------------------------------------------------------------------------------------\nTOTAL                                                                       6826   5336    22%\nCoverage HTML written to dir htmlcov\nCoverage JSON written to file coverage.json\n=========================== short test summary info ============================\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_enhanced_contour_detection\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_contour_detection_fallback_to_bounding_rect\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_perspective_correction\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_adaptive_thresholding_clahe\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_300_dpi_scaling\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_contrast_enhancement\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_sharpness_enhancement\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_lstm_engine_configuration\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_process_image_with_advanced_preprocessing\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_metadata_tracking\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_confidence_distribution_calculation\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_processing_time_tracking\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_polish_receipt_text_recognition\nFAILED tests/unit/test_ocr_advanced_preprocessing.py::TestOCRAdvancedPreprocessing::test_image_quality_analysis\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_import_agent_success\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_import_agent_ocr_failure\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_validation_agent_success\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_validation_agent_invalid_receipt\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_validation_agent_nip_validation\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_categorization_agent_success\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_receipt_categorization_agent_fallback_to_dictionary\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_complete_workflow_success\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_workflow_validation_failure\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_workflow_categorization_failure\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_error_handling_and_recovery\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_metadata_tracking\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_performance_monitoring\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_concurrent_processing\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_memory_management\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_configuration_validation\nFAILED tests/integration/test_receipt_agent_workflow.py::TestReceiptAgentWorkflow::test_agent_response_format_consistency\nFAILED tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_perspective_correction_performance\nFAILED tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_adaptive_thresholding_performance\nFAILED tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_full_preprocessing_pipeline_performance\nFAILED tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_agent_workflow_performance\nFAILED tests/performance/test_ocr_performance_enhanced.py::TestOCRPerformanceEnhanced::test_concurrent_processing_performance\n================== 36 failed, 8 passed, 28 warnings in 5.58s ===================\n",
      "stderr": "",
      "duration": 16.161388397216797
    },
    "total_success": false
  },
  "frontend_e2e": {
    "receipt_wizard_e2e": {
      "success": false,
      "returncode": 1,
      "stdout": "Error: Process from config.webServer exited early.\n\n",
      "stderr": "\u001b[2m[WebServer] \u001b[22m \u001b[31m\u001b[1m⨯\u001b[22m\u001b[39m Failed to start server\n\u001b[2m[WebServer] \u001b[22mError: listen EADDRINUSE: address already in use :::3003\n\u001b[2m[WebServer] \u001b[22m\u001b[90m    at Server.setupListenHandle [as _listen2] (node:net:1908:16)\u001b[39m\n\u001b[2m[WebServer] \u001b[22m\u001b[90m    at listenInCluster (node:net:1965:12)\u001b[39m\n\u001b[2m[WebServer] \u001b[22m\u001b[90m    at Server.listen (node:net:2067:7)\u001b[39m\n\u001b[2m[WebServer] \u001b[22m    at \u001b[90m/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/myappassistant-chat-frontend/\u001b[39mnode_modules/\u001b[4mnext\u001b[24m/dist/server/lib/start-server.js:280:16\n\u001b[2m[WebServer] \u001b[22m    at new Promise (<anonymous>)\n\u001b[2m[WebServer] \u001b[22m    at startServer \u001b[90m(/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/myappassistant-chat-frontend/\u001b[39mnode_modules/\u001b[4mnext\u001b[24m/dist/server/lib/start-server.js:191:11\u001b[90m)\u001b[39m\n\u001b[2m[WebServer] \u001b[22m    at \u001b[90m/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/myappassistant-chat-frontend/\u001b[39mnode_modules/\u001b[4mnext\u001b[24m/dist/server/lib/start-server.js:310:52\n\u001b[2m[WebServer] \u001b[22m    at Span.traceAsyncFn \u001b[90m(/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/myappassistant-chat-frontend/\u001b[39mnode_modules/\u001b[4mnext\u001b[24m/dist/trace/trace.js:154:26\u001b[90m)\u001b[39m\n\u001b[2m[WebServer] \u001b[22m    at process.<anonymous> \u001b[90m(/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/myappassistant-chat-frontend/\u001b[39mnode_modules/\u001b[4mnext\u001b[24m/dist/server/lib/start-server.js:310:35\u001b[90m)\u001b[39m\n\u001b[2m[WebServer] \u001b[22m\u001b[90m    at process.emit (node:events:524:28)\u001b[39m {\n\u001b[2m[WebServer] \u001b[22m  code: \u001b[32m'EADDRINUSE'\u001b[39m,\n\u001b[2m[WebServer] \u001b[22m  errno: \u001b[33m-98\u001b[39m,\n\u001b[2m[WebServer] \u001b[22m  syscall: \u001b[32m'listen'\u001b[39m,\n\u001b[2m[WebServer] \u001b[22m  address: \u001b[32m'::'\u001b[39m,\n\u001b[2m[WebServer] \u001b[22m  port: \u001b[33m3003\u001b[39m\n\u001b[2m[WebServer] \u001b[22m}\n",
      "duration": 1.3749277591705322
    },
    "total_success": false
  },
  "tauri_integration": {
    "tauri_integration": {
      "success": false,
      "returncode": 1,
      "stdout": "Error: Process from config.webServer exited early.\n\n",
      "stderr": "\u001b[2m[WebServer] \u001b[22m \u001b[31m\u001b[1m⨯\u001b[22m\u001b[39m Failed to start server\n\u001b[2m[WebServer] \u001b[22mError: listen EADDRINUSE: address already in use :::3003\n\u001b[2m[WebServer] \u001b[22m\u001b[90m    at Server.setupListenHandle [as _listen2] (node:net:1908:16)\u001b[39m\n\u001b[2m[WebServer] \u001b[22m\u001b[90m    at listenInCluster (node:net:1965:12)\u001b[39m\n\u001b[2m[WebServer] \u001b[22m\u001b[90m    at Server.listen (node:net:2067:7)\u001b[39m\n\u001b[2m[WebServer] \u001b[22m    at \u001b[90m/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/myappassistant-chat-frontend/\u001b[39mnode_modules/\u001b[4mnext\u001b[24m/dist/server/lib/start-server.js:280:16\n\u001b[2m[WebServer] \u001b[22m    at new Promise (<anonymous>)\n\u001b[2m[WebServer] \u001b[22m    at startServer \u001b[90m(/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/myappassistant-chat-frontend/\u001b[39mnode_modules/\u001b[4mnext\u001b[24m/dist/server/lib/start-server.js:191:11\u001b[90m)\u001b[39m\n\u001b[2m[WebServer] \u001b[22m    at \u001b[90m/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/myappassistant-chat-frontend/\u001b[39mnode_modules/\u001b[4mnext\u001b[24m/dist/server/lib/start-server.js:310:52\n\u001b[2m[WebServer] \u001b[22m    at Span.traceAsyncFn \u001b[90m(/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/myappassistant-chat-frontend/\u001b[39mnode_modules/\u001b[4mnext\u001b[24m/dist/trace/trace.js:154:26\u001b[90m)\u001b[39m\n\u001b[2m[WebServer] \u001b[22m    at process.<anonymous> \u001b[90m(/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/myappassistant-chat-frontend/\u001b[39mnode_modules/\u001b[4mnext\u001b[24m/dist/server/lib/start-server.js:310:35\u001b[90m)\u001b[39m\n\u001b[2m[WebServer] \u001b[22m\u001b[90m    at process.emit (node:events:524:28)\u001b[39m {\n\u001b[2m[WebServer] \u001b[22m  code: \u001b[32m'EADDRINUSE'\u001b[39m,\n\u001b[2m[WebServer] \u001b[22m  errno: \u001b[33m-98\u001b[39m,\n\u001b[2m[WebServer] \u001b[22m  syscall: \u001b[32m'listen'\u001b[39m,\n\u001b[2m[WebServer] \u001b[22m  address: \u001b[32m'::'\u001b[39m,\n\u001b[2m[WebServer] \u001b[22m  port: \u001b[33m3003\u001b[39m\n\u001b[2m[WebServer] \u001b[22m}\n",
      "duration": 1.3239362239837646
    },
    "total_success": false
  }
}